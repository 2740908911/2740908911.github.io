{
    "version": "https://jsonfeed.org/version/1",
    "title": "imFanqie • All posts by \"ssrf\" tag",
    "description": "学习博客",
    "home_page_url": "http://imfanqie.top",
    "items": [
        {
            "id": "http://imfanqie.top/2021/08/04/ctf/web/ssrf/(ctfwp)ssrf%E5%AD%A6%E4%B9%A0/",
            "url": "http://imfanqie.top/2021/08/04/ctf/web/ssrf/(ctfwp)ssrf%E5%AD%A6%E4%B9%A0/",
            "title": "(ctfwp)ssrf学习",
            "date_published": "2021-08-04T11:17:39.048Z",
            "content_html": "<p>学习一下 ssrf</p>\n<p><span id=\"more\"></span></p>\n<h1 id=\"1网鼎杯-2018fakebook\"><a class=\"anchor\" href=\"#1网鼎杯-2018fakebook\">#</a> 1.[网鼎杯 2018] Fakebook</h1>\n<hr>\n<p>这题本来没做出来，搜了下 wp，学会了几种方法，并且大致认识了 ssrf。</p>\n<p>下面记录一下：</p>\n<hr>\n<p>进去找了找，发现有 sql 注入漏洞，并且能通过联合查询查到库名表明列名，但是最后显示序列化过的，也没有发现和 flag 相关的东西，遂没有思路了：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvUlNHb1g0YWpsRUpzWjZDLnBuZw==\">https://i.loli.net/2021/08/04/RSGoX4ajlEJsZ6C.png</span>&quot; alt=&quot;1.1.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p1--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvTlZadTQ3eEZCbk1MR0hiLnBuZw==\">https://i.loli.net/2021/08/04/NVZu47xFBnMLGHb.png</span>&quot; alt=&quot;1.2.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p2--&gt;</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvaE01OUVwWXdpVWFJeXFvLnBuZw==\">https://i.loli.net/2021/08/04/hM59EpYwiUaIyqo.png</span>&quot; alt=&quot;1.3.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p3--&gt;</p>\n<p>看了 wp 后，发现了这个网站还有 robots.txt 文件，我压根没考虑那么多。。</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvTGhBbE9Oems2Q2VzTXJLLnBuZw==\">https://i.loli.net/2021/08/04/LhAlONzk6CesMrK.png</span>&quot; alt=&quot;1.4.png&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;!--p4--&gt;</p>\n<p>根据大概意思可以猜测出，应该是 get 了一组信息在 blog 的位置，所以可以把需要 get 的信息写到 blog 位置，应该能出 flag，另外还要注意得用序列化的形式写</p>\n<p>把 txt 中前面的信息复制下来，根据题目中爆出来的文件路径，本地构造序列化内容，用 file 协议读：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvNkc1aG5FdVlmeEJrN0hJLnBuZw==\">https://i.loli.net/2021/08/04/6G5hnEuYfxBk7HI.png</span>&quot; alt=&quot;1.5.png&quot; style=&quot;zoom:50%;&quot; /&gt;&lt;!--P5--&gt;</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>no<span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token comment\">/*!union*/</span> select <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'O:8:\"UserInfo\":3:&#123;s:4:\"name\";s:1:\"1\";s:3:\"age\";i:10;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";&#125;'</span></pre></td></tr></table></figure><p>在源码中读取 flag：</p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjEvMDgvMDQvZTZPem51eFhGRHlhOW9pLnBuZw==\">https://i.loli.net/2021/08/04/e6OznuxXFDya9oi.png</span>&quot; alt=&quot;1.6.png&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;!--p6--&gt;</p>\n<hr>\n<p>* 其他方法：</p>\n<p>通过 load_file 读取文件获取</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string-interpolation\"><span class=\"token string\">f\"if(ascii(substr((load_file('/var/www/html/flag.php')),</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,1))></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mid<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">,1,0)\"</span></span></pre></td></tr></table></figure><p>把 payload 带入盲注二分法程序中跑，能跑出来 flag，原理就是 load_file 能读取本地文件。</p>\n<p>还可以通过 load_file 注入一句话木马，用菜刀链接解：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyMzQyMTQxL2FydGljbGUvZGV0YWlscy8xMDMyNTMxMjQ=\">SQL 注入一句话木马（load_file/out file</span></p>\n<hr>\n<p>遇到类似的再补充</p>\n<p>END</p>\n",
            "tags": [
                "SSRF"
            ]
        }
    ]
}